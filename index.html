<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Gudang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-blue-800 to-blue-900 text-white z-50 sidebar-transition transform lg:transform-none">
        <div class="p-6 border-b border-blue-700">
            <h1 class="text-xl font-bold flex items-center">
                <i class="fas fa-warehouse mr-3"></i>
                Manajemen Gudang
            </h1>
        </div>
        <nav class="mt-6">
            <a href="#" onclick="showPage('incoming')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-arrow-down mr-3"></i>Incoming
            </a>
            <a href="#" onclick="showPage('status')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-clock mr-3"></i>Status
            </a>
            <a href="#" onclick="showPage('outgoing')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-arrow-up mr-3"></i>Outgoing
            </a>
            <a href="#" onclick="showPage('history')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-history mr-3"></i>Riwayat
            </a>
            <a href="#" onclick="showPage('recap')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-chart-bar mr-3"></i>Rekap Data
            </a>
            <a href="#" onclick="showPage('stores')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-store mr-3"></i>Kartu Store
            </a>
            <a href="#" onclick="showPage('settings')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-cog mr-3"></i>Settings
            </a>
            <a href="#" onclick="showPage('export')" class="nav-item flex items-center px-6 py-3 hover:bg-blue-700 transition-colors">
                <i class="fas fa-download mr-3"></i>Export
            </a>
        </nav>
    </div>

    <!-- Overlay untuk mobile -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <div class="lg:ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b p-4 flex items-center justify-between">
            <button onclick="toggleSidebar()" class="lg:hidden text-gray-600 hover:text-gray-900">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <h2 id="pageTitle" class="text-2xl font-semibold text-gray-800">Dashboard</h2>
            <div class="flex items-center space-x-4">
                <button onclick="syncWithGoogleSheet()" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                    <i class="fas fa-sync-alt mr-1"></i>Sync
                </button>
                <span class="text-sm text-gray-600" id="currentDate"></span>
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white text-sm"></i>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <main class="p-6">
            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Barang</p>
                                <p class="text-2xl font-bold text-blue-600" id="totalItems">0</p>
                            </div>
                            <i class="fas fa-boxes text-3xl text-blue-600"></i>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Pending</p>
                                <p class="text-2xl font-bold text-yellow-600" id="pendingItems">0</p>
                            </div>
                            <i class="fas fa-clock text-3xl text-yellow-600"></i>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Selesai</p>
                                <p class="text-2xl font-bold text-green-600" id="completedItems">0</p>
                            </div>
                            <i class="fas fa-check-circle text-3xl text-green-600"></i>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Store</p>
                                <p class="text-2xl font-bold text-purple-600" id="totalStores">22</p>
                            </div>
                            <i class="fas fa-store text-3xl text-purple-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Incoming Page -->
            <div id="incomingPage" class="page hidden">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">Input Barang Masuk</h3>
                    <form id="incomingForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Transaksi</label>
                            <input type="date" id="transactionDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                            <input type="text" id="itemCode" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan kode barang">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                            <input type="text" id="itemName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Nama barang">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
                            <input type="number" id="itemQty" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Jumlah">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Unit</label>
                            <select id="itemUnit" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Pilih Unit</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Min Stock</label>
                            <input type="number" id="minStock" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Minimum stock">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="itemStatus" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="pending">Pending</option>
                                <option value="selesai">Selesai</option>
                            </select>
                        </div>
                        <div class="md:col-span-2 lg:col-span-3">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Tambah Barang
                            </button>
                        </div>
                    </form>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Daftar Barang Masuk</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Tanggal</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kode</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Barang</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Qty</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Unit</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="incomingTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Status Page -->
            <div id="statusPage" class="page hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Barang Menunggu Konfirmasi</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Tanggal</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kode</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Barang</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Qty</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Unit</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Catatan</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="statusTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Outgoing Page -->
            <div id="outgoingPage" class="page hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Barang Keluar</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Tanggal</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kode</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Barang</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Qty</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Unit</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Dari Store</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Ke Store</th>
                                </tr>
                            </thead>
                            <tbody id="outgoingTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- History Page -->
            <div id="historyPage" class="page hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Riwayat Transaksi</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Tanggal</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kode</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Barang</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Qty</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Unit</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Tipe</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Store</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Recap Page -->
            <div id="recapPage" class="page hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Rekapitulasi Data Barang</h3>
                        <button onclick="showAddItemModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah Barang Baru
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kode Barang</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Barang</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Qty</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Unit</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Min Stock</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="recapTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Stores Page -->
            <div id="storesPage" class="page hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="storeCards">
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="page hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Store Management -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Kelola Store</h3>
                        <div class="space-y-4">
                            <button onclick="showAddStoreModal()" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Tambah Store
                            </button>
                            <div class="max-h-64 overflow-y-auto">
                                <div id="storeList" class="space-y-2">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Unit Management -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Kelola Unit</h3>
                        <div class="space-y-4">
                            <button onclick="showAddUnitModal()" class="w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Tambah Unit
                            </button>
                            <div class="max-h-64 overflow-y-auto">
                                <div id="unitList" class="space-y-2">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Page -->
            <div id="exportPage" class="page hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Export Rekapitulasi</h3>
                        <div class="space-y-4">
                            <button onclick="exportRecapToExcel()" class="w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-file-excel mr-2"></i>Export ke Excel
                            </button>
                            <button onclick="exportRecapToPDF()" class="w-full bg-red-600 text-white p-3 rounded-lg hover:bg-red-700 transition-colors">
                                <i class="fas fa-file-pdf mr-2"></i>Export ke PDF
                            </button>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Export Kartu Store</h3>
                        <div class="space-y-4">
                            <select id="storeSelect" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="">Pilih Store</option>
                            </select>
                            <button onclick="exportStoreToExcel()" class="w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-file-excel mr-2"></i>Export ke Excel
                            </button>
                            <button onclick="exportStoreToPDF()" class="w-full bg-red-600 text-white p-3 rounded-lg hover:bg-red-700 transition-colors">
                                <i class="fas fa-file-pdf mr-2"></i>Export ke PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Store Detail Modal -->
    <div id="storeDetailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 id="storeDetailTitle" class="text-xl font-semibold"></h3>
                <button onclick="closeStoreDetailModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <div class="mb-4">
                    <button onclick="showTransferModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-exchange-alt mr-2"></i>Transfer Barang
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Tanggal</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kode</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Barang</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Qty</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Unit</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Transaksi</th>
                            </tr>
                        </thead>
                        <tbody id="storeDetailTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer Modal -->
    <div id="transferModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold">Transfer Barang</h3>
            </div>
            <div class="p-6">
                <form id="transferForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Barang</label>
                        <select id="transferItemSelect" class="w-full p-3 border border-gray-300 rounded-lg">
                            <option value="">Pilih Barang</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
                        <input type="number" id="transferQty" class="w-full p-3 border border-gray-300 rounded-lg" min="1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ke Store</label>
                        <select id="transferToStore" class="w-full p-3 border border-gray-300 rounded-lg">
                            <option value="">Pilih Store Tujuan</option>
                        </select>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors">
                            Transfer
                        </button>
                        <button type="button" onclick="closeTransferModal()" class="flex-1 bg-gray-300 text-gray-700 p-3 rounded-lg hover:bg-gray-400 transition-colors">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold">Tambah Barang Baru</h3>
            </div>
            <div class="p-6">
                <form id="addItemForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                        <input type="text" id="newItemCode" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                        <input type="text" id="newItemName" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Unit</label>
                        <select id="newItemUnit" class="w-full p-3 border border-gray-300 rounded-lg" required>
                            <option value="">Pilih Unit</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Min Stock</label>
                        <input type="number" id="newItemMinStock" class="w-full p-3 border border-gray-300 rounded-lg" min="0" required>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition-colors">
                            Tambah
                        </button>
                        <button type="button" onclick="closeAddItemModal()" class="flex-1 bg-gray-300 text-gray-700 p-3 rounded-lg hover:bg-gray-400 transition-colors">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Store Modal -->
    <div id="addStoreModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold">Tambah Store</h3>
            </div>
            <div class="p-6">
                <form id="addStoreForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kode Store</label>
                        <input type="text" id="newStoreCode" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Store</label>
                        <input type="text" id="newStoreName" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors">
                            Tambah
                        </button>
                        <button type="button" onclick="closeAddStoreModal()" class="flex-1 bg-gray-300 text-gray-700 p-3 rounded-lg hover:bg-gray-400 transition-colors">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Unit Modal -->
    <div id="addUnitModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold">Tambah Unit</h3>
            </div>
            <div class="p-6">
                <form id="addUnitForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Unit</label>
                        <input type="text" id="newUnitName" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition-colors">
                            Tambah
                        </button>
                        <button type="button" onclick="closeAddUnitModal()" class="flex-1 bg-gray-300 text-gray-700 p-3 rounded-lg hover:bg-gray-400 transition-colors">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script Configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxde3CUWsh_xFk-YQukpkYg1G5NE_ssPFFhM0ioDtCO8XbeszrVPAyXcSzJMfJyCMxv/exec';

        // Fungsi untuk mengirim data ke Google Spreadsheet
        async function sendToGoogleSheet(action, data) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        ...data
                    })
                });
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Error sending to Google Sheet:', error);
                return { success: false, message: error.message };
            }
        }

        // Fungsi untuk mengambil data dari Google Spreadsheet
        async function getFromGoogleSheet(action) {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=${action}`);
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Error getting from Google Sheet:', error);
                return { success: false, message: error.message };
            }
        }

        // Inisialisasi spreadsheet
        async function initializeGoogleSheet() {
            try {
                const result = await getFromGoogleSheet('init');
                if (result.success) {
                    console.log('✅ Spreadsheet berhasil diinisialisasi');
                    showNotification('Spreadsheet berhasil diinisialisasi', 'success');
                } else {
                    console.error('❌ Error inisialisasi:', result.message);
                    showNotification('Error inisialisasi spreadsheet: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('❌ Error inisialisasi:', error);
                showNotification('Error koneksi ke Google Spreadsheet', 'error');
            }
        }

        // Fungsi untuk sinkronisasi data
        async function syncWithGoogleSheet() {
            try {
                showNotification('Sinkronisasi data...', 'info');
                const result = await getFromGoogleSheet('getAllData');
                
                if (result.success && result.data) {
                    const data = result.data;
                    
                    // Update data lokal dengan data dari spreadsheet
                    if (data.stores) stores = data.stores;
                    if (data.units) units = data.units;
                    
                    // Update tampilan
                    loadStores();
                    loadUnits();
                    updateDashboard();
                    
                    console.log('✅ Data berhasil disinkronisasi');
                    showNotification('Data berhasil disinkronisasi', 'success');
                } else {
                    console.error('❌ Error sinkronisasi:', result.message);
                }
            } catch (error) {
                console.error('❌ Error sinkronisasi:', error);
            }
        }

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' :
                        'fa-info-circle'
                    } mr-2"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Data Storage
        let stores = [
            {code: '01', name: 'GENERAL STORE (ANYER)'},
            {code: '02', name: 'General store (JKT)'},
            {code: '03', name: 'MAIN KITCHEN STORAGE'},
            {code: '04', name: 'F&B ADMIN'},
            {code: '05', name: 'HOUSEKEEPING'},
            {code: '10', name: 'ENGINEERING STORE'},
            {code: '11', name: 'PROJECT STORE'},
            {code: '12', name: 'ADMIN & GENERAL'},
            {code: '13', name: 'SALES & MARKETING'},
            {code: '14', name: 'SECURITY'},
            {code: '15', name: 'FRONT OFFICE'},
            {code: '16', name: 'SPA'},
            {code: '17', name: 'HRD'},
            {code: '21', name: 'D\'BISTRO'},
            {code: '22', name: 'KOREAN STORE (KANTIN)'},
            {code: '23', name: 'DBAR STORE'},
            {code: '24', name: 'LIQUOR STORE'},
            {code: '25', name: 'SOUVENIR SHOP'},
            {code: '26', name: 'SPORT & RECREATION'},
            {code: '27', name: 'JAPANESE STORE'},
            {code: '28', name: 'DRAGON BEACH CLUB STORE'},
            {code: '29', name: 'SUNSET GRILL STORE'},
            {code: '31', name: 'BANQUET STORE'},
            {code: '40', name: 'LAUNDRY STORE'}
        ];

        let units = ['pcs', 'kg', 'liter', 'box', 'pack', 'meter', 'roll'];
        let incomingItems = [];
        let statusItems = [];
        let outgoingItems = [];
        let historyItems = [];
        let recapItems = [];
        let storeItems = {};
        let currentStoreCode = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            loadUnits();
            loadStores();
            updateDashboard();
            setDefaultDate();
            showPage('incoming');
            
            // Inisialisasi dan sync dengan Google Sheet
            initializeGoogleSheet();
            setTimeout(syncWithGoogleSheet, 2000); // Delay 2 detik untuk memastikan inisialisasi selesai
        });

        function setDefaultDate() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('transactionDate').value = formattedDate;
        }

        function updateCurrentDate() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID');
        }

        function loadUnits() {
            const unitSelects = ['itemUnit', 'newItemUnit'];
            unitSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Unit</option>';
                    units.forEach(unit => {
                        select.innerHTML += `<option value="${unit}">${unit}</option>`;
                    });
                }
            });
        }

        function loadStores() {
            const storeSelects = ['transferToStore', 'storeSelect'];
            storeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Store</option>';
                    stores.forEach(store => {
                        select.innerHTML += `<option value="${store.code}">${store.code} - ${store.name}</option>`;
                    });
                }
            });
            
            // Initialize store items
            stores.forEach(store => {
                if (!storeItems[store.code]) {
                    storeItems[store.code] = [];
                }
            });
            
            renderStoreCards();
            renderStoreList();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            if (window.innerWidth < 1024) {
                sidebar.classList.toggle('-translate-x-full');
                overlay.classList.toggle('hidden');
            }
        }

        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            const targetPage = document.getElementById(pageName + 'Page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
            }
            
            // Update page title
            const titles = {
                'incoming': 'Barang Masuk',
                'status': 'Status Barang',
                'outgoing': 'Barang Keluar',
                'history': 'Riwayat',
                'recap': 'Rekapitulasi',
                'stores': 'Kartu Store',
                'settings': 'Pengaturan',
                'export': 'Export Data'
            };
            
            document.getElementById('pageTitle').textContent = titles[pageName] || 'Dashboard';
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-blue-700');
            });
            
            // Add active class to current nav item
            event.target.closest('.nav-item')?.classList.add('bg-blue-700');
            
            // Close sidebar on mobile only
            if (window.innerWidth < 1024) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('overlay');
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
            
            // Load page specific data
            switch(pageName) {
                case 'incoming':
                    renderIncomingTable();
                    break;
                case 'status':
                    renderStatusTable();
                    break;
                case 'outgoing':
                    renderOutgoingTable();
                    break;
                case 'history':
                    renderHistoryTable();
                    break;
                case 'recap':
                    renderRecapTable();
                    break;
                case 'stores':
                    renderStoreCards();
                    break;
                case 'settings':
                    renderStoreList();
                    renderUnitList();
                    break;
            }
        }

        // Incoming Form Handler
        document.getElementById('incomingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const transactionDate = document.getElementById('transactionDate').value;
            const itemCode = document.getElementById('itemCode').value;
            const itemName = document.getElementById('itemName').value;
            const itemQty = parseInt(document.getElementById('itemQty').value);
            const itemUnit = document.getElementById('itemUnit').value;
            const minStock = parseInt(document.getElementById('minStock').value);
            const itemStatus = document.getElementById('itemStatus').value;
            
            if (!transactionDate || !itemCode || !itemName || !itemQty || !itemUnit || !minStock) {
                alert('Semua field harus diisi!');
                return;
            }
            
            // Format date to Indonesian format
            const dateObj = new Date(transactionDate);
            const formattedDate = dateObj.toLocaleDateString('id-ID');
            
            const newItem = {
                id: Date.now(),
                date: formattedDate,
                code: itemCode,
                name: itemName,
                qty: itemQty,
                unit: itemUnit,
                minStock: minStock,
                status: itemStatus
            };
            
            // Kirim ke Google Sheet terlebih dahulu
            showNotification('Menyimpan data ke Google Spreadsheet...', 'info');
            const result = await sendToGoogleSheet('addIncoming', newItem);
            
            if (result.success) {
                // Jika berhasil, lanjutkan dengan logika lokal
                incomingItems.push(newItem);
                
                // Add to recap if not exists
                const existingRecap = recapItems.find(item => item.code === itemCode);
                if (!existingRecap) {
                    recapItems.push({
                        code: itemCode,
                        name: itemName,
                        qty: itemQty,
                        unit: itemUnit,
                        minStock: minStock
                    });
                } else {
                    existingRecap.qty += itemQty;
                }
                
                // Add to status if pending
                if (itemStatus === 'pending') {
                    statusItems.push({...newItem, notes: ''});
                } else if (itemStatus === 'selesai') {
                    // Add to store 01 directly
                    if (!storeItems['01']) storeItems['01'] = [];
                    storeItems['01'].push({
                        ...newItem,
                        transaction: 'Incoming'
                    });
                    
                    // Add to history
                    historyItems.push({
                        ...newItem,
                        type: 'Incoming',
                        store: '01 - GENERAL STORE (ANYER)'
                    });
                    
                    // Kirim ke Google Sheet untuk kartu store dan history
                    await sendToGoogleSheet('updateKartuStore', {
                        storeCode: '01',
                        storeName: 'GENERAL STORE (ANYER)',
                        date: formattedDate,
                        code: itemCode,
                        name: itemName,
                        qty: itemQty,
                        unit: itemUnit,
                        transaction: 'Incoming'
                    });
                    
                    await sendToGoogleSheet('addToHistory', {
                        ...newItem,
                        type: 'Incoming',
                        store: '01 - GENERAL STORE (ANYER)'
                    });
                }
                
                // Reset form
                this.reset();
                setDefaultDate();
                
                // Update displays
                renderIncomingTable();
                updateDashboard();
                
                showNotification('Barang berhasil ditambahkan dan disimpan ke Google Spreadsheet!', 'success');
            } else {
                showNotification('Error menyimpan ke Google Spreadsheet: ' + result.message, 'error');
            }
        });

        // Auto-fill form when item code exists in recap
        document.getElementById('itemCode').addEventListener('blur', function() {
            const code = this.value;
            const existingItem = recapItems.find(item => item.code === code);
            
            if (existingItem) {
                document.getElementById('itemName').value = existingItem.name;
                document.getElementById('itemUnit').value = existingItem.unit;
                document.getElementById('minStock').value = existingItem.minStock;
            }
        });

        function renderIncomingTable() {
            const tbody = document.getElementById('incomingTableBody');
            tbody.innerHTML = '';
            
            incomingItems.forEach(item => {
                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">${item.date}</td>
                        <td class="px-4 py-3 text-sm">${item.code}</td>
                        <td class="px-4 py-3 text-sm">${item.name}</td>
                        <td class="px-4 py-3 text-sm">${item.qty}</td>
                        <td class="px-4 py-3 text-sm">${item.unit}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 rounded-full text-xs ${item.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                                ${item.status === 'pending' ? 'Pending' : 'Selesai'}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="editIncomingItem(${item.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteIncomingItem(${item.id})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderStatusTable() {
            const tbody = document.getElementById('statusTableBody');
            tbody.innerHTML = '';
            
            statusItems.forEach(item => {
                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">${item.date}</td>
                        <td class="px-4 py-3 text-sm">${item.code}</td>
                        <td class="px-4 py-3 text-sm">${item.name}</td>
                        <td class="px-4 py-3 text-sm">${item.qty}</td>
                        <td class="px-4 py-3 text-sm">${item.unit}</td>
                        <td class="px-4 py-3 text-sm">
                            <input type="text" value="${item.notes || ''}" onchange="updateItemNotes(${item.id}, this.value)" 
                                   class="w-full p-1 border border-gray-300 rounded text-xs">
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="approveItem(${item.id})" class="bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700 mr-1">
                                Setujui
                            </button>
                            <button onclick="rejectItem(${item.id})" class="bg-red-600 text-white px-2 py-1 rounded text-xs hover:bg-red-700">
                                Tolak
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function updateItemNotes(itemId, notes) {
            const item = statusItems.find(item => item.id === itemId);
            if (item) {
                item.notes = notes;
            }
        }

        async function approveItem(itemId) {
            const itemIndex = statusItems.findIndex(item => item.id === itemId);
            if (itemIndex !== -1) {
                const item = statusItems[itemIndex];
                
                // Kirim update ke Google Sheet
                const result = await sendToGoogleSheet('updateStatus', {
                    id: itemId,
                    approved: true,
                    ...item
                });
                
                if (result.success) {
                    // Move to store 01
                    if (!storeItems['01']) storeItems['01'] = [];
                    storeItems['01'].push({
                        ...item,
                        transaction: 'Incoming'
                    });
                    
                    // Add to history
                    historyItems.push({
                        ...item,
                        type: 'Incoming',
                        store: '01 - GENERAL STORE (ANYER)'
                    });
                    
                    // Update incoming item status
                    const incomingItem = incomingItems.find(i => i.id === itemId);
                    if (incomingItem) {
                        incomingItem.status = 'selesai';
                    }
                    
                    // Remove from status
                    statusItems.splice(itemIndex, 1);
                    
                    renderStatusTable();
                    renderIncomingTable();
                    updateDashboard();
                    
                    showNotification('Barang berhasil disetujui dan disimpan ke Google Spreadsheet!', 'success');
                } else {
                    showNotification('Error menyimpan ke Google Spreadsheet: ' + result.message, 'error');
                }
            }
        }

        function rejectItem(itemId) {
            const itemIndex = statusItems.findIndex(item => item.id === itemId);
            if (itemIndex !== -1) {
                statusItems.splice(itemIndex, 1);
                
                // Also remove from incoming
                const incomingIndex = incomingItems.findIndex(item => item.id === itemId);
                if (incomingIndex !== -1) {
                    incomingItems.splice(incomingIndex, 1);
                }
                
                renderStatusTable();
                renderIncomingTable();
                updateDashboard();
                
                alert('Barang ditolak dan dihapus dari sistem!');
            }
        }

        function renderOutgoingTable() {
            const tbody = document.getElementById('outgoingTableBody');
            tbody.innerHTML = '';
            
            outgoingItems.forEach(item => {
                const fromStore = stores.find(s => s.code === item.fromStore);
                const toStore = stores.find(s => s.code === item.toStore);
                
                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">${item.date}</td>
                        <td class="px-4 py-3 text-sm">${item.code}</td>
                        <td class="px-4 py-3 text-sm">${item.name}</td>
                        <td class="px-4 py-3 text-sm">${item.qty}</td>
                        <td class="px-4 py-3 text-sm">${item.unit}</td>
                        <td class="px-4 py-3 text-sm">${fromStore ? fromStore.code + ' - ' + fromStore.name : ''}</td>
                        <td class="px-4 py-3 text-sm">${toStore ? toStore.code + ' - ' + toStore.name : ''}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            historyItems.forEach(item => {
                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">${item.date}</td>
                        <td class="px-4 py-3 text-sm">${item.code}</td>
                        <td class="px-4 py-3 text-sm">${item.name}</td>
                        <td class="px-4 py-3 text-sm">${item.qty}</td>
                        <td class="px-4 py-3 text-sm">${item.unit}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 rounded-full text-xs ${item.type === 'Incoming' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                ${item.type}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm">${item.store}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderRecapTable() {
            const tbody = document.getElementById('recapTableBody');
            tbody.innerHTML = '';
            
            recapItems.forEach(item => {
                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm font-medium">${item.code}</td>
                        <td class="px-4 py-3 text-sm">${item.name}</td>
                        <td class="px-4 py-3 text-sm">${item.qty}</td>
                        <td class="px-4 py-3 text-sm">${item.unit}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 rounded-full text-xs ${item.qty <= item.minStock ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                ${item.minStock}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="editRecapItem('${item.code}')" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteRecapItem('${item.code}')" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderStoreCards() {
            const container = document.getElementById('storeCards');
            container.innerHTML = '';
            
            stores.forEach(store => {
                const itemCount = storeItems[store.code] ? storeItems[store.code].length : 0;
                const card = `
                    <div class="bg-white rounded-lg shadow-md p-6 card-hover cursor-pointer" onclick="openStoreDetail('${store.code}')">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-store text-white text-xl"></i>
                            </div>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-medium">
                                ${itemCount} items
                            </span>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">${store.code}</h3>
                        <p class="text-sm text-gray-600">${store.name}</p>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        function openStoreDetail(storeCode) {
            currentStoreCode = storeCode;
            const store = stores.find(s => s.code === storeCode);
            
            document.getElementById('storeDetailTitle').textContent = `${store.code} - ${store.name}`;
            
            const tbody = document.getElementById('storeDetailTableBody');
            tbody.innerHTML = '';
            
            const items = storeItems[storeCode] || [];
            items.forEach(item => {
                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">${item.date}</td>
                        <td class="px-4 py-3 text-sm">${item.code}</td>
                        <td class="px-4 py-3 text-sm">${item.name}</td>
                        <td class="px-4 py-3 text-sm">${item.qty}</td>
                        <td class="px-4 py-3 text-sm">${item.unit}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 rounded-full text-xs ${item.transaction === 'Incoming' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                ${item.transaction}
                            </span>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            // Load transfer options
            loadTransferOptions();
            
            document.getElementById('storeDetailModal').classList.remove('hidden');
        }

        function closeStoreDetailModal() {
            document.getElementById('storeDetailModal').classList.add('hidden');
        }

        function showTransferModal() {
            document.getElementById('transferModal').classList.remove('hidden');
        }

        function closeTransferModal() {
            document.getElementById('transferModal').classList.add('hidden');
        }

        function loadTransferOptions() {
            const select = document.getElementById('transferItemSelect');
            select.innerHTML = '<option value="">Pilih Barang</option>';
            
            const items = storeItems[currentStoreCode] || [];
            const uniqueItems = {};
            
            items.forEach(item => {
                if (!uniqueItems[item.code]) {
                    uniqueItems[item.code] = {
                        code: item.code,
                        name: item.name,
                        unit: item.unit,
                        totalQty: 0
                    };
                }
                uniqueItems[item.code].totalQty += item.qty;
            });
            
            Object.values(uniqueItems).forEach(item => {
                select.innerHTML += `<option value="${item.code}" data-unit="${item.unit}" data-max="${item.totalQty}">
                    ${item.code} - ${item.name} (${item.totalQty} ${item.unit})
                </option>`;
            });
        }

        // Transfer Form Handler
        document.getElementById('transferForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const itemCode = document.getElementById('transferItemSelect').value;
            const qty = parseInt(document.getElementById('transferQty').value);
            const toStore = document.getElementById('transferToStore').value;
            
            if (!itemCode || !qty || !toStore) {
                alert('Semua field harus diisi!');
                return;
            }
            
            // Find item details
            const sourceItems = storeItems[currentStoreCode] || [];
            const item = sourceItems.find(item => item.code === itemCode);
            
            if (!item) {
                alert('Barang tidak ditemukan!');
                return;
            }
            
            // Check available quantity
            const totalQty = sourceItems.filter(i => i.code === itemCode).reduce((sum, i) => sum + i.qty, 0);
            if (qty > totalQty) {
                alert('Quantity tidak mencukupi!');
                return;
            }
            
            // Create transfer record
            const transferItem = {
                id: Date.now(),
                date: new Date().toLocaleDateString('id-ID'),
                code: itemCode,
                name: item.name,
                qty: qty,
                unit: item.unit,
                fromStore: currentStoreCode,
                toStore: toStore,
                transaction: 'Transfer'
            };
            
            // Kirim ke Google Sheet
            showNotification('Menyimpan transfer ke Google Spreadsheet...', 'info');
            const outgoingResult = await sendToGoogleSheet('addOutgoing', transferItem);
            const historyResult = await sendToGoogleSheet('addToHistory', {
                ...transferItem,
                type: 'Transfer',
                store: `${currentStoreCode} → ${toStore}`
            });
            
            // Update kartu store untuk store tujuan
            const kartuStoreResult = await sendToGoogleSheet('updateKartuStore', {
                storeCode: toStore,
                storeName: stores.find(s => s.code === toStore).name,
                date: transferItem.date,
                code: transferItem.code,
                name: transferItem.name,
                qty: transferItem.qty,
                unit: transferItem.unit,
                transaction: 'Incoming'
            });
            
            if (outgoingResult.success && historyResult.success && kartuStoreResult.success) {
                // Add to outgoing
                outgoingItems.push(transferItem);
                
                // Add to destination store
                if (!storeItems[toStore]) storeItems[toStore] = [];
                storeItems[toStore].push({
                    ...transferItem,
                    transaction: 'Incoming'
                });
                
                // Remove from source store
                let remainingQty = qty;
                for (let i = sourceItems.length - 1; i >= 0 && remainingQty > 0; i--) {
                    if (sourceItems[i].code === itemCode) {
                        if (sourceItems[i].qty <= remainingQty) {
                            remainingQty -= sourceItems[i].qty;
                            sourceItems.splice(i, 1);
                        } else {
                            sourceItems[i].qty -= remainingQty;
                            remainingQty = 0;
                        }
                    }
                }
                
                // Add to history
                const fromStoreName = stores.find(s => s.code === currentStoreCode).name;
                const toStoreName = stores.find(s => s.code === toStore).name;
                
                historyItems.push({
                    ...transferItem,
                    type: 'Transfer',
                    store: `${currentStoreCode} - ${fromStoreName} → ${toStore} - ${toStoreName}`
                });
                
                // Reset form and close modal
                this.reset();
                closeTransferModal();
                
                // Refresh store detail
                openStoreDetail(currentStoreCode);
                
                showNotification('Transfer berhasil dan disimpan ke Google Spreadsheet!', 'success');
            } else {
                showNotification('Error menyimpan transfer ke Google Spreadsheet', 'error');
            }
        });

        function showAddItemModal() {
            loadUnits();
            document.getElementById('addItemModal').classList.remove('hidden');
        }

        function closeAddItemModal() {
            document.getElementById('addItemModal').classList.add('hidden');
        }

        // Add Item Form Handler
        document.getElementById('addItemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = document.getElementById('newItemCode').value;
            const name = document.getElementById('newItemName').value;
            const unit = document.getElementById('newItemUnit').value;
            const minStock = parseInt(document.getElementById('newItemMinStock').value);
            
            // Check if item already exists
            if (recapItems.find(item => item.code === code)) {
                alert('Kode barang sudah ada!');
                return;
            }
            
            recapItems.push({
                code: code,
                name: name,
                qty: 0,
                unit: unit,
                minStock: minStock
            });
            
            this.reset();
            closeAddItemModal();
            renderRecapTable();
            
            alert('Barang baru berhasil ditambahkan!');
        });

        function editRecapItem(code) {
            const item = recapItems.find(item => item.code === code);
            if (item) {
                const newName = prompt('Nama Barang:', item.name);
                const newUnit = prompt('Unit:', item.unit);
                const newMinStock = prompt('Min Stock:', item.minStock);
                
                if (newName && newUnit && newMinStock) {
                    item.name = newName;
                    item.unit = newUnit;
                    item.minStock = parseInt(newMinStock);
                    renderRecapTable();
                }
            }
        }

        function deleteRecapItem(code) {
            if (confirm('Yakin ingin menghapus barang ini?')) {
                const index = recapItems.findIndex(item => item.code === code);
                if (index !== -1) {
                    recapItems.splice(index, 1);
                    renderRecapTable();
                }
            }
        }

        function editIncomingItem(id) {
            const item = incomingItems.find(item => item.id === id);
            if (item) {
                document.getElementById('itemCode').value = item.code;
                document.getElementById('itemName').value = item.name;
                document.getElementById('itemQty').value = item.qty;
                document.getElementById('itemUnit').value = item.unit;
                document.getElementById('minStock').value = item.minStock;
                document.getElementById('itemStatus').value = item.status;
                
                deleteIncomingItem(id);
            }
        }

        function deleteIncomingItem(id) {
            if (confirm('Yakin ingin menghapus item ini?')) {
                const index = incomingItems.findIndex(item => item.id === id);
                if (index !== -1) {
                    incomingItems.splice(index, 1);
                    renderIncomingTable();
                    updateDashboard();
                }
            }
        }

        function updateDashboard() {
            document.getElementById('totalItems').textContent = recapItems.length;
            document.getElementById('pendingItems').textContent = statusItems.length;
            document.getElementById('completedItems').textContent = incomingItems.filter(item => item.status === 'selesai').length;
            document.getElementById('totalStores').textContent = stores.length;
        }

        // Settings Functions
        function showAddStoreModal() {
            document.getElementById('addStoreModal').classList.remove('hidden');
        }

        function closeAddStoreModal() {
            document.getElementById('addStoreModal').classList.add('hidden');
        }

        function showAddUnitModal() {
            document.getElementById('addUnitModal').classList.remove('hidden');
        }

        function closeAddUnitModal() {
            document.getElementById('addUnitModal').classList.add('hidden');
        }

        // Add Store Form Handler
        document.getElementById('addStoreForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = document.getElementById('newStoreCode').value;
            const name = document.getElementById('newStoreName').value;
            
            if (stores.find(store => store.code === code)) {
                alert('Kode store sudah ada!');
                return;
            }
            
            stores.push({code: code, name: name});
            storeItems[code] = [];
            
            this.reset();
            closeAddStoreModal();
            loadStores();
            renderStoreList();
            updateDashboard();
            
            alert('Store berhasil ditambahkan!');
        });

        // Add Unit Form Handler
        document.getElementById('addUnitForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const unitName = document.getElementById('newUnitName').value;
            
            if (units.includes(unitName)) {
                alert('Unit sudah ada!');
                return;
            }
            
            units.push(unitName);
            
            this.reset();
            closeAddUnitModal();
            loadUnits();
            renderUnitList();
            
            alert('Unit berhasil ditambahkan!');
        });

        function renderStoreList() {
            const container = document.getElementById('storeList');
            container.innerHTML = '';
            
            stores.forEach(store => {
                const item = `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                        <span class="text-sm">${store.code} - ${store.name}</span>
                        <div>
                            <button onclick="editStore('${store.code}')" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteStore('${store.code}')" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += item;
            });
        }

        function renderUnitList() {
            const container = document.getElementById('unitList');
            container.innerHTML = '';
            
            units.forEach(unit => {
                const item = `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                        <span class="text-sm">${unit}</span>
                        <button onclick="deleteUnit('${unit}')" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.innerHTML += item;
            });
        }

        function editStore(code) {
            const store = stores.find(s => s.code === code);
            if (store) {
                const newName = prompt('Nama Store:', store.name);
                if (newName) {
                    store.name = newName;
                    renderStoreList();
                    loadStores();
                }
            }
        }

        function deleteStore(code) {
            if (confirm('Yakin ingin menghapus store ini?')) {
                const index = stores.findIndex(s => s.code === code);
                if (index !== -1) {
                    stores.splice(index, 1);
                    delete storeItems[code];
                    renderStoreList();
                    loadStores();
                    updateDashboard();
                }
            }
        }

        function deleteUnit(unit) {
            if (confirm('Yakin ingin menghapus unit ini?')) {
                const index = units.indexOf(unit);
                if (index !== -1) {
                    units.splice(index, 1);
                    renderUnitList();
                    loadUnits();
                }
            }
        }

        // Export Functions
        function exportRecapToExcel() {
            const ws = XLSX.utils.json_to_sheet(recapItems.map(item => ({
                'Kode Barang': item.code,
                'Nama Barang': item.name,
                'Quantity': item.qty,
                'Unit': item.unit,
                'Min Stock': item.minStock
            })));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Rekapitulasi');
            XLSX.writeFile(wb, 'rekapitulasi_barang.xlsx');
        }

        function exportRecapToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('Rekapitulasi Data Barang', 20, 20);
            
            let y = 40;
            doc.setFontSize(10);
            doc.text('Kode', 20, y);
            doc.text('Nama Barang', 50, y);
            doc.text('Qty', 120, y);
            doc.text('Unit', 140, y);
            doc.text('Min Stock', 160, y);
            
            y += 10;
            recapItems.forEach(item => {
                doc.text(item.code, 20, y);
                doc.text(item.name, 50, y);
                doc.text(item.qty.toString(), 120, y);
                doc.text(item.unit, 140, y);
                doc.text(item.minStock.toString(), 160, y);
                y += 8;
                
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });
            
            doc.save('rekapitulasi_barang.pdf');
        }

        function exportStoreToExcel() {
            const storeCode = document.getElementById('storeSelect').value;
            if (!storeCode) {
                alert('Pilih store terlebih dahulu!');
                return;
            }
            
            const store = stores.find(s => s.code === storeCode);
            const items = storeItems[storeCode] || [];
            
            const ws = XLSX.utils.json_to_sheet(items.map(item => ({
                'Tanggal': item.date,
                'Kode Barang': item.code,
                'Nama Barang': item.name,
                'Quantity': item.qty,
                'Unit': item.unit,
                'Transaksi': item.transaction
            })));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Kartu Store');
            XLSX.writeFile(wb, `kartu_store_${storeCode}.xlsx`);
        }

        function exportStoreToPDF() {
            const storeCode = document.getElementById('storeSelect').value;
            if (!storeCode) {
                alert('Pilih store terlebih dahulu!');
                return;
            }
            
            const store = stores.find(s => s.code === storeCode);
            const items = storeItems[storeCode] || [];
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text(`Kartu Store ${store.code} - ${store.name}`, 20, 20);
            
            let y = 40;
            doc.setFontSize(10);
            doc.text('Tanggal', 20, y);
            doc.text('Kode', 50, y);
            doc.text('Nama Barang', 80, y);
            doc.text('Qty', 130, y);
            doc.text('Unit', 150, y);
            doc.text('Transaksi', 170, y);
            
            y += 10;
            items.forEach(item => {
                doc.text(item.date, 20, y);
                doc.text(item.code, 50, y);
                doc.text(item.name.substring(0, 20), 80, y);
                doc.text(item.qty.toString(), 130, y);
                doc.text(item.unit, 150, y);
                doc.text(item.transaction, 170, y);
                y += 8;
                
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });
            
            doc.save(`kartu_store_${storeCode}.pdf`);
        }

        // Auto-sync setiap 5 menit
        setInterval(syncWithGoogleSheet, 5 * 60 * 1000);

        // Responsive handling
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024) {
                document.getElementById('sidebar').classList.remove('-translate-x-full');
                document.getElementById('overlay').classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9803899da641fdeb',t:'MTc1ODA1ODk4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
