<!-- Navigation Tabs -->
<nav class="bg-white border-b border-gray-200 sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-6">
        <div class="flex space-x-1">
            <button onclick="showTab('incoming')" id="tab-incoming" class="tab-active text-white px-6 py-4 font-medium rounded-t-lg transition-all">
                📥 Barang Masuk
            </button>
            <button onclick="showTab('outgoing')" id="tab-outgoing" class="bg-gray-100 text-gray-700 hover:bg-gray-200 px-6 py-4 font-medium rounded-t-lg transition-all">
                📤 Barang Keluar
            </button>
            <button onclick="showTab('stock')" id="tab-stock" class="bg-gray-100 text-gray-700 hover:bg-gray-200 px-6 py-4 font-medium rounded-t-lg transition-all">
                📋 Kartu Stok
            </button>
            <button onclick="showTab('history')" id="tab-history" class="bg-gray-100 text-gray-700 hover:bg-gray-200 px-6 py-4 font-medium rounded-t-lg transition-all">
                📊 Riwayat
            </button>
        </div>
    </div>
</nav>

<main class="max-w-7xl mx-auto p-6">
    <!-- Incoming Goods Tab -->
    <div id="incoming-tab" class="animate-fade-in">
        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Form Barang Masuk -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    📥 <span class="ml-2">Form Barang Masuk</span>
                </h2>
                <form id="incoming-form" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="incoming-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">No. Dokumen</label>
                            <input type="text" id="incoming-doc" placeholder="DOC-001" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                        <input type="text" id="incoming-item" placeholder="Masukkan nama barang" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah</label>
                            <input type="number" id="incoming-qty" placeholder="0" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Satuan</label>
                            <select id="incoming-unit" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">Pilih Satuan</option>
                                <option value="pcs">Pcs</option>
                                <option value="kg">Kg</option>
                                <option value="liter">Liter</option>
                                <option value="box">Box</option>
                                <option value="pack">Pack</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Harga Satuan</label>
                            <input type="number" id="incoming-price" placeholder="0" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kode Store</label>
                            <select id="incoming-store" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">Pilih Store</option>
                                <option value="01">01 - GENERAL STORE (ANYER)</option>
                                <option value="02">02 - General store (JKT)</option>
                                <option value="03">03 - MAIN KITCHEN STORAGE</option>
                                <option value="04">04 - F&B ADMIN</option>
                                <option value="05">05 - HOUSEKEEPING</option>
                                <option value="10">10 - ENGINEERING STORE</option>
                                <option value="11">11 - PROJECT STORE</option>
                                <option value="12">12 - ADMIN & GENERAL</option>
                                <option value="13">13 - SALES & MARKETING</option>
                                <option value="14">14 - SECURITY</option>
                                <option value="15">15 - FRONT OFFICE</option>
                                <option value="16">16 - SPA</option>
                                <option value="17">17 - HRD</option>
                                <option value="21">21 - D'BISTRO</option>
                                <option value="22">22 - KOREAN STORE (KANTIN)</option>
                                <option value="23">23 - DBAR STORE</option>
                                <option value="24">24 - LIQUOR STORE</option>
                                <option value="25">25 - SOUVENIR SHOP</option>
                                <option value="26">26 - SPORT & RECREATION</option>
                                <option value="27">27 - JAPANESE STORE</option>
                                <option value="28">28 - DRAGON BEACH CLUB STORE</option>
                                <option value="29">29 - SUNSET GRILL STORE</option>
                                <option value="31">31 - BANQUET STORE</option>
                                <option value="40">40 - LAUNDRY STORE</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Supplier</label>
                            <input type="text" id="incoming-supplier" placeholder="Nama supplier" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                        <textarea id="incoming-notes" placeholder="Keterangan tambahan..." rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                    <button type="submit" class="w-full gradient-bg text-white py-3 px-6 rounded-lg font-medium hover:opacity-90 transition-all transform hover:scale-105">
                        ✅ Simpan Barang Masuk
                    </button>
                </form>
            </div>

            <!-- Daftar Barang Masuk Hari Ini -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-xl font-bold text-gray-800 mb-4">📋 Barang Masuk Hari Ini</h3>
                <div id="incoming-list" class="space-y-3 max-h-96 overflow-y-auto">
                    <div class="text-gray-500 text-center py-8">Belum ada data barang masuk hari ini</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Outgoing Goods Tab -->
    <div id="outgoing-tab" class="hidden animate-fade-in">
        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Form Barang Keluar -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    📤 <span class="ml-2">Form Barang Keluar</span>
                </h2>
                <form id="outgoing-form" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="outgoing-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">No. Dokumen</label>
                            <input type="text" id="outgoing-doc" placeholder="OUT-001" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                        <select id="outgoing-item" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                            <option value="">Pilih barang dari stok</option>
                        </select>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Keluar</label>
                            <input type="number" id="outgoing-qty" placeholder="0" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Stok Tersedia</label>
                            <input type="text" id="available-stock" readonly class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-600">
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kode Store Tujuan</label>
                            <select id="outgoing-store" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                                <option value="">Pilih Store Tujuan</option>
                                <option value="01">01 - GENERAL STORE (ANYER)</option>
                                <option value="02">02 - General store (JKT)</option>
                                <option value="03">03 - MAIN KITCHEN STORAGE</option>
                                <option value="04">04 - F&B ADMIN</option>
                                <option value="05">05 - HOUSEKEEPING</option>
                                <option value="10">10 - ENGINEERING STORE</option>
                                <option value="11">11 - PROJECT STORE</option>
                                <option value="12">12 - ADMIN & GENERAL</option>
                                <option value="13">13 - SALES & MARKETING</option>
                                <option value="14">14 - SECURITY</option>
                                <option value="15">15 - FRONT OFFICE</option>
                                <option value="16">16 - SPA</option>
                                <option value="17">17 - HRD</option>
                                <option value="21">21 - D'BISTRO</option>
                                <option value="22">22 - KOREAN STORE (KANTIN)</option>
                                <option value="23">23 - DBAR STORE</option>
                                <option value="24">24 - LIQUOR STORE</option>
                                <option value="25">25 - SOUVENIR SHOP</option>
                                <option value="26">26 - SPORT & RECREATION</option>
                                <option value="27">27 - JAPANESE STORE</option>
                                <option value="28">28 - DRAGON BEACH CLUB STORE</option>
                                <option value="29">29 - SUNSET GRILL STORE</option>
                                <option value="31">31 - BANQUET STORE</option>
                                <option value="40">40 - LAUNDRY STORE</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tujuan/Penerima</label>
                            <input type="text" id="outgoing-recipient" placeholder="Nama penerima atau tujuan" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                        <textarea id="outgoing-notes" placeholder="Keterangan tambahan..." rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-lg font-medium transition-all transform hover:scale-105">
                        📤 Keluarkan Barang
                    </button>
                </form>
            </div>

            <!-- Daftar Barang Keluar Hari Ini -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-xl font-bold text-gray-800 mb-4">📋 Barang Keluar Hari Ini</h3>
                <div id="outgoing-list" class="space-y-3 max-h-96 overflow-y-auto">
                    <div class="text-gray-500 text-center py-8">Belum ada data barang keluar hari ini</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Card Tab -->
    <div id="stock-tab" class="hidden animate-fade-in">
        <div class="bg-white rounded-xl p-6 card-shadow">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    📋 <span class="ml-2">Kartu Stok</span>
                </h2>
                <div class="flex gap-3">
                    <input type="text" id="stock-search" placeholder="🔍 Cari barang..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <button onclick="syncToGoogleSheets()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all">
                        📤 Sync ke Sheets
                    </button>
                    <button onclick="exportStock()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-all">
                        📊 Export CSV
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">Nama Barang</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Store</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Stok Awal</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Masuk</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Keluar</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Stok Akhir</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Satuan</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Status</th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-body">
                        <tr>
                            <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                Belum ada data stok. Mulai dengan menambahkan barang masuk.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- History Tab -->
    <div id="history-tab" class="hidden animate-fade-in">
        <div class="bg-white rounded-xl p-6 card-shadow">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    📊 <span class="ml-2">Riwayat Transaksi</span>
                </h2>
                <div class="flex gap-3">
                    <select id="history-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="all">Semua Transaksi</option>
                        <option value="incoming">Barang Masuk</option>
                        <option value="outgoing">Barang Keluar</option>
                    </select>
                    <input type="date" id="history-date" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <button onclick="syncToGoogleSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-all">
                        📤 Sync ke Sheets
                    </button>
                    <button onclick="exportHistory()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all">
                        📊 Export CSV
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">Tanggal</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">No. Dokumen</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">Jenis</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">Store</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">Barang</th>
                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">Jumlah</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">Supplier/Penerima</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        <tr>
                            <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                Belum ada riwayat transaksi.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<script>
    // Data storage
    let warehouseData = {
        incoming: JSON.parse(localStorage.getItem('warehouse_incoming') || '[]'),
        outgoing: JSON.parse(localStorage.getItem('warehouse_outgoing') || '[]'),
        stock: JSON.parse(localStorage.getItem('warehouse_stock') || '{}')
    };

    // Store mapping
    const storeMapping = {
        '01': 'GENERAL STORE (ANYER)',
        '02': 'General store (JKT)',
        '03': 'MAIN KITCHEN STORAGE',
        '04': 'F&B ADMIN',
        '05': 'HOUSEKEEPING',
        '10': 'ENGINEERING STORE',
        '11': 'PROJECT STORE',
        '12': 'ADMIN & GENERAL',
        '13': 'SALES & MARKETING',
        '14': 'SECURITY',
        '15': 'FRONT OFFICE',
        '16': 'SPA',
        '17': 'HRD',
        '21': 'D\'BISTRO',
        '22': 'KOREAN STORE (KANTIN)',
        '23': 'DBAR STORE',
        '24': 'LIQUOR STORE',
        '25': 'SOUVENIR SHOP',
        '26': 'SPORT & RECREATION',
        '27': 'JAPANESE STORE',
        '28': 'DRAGON BEACH CLUB STORE',
        '29': 'SUNSET GRILL STORE',
        '31': 'BANQUET STORE',
        '40': 'LAUNDRY STORE'
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Set today's date as default
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('incoming-date').value = today;
        document.getElementById('outgoing-date').value = today;
        
        updateDisplays();
        setupEventListeners();
    });

    function setupEventListeners() {
        // Form submissions
        document.getElementById('incoming-form').addEventListener('submit', handleIncomingSubmit);
        document.getElementById('outgoing-form').addEventListener('submit', handleOutgoingSubmit);
        
        // Outgoing item selection
        document.getElementById('outgoing-item').addEventListener('change', updateAvailableStock);
        
        // Search and filters
        document.getElementById('stock-search').addEventListener('input', filterStockTable);
        document.getElementById('history-filter').addEventListener('change', filterHistory);
        document.getElementById('history-date').addEventListener('change', filterHistory);
    }

    function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('[id$="-tab"]').forEach(tab => tab.classList.add('hidden'));
        
        // Remove active class from all tab buttons
        document.querySelectorAll('[id^="tab-"]').forEach(btn => {
            btn.classList.remove('tab-active', 'text-white');
            btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
        });
        
        // Show selected tab
        document.getElementById(tabName + '-tab').classList.remove('hidden');
        
        // Add active class to selected button
        const activeBtn = document.getElementById('tab-' + tabName);
        activeBtn.classList.add('tab-active', 'text-white');
        activeBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
        
        // Update displays when switching tabs
        updateDisplays();
    }

    function handleIncomingSubmit(e) {
        e.preventDefault();
        
        const formData = {
            id: Date.now(),
            date: document.getElementById('incoming-date').value,
            docNumber: document.getElementById('incoming-doc').value,
            itemName: document.getElementById('incoming-item').value,
            quantity: parseInt(document.getElementById('incoming-qty').value),
            unit: document.getElementById('incoming-unit').value,
            price: parseFloat(document.getElementById('incoming-price').value) || 0,
            storeCode: document.getElementById('incoming-store').value,
            storeName: storeMapping[document.getElementById('incoming-store').value],
            supplier: document.getElementById('incoming-supplier').value,
            notes: document.getElementById('incoming-notes').value,
            type: 'incoming'
        };
        
        // Add to incoming data
        warehouseData.incoming.push(formData);
        
        // Update stock
        const stockKey = formData.storeCode + '_' + formData.itemName + '_' + formData.unit;
        if (!warehouseData.stock[stockKey]) {
            warehouseData.stock[stockKey] = {
                itemName: formData.itemName,
                unit: formData.unit,
                storeCode: formData.storeCode,
                storeName: formData.storeName,
                initialStock: 0,
                incoming: 0,
                outgoing: 0,
                currentStock: 0
            };
        }
        
        warehouseData.stock[stockKey].incoming += formData.quantity;
        warehouseData.stock[stockKey].currentStock += formData.quantity;
        
        // Save to localStorage
        saveData();
        
        // Reset form and update displays
        document.getElementById('incoming-form').reset();
        document.getElementById('incoming-date').value = new Date().toISOString().split('T')[0];
        updateDisplays();
        
        // Show success message
        showNotification('✅ Barang masuk berhasil disimpan!', 'success');
    }

    function handleOutgoingSubmit(e) {
        e.preventDefault();
        
        const itemKey = document.getElementById('outgoing-item').value;
        const quantity = parseInt(document.getElementById('outgoing-qty').value);
        
        if (!itemKey || !warehouseData.stock[itemKey]) {
            showNotification('❌ Pilih barang yang valid!', 'error');
            return;
        }
        
        if (quantity > warehouseData.stock[itemKey].currentStock) {
            showNotification('❌ Stok tidak mencukupi!', 'error');
            return;
        }
        
        const formData = {
            id: Date.now(),
            date: document.getElementById('outgoing-date').value,
            docNumber: document.getElementById('outgoing-doc').value,
            itemName: warehouseData.stock[itemKey].itemName,
            quantity: quantity,
            unit: warehouseData.stock[itemKey].unit,
            storeCode: document.getElementById('outgoing-store').value,
            storeName: storeMapping[document.getElementById('outgoing-store').value],
            recipient: document.getElementById('outgoing-recipient').value,
            notes: document.getElementById('outgoing-notes').value,
            type: 'outgoing'
        };
        
        // Add to outgoing data
        warehouseData.outgoing.push(formData);
        
        // Update stock
        warehouseData.stock[itemKey].outgoing += quantity;
        warehouseData.stock[itemKey].currentStock -= quantity;
        
        // Save to localStorage
        saveData();
        
        // Reset form and update displays
        document.getElementById('outgoing-form').reset();
        document.getElementById('outgoing-date').value = new Date().toISOString().split('T')[0];
        updateDisplays();
        
        // Show success message
        showNotification('✅ Barang keluar berhasil dicatat!', 'success');
    }

    function updateDisplays() {
        updateIncomingList();
        updateOutgoingList();
        updateOutgoingItemOptions();
        updateStockTable();
        updateHistoryTable();
    }

    function updateIncomingList() {
        const today = new Date().toISOString().split('T')[0];
        const todayIncoming = warehouseData.incoming.filter(item => item.date === today);
        
        const listContainer = document.getElementById('incoming-list');
        
        if (todayIncoming.length === 0) {
            listContainer.innerHTML = '<div class="text-gray-500 text-center py-8">Belum ada data barang masuk hari ini</div>';
            return;
        }
        
        listContainer.innerHTML = todayIncoming.map(item => `
            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-semibold text-gray-800">${item.itemName}</h4>
                        <p class="text-sm text-gray-600">${item.quantity} ${item.unit} - ${item.supplier}</p>
                        <p class="text-xs text-gray-500">${item.docNumber}</p>
                    </div>
                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                        Masuk
                    </span>
                </div>
            </div>
        `).join('');
    }

    function updateOutgoingList() {
        const today = new Date().toISOString().split('T')[0];
        const todayOutgoing = warehouseData.outgoing.filter(item => item.date === today);
        
        const listContainer = document.getElementById('outgoing-list');
        
        if (todayOutgoing.length === 0) {
            listContainer.innerHTML = '<div class="text-gray-500 text-center py-8">Belum ada data barang keluar hari ini</div>';
            return;
        }
        
        listContainer.innerHTML = todayOutgoing.map(item => `
            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-semibold text-gray-800">${item.itemName}</h4>
                        <p class="text-sm text-gray-600">${item.quantity} ${item.unit} - ${item.recipient}</p>
                        <p class="text-xs text-gray-500">${item.docNumber}</p>
                    </div>
                    <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">
                        Keluar
                    </span>
                </div>
            </div>
        `).join('');
    }

    function updateOutgoingItemOptions() {
        const select = document.getElementById('outgoing-item');
        const availableItems = Object.entries(warehouseData.stock)
            .filter(([key, stock]) => stock.currentStock > 0);
        
        select.innerHTML = '<option value="">Pilih barang dari stok</option>' +
            availableItems.map(([key, stock]) => 
                `<option value="${key}">${stock.storeName} - ${stock.itemName} (${stock.currentStock} ${stock.unit})</option>`
            ).join('');
    }

    function updateAvailableStock() {
        const selectedKey = document.getElementById('outgoing-item').value;
        const stockInput = document.getElementById('available-stock');
        
        if (selectedKey && warehouseData.stock[selectedKey]) {
            const stock = warehouseData.stock[selectedKey];
            stockInput.value = `${stock.currentStock} ${stock.unit}`;
        } else {
            stockInput.value = '';
        }
    }

    function updateStockTable() {
        const tbody = document.getElementById('stock-table-body');
        const stockEntries = Object.entries(warehouseData.stock);
        
        if (stockEntries.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                        Belum ada data stok. Mulai dengan menambahkan barang masuk.
                    </td>
                </tr>
            `;
            return;
        }
        
        tbody.innerHTML = stockEntries.map(([key, stock]) => {
            const status = stock.currentStock <= 5 ? 'Stok Rendah' : 
                         stock.currentStock === 0 ? 'Habis' : 'Normal';
            const statusClass = stock.currentStock <= 5 ? 'bg-yellow-100 text-yellow-800' :
                              stock.currentStock === 0 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800';
            
            return `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-3">${stock.itemName}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center">${stock.storeCode} - ${stock.storeName}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center">${stock.initialStock}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center text-green-600 font-medium">${stock.incoming}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center text-red-600 font-medium">${stock.outgoing}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center font-bold">${stock.currentStock}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center">${stock.unit}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${statusClass}">
                            ${status}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    function updateHistoryTable() {
        const tbody = document.getElementById('history-table-body');
        const allTransactions = [
            ...warehouseData.incoming.map(item => ({...item, type: 'incoming'})),
            ...warehouseData.outgoing.map(item => ({...item, type: 'outgoing'}))
        ].sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (allTransactions.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                        Belum ada riwayat transaksi.
                    </td>
                </tr>
            `;
            return;
        }
        
        tbody.innerHTML = allTransactions.map(transaction => {
            const typeLabel = transaction.type === 'incoming' ? 'Masuk' : 'Keluar';
            const typeClass = transaction.type === 'incoming' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
            const supplierOrRecipient = transaction.supplier || transaction.recipient || '-';
            
            return `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-3">${new Date(transaction.date).toLocaleDateString('id-ID')}</td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.docNumber}</td>
                    <td class="border border-gray-300 px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${typeClass}">
                            ${typeLabel}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.storeCode} - ${transaction.storeName}</td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.itemName}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center">${transaction.quantity} ${transaction.unit}</td>
                    <td class="border border-gray-300 px-4 py-3">${supplierOrRecipient}</td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.notes || '-'}</td>
                </tr>
            `;
        }).join('');
    }

    function filterStockTable() {
        const searchTerm = document.getElementById('stock-search').value.toLowerCase();
        const rows = document.querySelectorAll('#stock-table-body tr');
        
        rows.forEach(row => {
            const itemName = row.cells[0]?.textContent.toLowerCase() || '';
            if (itemName.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    function filterHistory() {
        const filterType = document.getElementById('history-filter').value;
        const filterDate = document.getElementById('history-date').value;
        
        let filteredTransactions = [
            ...warehouseData.incoming.map(item => ({...item, type: 'incoming'})),
            ...warehouseData.outgoing.map(item => ({...item, type: 'outgoing'}))
        ];
        
        if (filterType !== 'all') {
            filteredTransactions = filteredTransactions.filter(t => t.type === filterType);
        }
        
        if (filterDate) {
            filteredTransactions = filteredTransactions.filter(t => t.date === filterDate);
        }
        
        filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        const tbody = document.getElementById('history-table-body');
        
        if (filteredTransactions.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                        Tidak ada data sesuai filter.
                    </td>
                </tr>
            `;
            return;
        }
        
        tbody.innerHTML = filteredTransactions.map(transaction => {
            const typeLabel = transaction.type === 'incoming' ? 'Masuk' : 'Keluar';
            const typeClass = transaction.type === 'incoming' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
            const supplierOrRecipient = transaction.supplier || transaction.recipient || '-';
            
            return `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-3">${new Date(transaction.date).toLocaleDateString('id-ID')}</td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.docNumber}</td>
                    <td class="border border-gray-300 px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${typeClass}">
                            ${typeLabel}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.storeCode} - ${transaction.storeName}</td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.itemName}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center">${transaction.quantity} ${transaction.unit}</td>
                    <td class="border border-gray-300 px-4 py-3">${supplierOrRecipient}</td>
                    <td class="border border-gray-300 px-4 py-3">${transaction.notes || '-'}</td>
                </tr>
            `;
        }).join('');
    }

    // Google Sheets Configuration
    const GOOGLE_SHEETS_CONFIG = {
        // Ganti dengan URL Web App Google Apps Script Anda
        webAppUrl: 'https://script.google.com/macros/s/AKfycbxi3XZ4MhR4WZ3I3nvuZ9zVpqTrLydxp-zM1V6ZP0ImW3G_8XEFvlsdop7lJNaZGN_x/exec',
        enabled: false // Set ke true setelah setup Google Apps Script
    };

    function syncToGoogleSheets() {
        if (!GOOGLE_SHEETS_CONFIG.enabled) {
            showNotification('⚠️ Integrasi Google Sheets belum dikonfigurasi!', 'error');
            return;
        }

        const allData = {
            incoming: warehouseData.incoming,
            outgoing: warehouseData.outgoing,
            stock: warehouseData.stock,
            timestamp: new Date().toISOString()
        };

        showNotification('📤 Mengirim data ke Google Sheets...', 'info');

        fetch(GOOGLE_SHEETS_CONFIG.webAppUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(allData)
        })
        .then(() => {
            showNotification('✅ Data berhasil dikirim ke Google Sheets!', 'success');
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('❌ Gagal mengirim data ke Google Sheets!', 'error');
        });
    }

    function exportStock() {
        const stockData = Object.values(warehouseData.stock);
        const csvContent = "data:text/csv;charset=utf-8," + 
            "Nama Barang,Store,Stok Awal,Masuk,Keluar,Stok Akhir,Satuan,Status\n" +
            stockData.map(stock => {
                const status = stock.currentStock <= 5 ? 'Stok Rendah' : 
                             stock.currentStock === 0 ? 'Habis' : 'Normal';
                return `"${stock.itemName}","${stock.storeCode} - ${stock.storeName}",${stock.initialStock},${stock.incoming},${stock.outgoing},${stock.currentStock},"${stock.unit}","${status}"`;
            }).join("\n");
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `kartu_stok_${new Date().toISOString().split('T')[0]}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('📊 Data stok berhasil diekspor!', 'success');
    }

    function exportHistory() {
        const allTransactions = [
            ...warehouseData.incoming.map(item => ({...item, type: 'incoming'})),
            ...warehouseData.outgoing.map(item => ({...item, type: 'outgoing'}))
        ].sort((a, b) => new Date(b.date) - new Date(a.date));
        
        const csvContent = "data:text/csv;charset=utf-8," + 
            "Tanggal,No Dokumen,Jenis,Store,Barang,Jumlah,Satuan,Supplier/Penerima,Keterangan\n" +
            allTransactions.map(t => {
                const typeLabel = t.type === 'incoming' ? 'Masuk' : 'Keluar';
                const supplierOrRecipient = t.supplier || t.recipient || '';
                return `"${t.date}","${t.docNumber}","${typeLabel}","${t.storeCode} - ${t.storeName}","${t.itemName}",${t.quantity},"${t.unit}","${supplierOrRecipient}","${t.notes || ''}"`;
            }).join("\n");
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `riwayat_transaksi_${new Date().toISOString().split('T')[0]}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('📊 Riwayat transaksi berhasil diekspor!', 'success');
    }

    function saveData() {
        localStorage.setItem('warehouse_incoming', JSON.stringify(warehouseData.incoming));
        localStorage.setItem('warehouse_outgoing', JSON.stringify(warehouseData.outgoing));
        localStorage.setItem('warehouse_stock', JSON.stringify(warehouseData.stock));
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        const bgColor = type === 'success' ? 'bg-green-600' : 
                       type === 'error' ? 'bg-red-600' : 
                       type === 'info' ? 'bg-blue-600' : 'bg-gray-600';
        
        notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium transform transition-all duration-300 ${bgColor}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => document.body.removeChild(notification), 300);
        }, 3000);
    }
</script>