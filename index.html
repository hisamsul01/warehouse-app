<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Gudang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .sidebar-collapsed { width: 4rem; }
        .sidebar-expanded { width: 16rem; }
        .menu-text { opacity: 1; transition: opacity 0.3s; }
        .sidebar-collapsed .menu-text { opacity: 0; }
        .print-area { display: none; }
        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
        }
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .sync-connected { background: #10b981; color: white; }
        .sync-disconnected { background: #ef4444; color: white; }
        .sync-syncing { background: #f59e0b; color: white; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sync Status Indicator -->
    <div id="syncStatus" class="sync-indicator sync-disconnected">
        ⚠️ Tidak Terhubung ke Google Sheets
    </div>

    <!-- Google Sheets Setup Modal -->
    <div id="sheetsSetupModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-8 w-96 shadow-2xl max-h-96 overflow-y-auto">
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Setup Google Sheets</h2>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-medium mb-2">Google Sheets API Key</label>
                <input type="text" id="apiKey" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Masukkan API Key">
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-medium mb-2">Spreadsheet ID</label>
                <input type="text" id="spreadsheetId" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ID Spreadsheet (opsional)">
                <small class="text-gray-500">Kosongkan untuk membuat spreadsheet baru</small>
            </div>
            
            <div class="flex gap-2">
                <button onclick="setupGoogleSheets()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200">Setup</button>
                <button onclick="closeSetupModal()" class="flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700 transition duration-200">Batal</button>
            </div>
            
            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                <h4 class="font-semibold text-blue-800 mb-2">Cara Setup:</h4>
                <ol class="text-sm text-blue-700 space-y-1">
                    <li>1. Buka Google Cloud Console</li>
                    <li>2. Aktifkan Google Sheets API</li>
                    <li>3. Buat API Key</li>
                    <li>4. Masukkan API Key di atas</li>
                    <li>5. Klik Setup untuk mulai</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 w-96 shadow-2xl">
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Login Sistem Gudang</h2>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Username</label>
                    <input type="text" id="loginUsername" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200">Login</button>
            </form>
            <div id="loginError" class="mt-4 text-red-600 text-sm text-center hidden"></div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="mainContainer" class="hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="fixed left-0 top-0 h-full bg-white shadow-lg transition-all duration-300 sidebar-expanded z-40">
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h1 class="menu-text text-xl font-bold text-gray-800">Sistem Gudang</h1>
                    <button id="toggleSidebar" class="p-2 rounded-lg hover:bg-gray-100">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <nav class="mt-4">
                <a href="#" onclick="showMenu('penerimaan')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span class="menu-text">Penerimaan Barang</span>
                </a>
                <a href="#" onclick="showMenu('transfer')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                    </svg>
                    <span class="menu-text">Transfer Barang</span>
                </a>
                <a href="#" onclick="showMenu('outlet')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    <span class="menu-text">Outlet</span>
                </a>
                <a href="#" onclick="showMenu('status')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="menu-text">Status</span>
                </a>
                <a href="#" onclick="showMenu('database')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                    </svg>
                    <span class="menu-text">Database</span>
                </a>
                <a href="#" onclick="showMenu('riwayat')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="menu-text">Riwayat</span>
                </a>
                <a href="#" onclick="showMenu('laporan')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span class="menu-text">Laporan</span>
                </a>
                <a href="#" onclick="showMenu('user')" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>
                    </svg>
                    <span class="menu-text">User Management</span>
                </a>
                <a href="#" onclick="showSheetsSetup()" class="flex items-center px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span class="menu-text">Google Sheets</span>
                </a>
            </nav>
            
            <div class="absolute bottom-4 left-4 right-4">
                <button onclick="logout()" class="w-full flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    <span class="menu-text">Logout</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="ml-64 transition-all duration-300">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 p-4">
                <div class="flex justify-between items-center">
                    <h2 id="pageTitle" class="text-2xl font-semibold text-gray-800">Dashboard</h2>
                    <button onclick="manualSync()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Sync Manual
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <main class="p-6">
                <!-- Penerimaan Barang -->
                <div id="penerimaanContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Form Penerimaan Barang</h3>
                        <form id="penerimaanForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                                <input type="date" id="penerimaanTanggal" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                                <input type="text" id="penerimaanKode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                                <input type="text" id="penerimaanNama" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
                                <input type="number" id="penerimaanQty" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Unit</label>
                                <input type="text" id="penerimaanUnit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                <select id="penerimaanStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <option value="">Pilih Status</option>
                                    <option value="Diterima">Diterima</option>
                                    <option value="Ditolak">Ditolak</option>
                                    <option value="Pending">Pending</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Simpan</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Transfer Barang -->
                <div id="transferContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Form Transfer Barang</h3>
                        <form id="transferForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                                <input type="date" id="transferTanggal" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                                <input type="text" id="transferKode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                                <input type="text" id="transferNama" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
                                <input type="number" id="transferQty" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Unit</label>
                                <input type="text" id="transferUnit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Outlet</label>
                                <select id="transferOutlet" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <option value="">Pilih Outlet</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Transfer</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Outlet -->
                <div id="outletContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Data Outlet</h3>
                        <form id="outletForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kode Outlet</label>
                                <input type="text" id="outletKode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Outlet</label>
                                <input type="text" id="outletNama" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Tambah Outlet</button>
                            </div>
                        </form>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Outlet</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Outlet</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="outletTable" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Status -->
                <div id="statusContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Status Barang Pending/Ditolak</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="statusTable" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Database -->
                <div id="databaseContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Database Barang</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="databaseTable" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Riwayat -->
                <div id="riwayatContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Riwayat Transaksi</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                                    </tr>
                                </thead>
                                <tbody id="riwayatTable" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Laporan -->
                <div id="laporanContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Download Laporan</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button onclick="downloadPDF()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition duration-200 flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Download PDF
                            </button>
                            <button onclick="downloadExcel()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200 flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Download Excel
                            </button>
                            <button onclick="printReport()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                                </svg>
                                Print
                            </button>
                        </div>
                    </div>
                </div>

                <!-- User Management -->
                <div id="userContent" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">User Management</h3>
                        <form id="userForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input type="text" id="userUsername" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" id="userPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Tambah User</button>
                            </div>
                        </form>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="userTable" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Print Area -->
    <div class="print-area">
        <h1>Laporan Sistem Gudang</h1>
        <div id="printContent"></div>
    </div>

    <script>
        // Google Sheets Configuration
        let GOOGLE_API_KEY = localStorage.getItem('googleApiKey') || '';
        let SPREADSHEET_ID = localStorage.getItem('spreadsheetId') || '';
        let isGoogleSheetsConnected = false;
        let syncInterval = null;

        // Data Storage
        let database = JSON.parse(localStorage.getItem('database')) || [];
        let outlets = JSON.parse(localStorage.getItem('outlets')) || [];
        let statusItems = JSON.parse(localStorage.getItem('statusItems')) || [];
        let riwayat = JSON.parse(localStorage.getItem('riwayat')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { username: 'admin', password: 'admin123' }
        ];
        let currentUser = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('penerimaanTanggal').value = today;
            document.getElementById('transferTanggal').value = today;
            
            // Setup event listeners
            setupEventListeners();
            
            // Load data
            loadOutletDropdown();
            loadTables();
            
            // Initialize Google Sheets if configured
            if (GOOGLE_API_KEY) {
                initializeGoogleSheets();
            }
        });

        // Google Sheets Functions
        function initializeGoogleSheets() {
            gapi.load('client', async () => {
                try {
                    await gapi.client.init({
                        apiKey: GOOGLE_API_KEY,
                        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
                    });
                    
                    if (SPREADSHEET_ID) {
                        // Test connection
                        await testConnection();
                    } else {
                        // Create new spreadsheet
                        await createSpreadsheet();
                    }
                    
                    isGoogleSheetsConnected = true;
                    updateSyncStatus('connected');
                    startAutoSync();
                    
                } catch (error) {
                    console.error('Error initializing Google Sheets:', error);
                    updateSyncStatus('disconnected');
                }
            });
        }

        async function testConnection() {
            try {
                const response = await gapi.client.sheets.spreadsheets.get({
                    spreadsheetId: SPREADSHEET_ID
                });
                console.log('Connected to spreadsheet:', response.result.properties.title);
                return true;
            } catch (error) {
                console.error('Connection test failed:', error);
                return false;
            }
        }

        async function createSpreadsheet() {
            try {
                // Create new spreadsheet
                const createResponse = await gapi.client.sheets.spreadsheets.create({
                    resource: {
                        properties: {
                            title: 'Sistem Gudang - ' + new Date().toLocaleDateString('id-ID')
                        },
                        sheets: [
                            { properties: { title: 'Database' } },
                            { properties: { title: 'Outlets' } },
                            { properties: { title: 'Status' } },
                            { properties: { title: 'Riwayat' } },
                            { properties: { title: 'Users' } }
                        ]
                    }
                });

                SPREADSHEET_ID = createResponse.result.spreadsheetId;
                localStorage.setItem('spreadsheetId', SPREADSHEET_ID);

                // Setup headers for each sheet
                await setupSheetHeaders();
                
                alert(`Spreadsheet baru berhasil dibuat!\nID: ${SPREADSHEET_ID}\nURL: https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}`);
                
            } catch (error) {
                console.error('Error creating spreadsheet:', error);
                throw error;
            }
        }

        async function setupSheetHeaders() {
            const requests = [
                {
                    range: 'Database!A1:D1',
                    values: [['Kode Barang', 'Nama Barang', 'Stock', 'Unit']]
                },
                {
                    range: 'Outlets!A1:B1',
                    values: [['Kode Outlet', 'Nama Outlet']]
                },
                {
                    range: 'Status!A1:C1',
                    values: [['Kode Barang', 'Nama Barang', 'Status']]
                },
                {
                    range: 'Riwayat!A1:D1',
                    values: [['Tanggal', 'Kode Barang', 'Nama Barang', 'Keterangan']]
                },
                {
                    range: 'Users!A1:B1',
                    values: [['Username', 'Password']]
                }
            ];

            for (const request of requests) {
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: request.range,
                    valueInputOption: 'RAW',
                    resource: { values: request.values }
                });
            }
        }

        function showSheetsSetup() {
            document.getElementById('sheetsSetupModal').classList.remove('hidden');
            document.getElementById('apiKey').value = GOOGLE_API_KEY;
            document.getElementById('spreadsheetId').value = SPREADSHEET_ID;
        }

        function closeSetupModal() {
            document.getElementById('sheetsSetupModal').classList.add('hidden');
        }

        async function setupGoogleSheets() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const spreadsheetId = document.getElementById('spreadsheetId').value.trim();

            if (!apiKey) {
                alert('API Key harus diisi!');
                return;
            }

            GOOGLE_API_KEY = apiKey;
            SPREADSHEET_ID = spreadsheetId;

            localStorage.setItem('googleApiKey', GOOGLE_API_KEY);
            localStorage.setItem('spreadsheetId', SPREADSHEET_ID);

            closeSetupModal();
            
            try {
                await initializeGoogleSheets();
                alert('Google Sheets berhasil dikonfigurasi!');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function updateSyncStatus(status) {
            const indicator = document.getElementById('syncStatus');
            
            switch (status) {
                case 'connected':
                    indicator.className = 'sync-indicator sync-connected';
                    indicator.innerHTML = '✅ Terhubung ke Google Sheets';
                    break;
                case 'syncing':
                    indicator.className = 'sync-indicator sync-syncing';
                    indicator.innerHTML = '🔄 Sinkronisasi...';
                    break;
                case 'disconnected':
                    indicator.className = 'sync-indicator sync-disconnected';
                    indicator.innerHTML = '⚠️ Tidak Terhubung ke Google Sheets';
                    break;
            }
        }

        function startAutoSync() {
            if (syncInterval) clearInterval(syncInterval);
            
            // Sync every 30 seconds
            syncInterval = setInterval(() => {
                if (isGoogleSheetsConnected) {
                    syncFromSheets();
                }
            }, 30000);
        }

        async function syncToSheets() {
            if (!isGoogleSheetsConnected) return;
            
            try {
                updateSyncStatus('syncing');
                
                // Sync Database
                await gapi.client.sheets.spreadsheets.values.clear({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Database!A2:D'
                });
                
                if (database.length > 0) {
                    const databaseValues = database.map(item => [item.kode, item.nama, item.stock, item.unit]);
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Database!A2',
                        valueInputOption: 'RAW',
                        resource: { values: databaseValues }
                    });
                }

                // Sync Outlets
                await gapi.client.sheets.spreadsheets.values.clear({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Outlets!A2:B'
                });
                
                if (outlets.length > 0) {
                    const outletValues = outlets.map(item => [item.kode, item.nama]);
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Outlets!A2',
                        valueInputOption: 'RAW',
                        resource: { values: outletValues }
                    });
                }

                // Sync Status
                await gapi.client.sheets.spreadsheets.values.clear({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Status!A2:C'
                });
                
                if (statusItems.length > 0) {
                    const statusValues = statusItems.map(item => [item.kode, item.nama, item.status]);
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Status!A2',
                        valueInputOption: 'RAW',
                        resource: { values: statusValues }
                    });
                }

                // Sync Riwayat
                await gapi.client.sheets.spreadsheets.values.clear({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Riwayat!A2:D'
                });
                
                if (riwayat.length > 0) {
                    const riwayatValues = riwayat.map(item => [item.tanggal, item.kode, item.nama, item.keterangan]);
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Riwayat!A2',
                        valueInputOption: 'RAW',
                        resource: { values: riwayatValues }
                    });
                }

                updateSyncStatus('connected');
                
            } catch (error) {
                console.error('Error syncing to sheets:', error);
                updateSyncStatus('disconnected');
            }
        }

        async function syncFromSheets() {
            if (!isGoogleSheetsConnected) return;
            
            try {
                updateSyncStatus('syncing');
                
                // Get data from sheets
                const responses = await Promise.all([
                    gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Database!A2:D'
                    }),
                    gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Outlets!A2:B'
                    }),
                    gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Status!A2:C'
                    }),
                    gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Riwayat!A2:D'
                    })
                ]);

                // Update local data
                const [databaseResponse, outletResponse, statusResponse, riwayatResponse] = responses;
                
                if (databaseResponse.result.values) {
                    const newDatabase = databaseResponse.result.values.map(row => ({
                        kode: row[0] || '',
                        nama: row[1] || '',
                        stock: parseInt(row[2]) || 0,
                        unit: row[3] || ''
                    }));
                    
                    if (JSON.stringify(newDatabase) !== JSON.stringify(database)) {
                        database = newDatabase;
                        localStorage.setItem('database', JSON.stringify(database));
                    }
                }

                if (outletResponse.result.values) {
                    const newOutlets = outletResponse.result.values.map(row => ({
                        kode: row[0] || '',
                        nama: row[1] || ''
                    }));
                    
                    if (JSON.stringify(newOutlets) !== JSON.stringify(outlets)) {
                        outlets = newOutlets;
                        localStorage.setItem('outlets', JSON.stringify(outlets));
                        loadOutletDropdown();
                    }
                }

                if (statusResponse.result.values) {
                    const newStatusItems = statusResponse.result.values.map(row => ({
                        kode: row[0] || '',
                        nama: row[1] || '',
                        status: row[2] || ''
                    }));
                    
                    if (JSON.stringify(newStatusItems) !== JSON.stringify(statusItems)) {
                        statusItems = newStatusItems;
                        localStorage.setItem('statusItems', JSON.stringify(statusItems));
                    }
                }

                if (riwayatResponse.result.values) {
                    const newRiwayat = riwayatResponse.result.values.map(row => ({
                        tanggal: row[0] || '',
                        kode: row[1] || '',
                        nama: row[2] || '',
                        keterangan: row[3] || ''
                    }));
                    
                    if (JSON.stringify(newRiwayat) !== JSON.stringify(riwayat)) {
                        riwayat = newRiwayat;
                        localStorage.setItem('riwayat', JSON.stringify(riwayat));
                    }
                }

                loadTables();
                updateSyncStatus('connected');
                
            } catch (error) {
                console.error('Error syncing from sheets:', error);
                updateSyncStatus('disconnected');
            }
        }

        async function manualSync() {
            if (!isGoogleSheetsConnected) {
                alert('Google Sheets belum terkonfigurasi!');
                return;
            }
            
            await syncToSheets();
            await syncFromSheets();
            alert('Sinkronisasi manual selesai!');
        }

        // Authentication
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('mainContainer').classList.remove('hidden');
                showMenu('penerimaan');
            } else {
                document.getElementById('loginError').textContent = 'Username atau password salah';
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('mainContainer').classList.add('hidden');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').classList.add('hidden');
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });

            // Sidebar toggle
            document.getElementById('toggleSidebar').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('mainContent');
                
                if (sidebar.classList.contains('sidebar-expanded')) {
                    sidebar.classList.remove('sidebar-expanded');
                    sidebar.classList.add('sidebar-collapsed');
                    mainContent.classList.remove('ml-64');
                    mainContent.classList.add('ml-16');
                } else {
                    sidebar.classList.remove('sidebar-collapsed');
                    sidebar.classList.add('sidebar-expanded');
                    mainContent.classList.remove('ml-16');
                    mainContent.classList.add('ml-64');
                }
            });

            // Auto-fill functionality for penerimaan
            document.getElementById('penerimaanKode').addEventListener('input', function() {
                const kode = this.value;
                const item = database.find(d => d.kode === kode);
                
                if (item) {
                    document.getElementById('penerimaanNama').value = item.nama;
                    document.getElementById('penerimaanUnit').value = item.unit;
                } else {
                    document.getElementById('penerimaanNama').value = '';
                    document.getElementById('penerimaanUnit').value = '';
                }
            });

            // Auto-fill functionality for transfer
            document.getElementById('transferKode').addEventListener('input', function() {
                const kode = this.value;
                const item = database.find(d => d.kode === kode);
                
                if (item) {
                    document.getElementById('transferNama').value = item.nama;
                    document.getElementById('transferUnit').value = item.unit;
                } else {
                    document.getElementById('transferNama').value = '';
                    document.getElementById('transferUnit').value = '';
                }
            });

            // Form submissions
            document.getElementById('penerimaanForm').addEventListener('submit', handlePenerimaan);
            document.getElementById('transferForm').addEventListener('submit', handleTransfer);
            document.getElementById('outletForm').addEventListener('submit', handleOutlet);
            document.getElementById('userForm').addEventListener('submit', handleUser);
        }

        // Menu Navigation
        function showMenu(menu) {
            // Hide all content
            const contents = ['penerimaan', 'transfer', 'outlet', 'status', 'database', 'riwayat', 'laporan', 'user'];
            contents.forEach(content => {
                document.getElementById(content + 'Content').classList.add('hidden');
            });

            // Show selected content
            document.getElementById(menu + 'Content').classList.remove('hidden');
            
            // Update page title
            const titles = {
                'penerimaan': 'Penerimaan Barang',
                'transfer': 'Transfer Barang',
                'outlet': 'Data Outlet',
                'status': 'Status Barang',
                'database': 'Database Barang',
                'riwayat': 'Riwayat Transaksi',
                'laporan': 'Laporan',
                'user': 'User Management'
            };
            document.getElementById('pageTitle').textContent = titles[menu];
        }

        // Handle Penerimaan
        async function handlePenerimaan(e) {
            e.preventDefault();
            
            const data = {
                tanggal: document.getElementById('penerimaanTanggal').value,
                kode: document.getElementById('penerimaanKode').value,
                nama: document.getElementById('penerimaanNama').value,
                qty: parseInt(document.getElementById('penerimaanQty').value),
                unit: document.getElementById('penerimaanUnit').value,
                status: document.getElementById('penerimaanStatus').value
            };

            if (data.status === 'Diterima') {
                // Add to database
                const existingItem = database.find(d => d.kode === data.kode);
                if (existingItem) {
                    existingItem.stock += data.qty;
                } else {
                    database.push({
                        kode: data.kode,
                        nama: data.nama,
                        stock: data.qty,
                        unit: data.unit
                    });
                }
                localStorage.setItem('database', JSON.stringify(database));
            } else {
                // Add to status
                statusItems.push({
                    kode: data.kode,
                    nama: data.nama,
                    status: data.status,
                    qty: data.qty,
                    unit: data.unit,
                    tanggal: data.tanggal
                });
                localStorage.setItem('statusItems', JSON.stringify(statusItems));
            }

            // Add to riwayat
            riwayat.push({
                tanggal: data.tanggal,
                kode: data.kode,
                nama: data.nama,
                keterangan: `Penerimaan - ${data.status} (${data.qty} ${data.unit})`
            });
            localStorage.setItem('riwayat', JSON.stringify(riwayat));

            // Reset form and reload tables
            document.getElementById('penerimaanForm').reset();
            document.getElementById('penerimaanTanggal').value = new Date().toISOString().split('T')[0];
            loadTables();
            
            // Sync to Google Sheets
            if (isGoogleSheetsConnected) {
                await syncToSheets();
            }
            
            alert('Data penerimaan berhasil disimpan!');
        }

        // Handle Transfer
        async function handleTransfer(e) {
            e.preventDefault();
            
            const data = {
                tanggal: document.getElementById('transferTanggal').value,
                kode: document.getElementById('transferKode').value,
                nama: document.getElementById('transferNama').value,
                qty: parseInt(document.getElementById('transferQty').value),
                unit: document.getElementById('transferUnit').value,
                outlet: document.getElementById('transferOutlet').value
            };

            // Check if item exists in database
            const item = database.find(d => d.kode === data.kode);
            if (!item) {
                alert('Barang tidak ditemukan di database!');
                return;
            }

            if (item.stock < data.qty) {
                alert('Stock tidak mencukupi!');
                return;
            }

            // Update stock
            item.stock -= data.qty;
            localStorage.setItem('database', JSON.stringify(database));

            // Add to riwayat
            const outletName = outlets.find(o => o.kode === data.outlet)?.nama || data.outlet;
            riwayat.push({
                tanggal: data.tanggal,
                kode: data.kode,
                nama: data.nama,
                keterangan: `Transfer ke ${outletName} (${data.qty} ${data.unit})`
            });
            localStorage.setItem('riwayat', JSON.stringify(riwayat));

            // Reset form and reload tables
            document.getElementById('transferForm').reset();
            document.getElementById('transferTanggal').value = new Date().toISOString().split('T')[0];
            loadTables();
            
            // Sync to Google Sheets
            if (isGoogleSheetsConnected) {
                await syncToSheets();
            }
            
            alert('Transfer berhasil!');
        }

        // Handle Outlet
        async function handleOutlet(e) {
            e.preventDefault();
            
            const data = {
                kode: document.getElementById('outletKode').value,
                nama: document.getElementById('outletNama').value
            };

            // Check if outlet already exists
            if (outlets.find(o => o.kode === data.kode)) {
                alert('Kode outlet sudah ada!');
                return;
            }

            outlets.push(data);
            localStorage.setItem('outlets', JSON.stringify(outlets));

            // Reset form and reload
            document.getElementById('outletForm').reset();
            loadOutletDropdown();
            loadTables();
            
            // Sync to Google Sheets
            if (isGoogleSheetsConnected) {
                await syncToSheets();
            }
            
            alert('Outlet berhasil ditambahkan!');
        }

        // Handle User
        function handleUser(e) {
            e.preventDefault();
            
            const data = {
                username: document.getElementById('userUsername').value,
                password: document.getElementById('userPassword').value
            };

            // Check if user already exists
            if (users.find(u => u.username === data.username)) {
                alert('Username sudah ada!');
                return;
            }

            users.push(data);
            localStorage.setItem('users', JSON.stringify(users));

            // Reset form and reload
            document.getElementById('userForm').reset();
            loadTables();
            
            alert('User berhasil ditambahkan!');
        }

        // Load Outlet Dropdown
        function loadOutletDropdown() {
            const select = document.getElementById('transferOutlet');
            select.innerHTML = '<option value="">Pilih Outlet</option>';
            
            outlets.forEach(outlet => {
                const option = document.createElement('option');
                option.value = outlet.kode;
                option.textContent = `${outlet.kode} - ${outlet.nama}`;
                select.appendChild(option);
            });
        }

        // Load Tables
        function loadTables() {
            loadOutletTable();
            loadStatusTable();
            loadDatabaseTable();
            loadRiwayatTable();
            loadUserTable();
        }

        function loadOutletTable() {
            const tbody = document.getElementById('outletTable');
            tbody.innerHTML = '';
            
            outlets.forEach((outlet, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${outlet.kode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${outlet.nama}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <button onclick="deleteOutlet(${index})" class="text-red-600 hover:text-red-900">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadStatusTable() {
            const tbody = document.getElementById('statusTable');
            tbody.innerHTML = '';
            
            statusItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.kode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nama}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${item.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <button onclick="approveStatus(${index})" class="text-green-600 hover:text-green-900 mr-2">Terima</button>
                        <button onclick="deleteStatus(${index})" class="text-red-600 hover:text-red-900">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadDatabaseTable() {
            const tbody = document.getElementById('databaseTable');
            tbody.innerHTML = '';
            
            database.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.kode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nama}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.stock}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <button onclick="editDatabase(${index})" class="text-blue-600 hover:text-blue-900 mr-2">Edit</button>
                        <button onclick="deleteDatabase(${index})" class="text-red-600 hover:text-red-900">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadRiwayatTable() {
            const tbody = document.getElementById('riwayatTable');
            tbody.innerHTML = '';
            
            riwayat.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.tanggal}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.kode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nama}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.keterangan}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadUserTable() {
            const tbody = document.getElementById('userTable');
            tbody.innerHTML = '';
            
            users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <button onclick="editUser(${index})" class="text-blue-600 hover:text-blue-900 mr-2">Edit</button>
                        ${user.username !== 'admin' ? `<button onclick="deleteUser(${index})" class="text-red-600 hover:text-red-900">Hapus</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Delete Functions
        async function deleteOutlet(index) {
            if (confirm('Yakin ingin menghapus outlet ini?')) {
                outlets.splice(index, 1);
                localStorage.setItem('outlets', JSON.stringify(outlets));
                loadOutletDropdown();
                loadTables();
                
                if (isGoogleSheetsConnected) {
                    await syncToSheets();
                }
            }
        }

        async function deleteStatus(index) {
            if (confirm('Yakin ingin menghapus status ini?')) {
                statusItems.splice(index, 1);
                localStorage.setItem('statusItems', JSON.stringify(statusItems));
                loadTables();
                
                if (isGoogleSheetsConnected) {
                    await syncToSheets();
                }
            }
        }

        async function deleteDatabase(index) {
            if (confirm('Yakin ingin menghapus barang ini?')) {
                database.splice(index, 1);
                localStorage.setItem('database', JSON.stringify(database));
                loadTables();
                
                if (isGoogleSheetsConnected) {
                    await syncToSheets();
                }
            }
        }

        function deleteUser(index) {
            if (confirm('Yakin ingin menghapus user ini?')) {
                users.splice(index, 1);
                localStorage.setItem('users', JSON.stringify(users));
                loadTables();
            }
        }

        // Approve Status
        async function approveStatus(index) {
            const item = statusItems[index];
            
            // Add to database
            const existingItem = database.find(d => d.kode === item.kode);
            if (existingItem) {
                existingItem.stock += item.qty;
            } else {
                database.push({
                    kode: item.kode,
                    nama: item.nama,
                    stock: item.qty,
                    unit: item.unit
                });
            }
            
            // Add to riwayat
            riwayat.push({
                tanggal: new Date().toISOString().split('T')[0],
                kode: item.kode,
                nama: item.nama,
                keterangan: `Status diubah menjadi Diterima (${item.qty} ${item.unit})`
            });
            
            // Remove from status
            statusItems.splice(index, 1);
            
            // Save to localStorage
            localStorage.setItem('database', JSON.stringify(database));
            localStorage.setItem('statusItems', JSON.stringify(statusItems));
            localStorage.setItem('riwayat', JSON.stringify(riwayat));
            
            loadTables();
            
            // Sync to Google Sheets
            if (isGoogleSheetsConnected) {
                await syncToSheets();
            }
            
            alert('Status berhasil diubah menjadi Diterima!');
        }

        // Edit Functions
        async function editDatabase(index) {
            const item = database[index];
            const newStock = prompt('Masukkan stock baru:', item.stock);
            
            if (newStock !== null && !isNaN(newStock)) {
                item.stock = parseInt(newStock);
                localStorage.setItem('database', JSON.stringify(database));
                loadTables();
                
                if (isGoogleSheetsConnected) {
                    await syncToSheets();
                }
            }
        }

        function editUser(index) {
            const user = users[index];
            const newPassword = prompt('Masukkan password baru:');
            
            if (newPassword !== null && newPassword.trim() !== '') {
                user.password = newPassword.trim();
                localStorage.setItem('users', JSON.stringify(users));
                alert('Password berhasil diubah!');
            }
        }

        // Report Functions
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('Laporan Sistem Gudang', 20, 20);
            
            let y = 40;
            
            // Database Report
            doc.setFontSize(12);
            doc.text('Database Barang:', 20, y);
            y += 10;
            
            database.forEach(item => {
                doc.text(`${item.kode} - ${item.nama}: ${item.stock} ${item.unit}`, 20, y);
                y += 8;
            });
            
            y += 10;
            doc.text('Riwayat Transaksi:', 20, y);
            y += 10;
            
            riwayat.slice(-10).forEach(item => {
                doc.text(`${item.tanggal} - ${item.kode}: ${item.keterangan}`, 20, y);
                y += 8;
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });
            
            doc.save('laporan-gudang.pdf');
        }

        function downloadExcel() {
            const wb = XLSX.utils.book_new();
            
            // Database sheet
            const dbWs = XLSX.utils.json_to_sheet(database);
            XLSX.utils.book_append_sheet(wb, dbWs, 'Database');
            
            // Riwayat sheet
            const riwayatWs = XLSX.utils.json_to_sheet(riwayat);
            XLSX.utils.book_append_sheet(wb, riwayatWs, 'Riwayat');
            
            // Outlet sheet
            const outletWs = XLSX.utils.json_to_sheet(outlets);
            XLSX.utils.book_append_sheet(wb, outletWs, 'Outlet');
            
            XLSX.writeFile(wb, 'laporan-gudang.xlsx');
        }

        function printReport() {
            const printContent = document.getElementById('printContent');
            
            let html = '<h2>Database Barang</h2><table border="1" style="width:100%; border-collapse: collapse;"><tr><th>Kode</th><th>Nama</th><th>Stock</th><th>Unit</th></tr>';
            database.forEach(item => {
                html += `<tr><td>${item.kode}</td><td>${item.nama}</td><td>${item.stock}</td><td>${item.unit}</td></tr>`;
            });
            html += '</table><br>';
            
            html += '<h2>Riwayat Transaksi</h2><table border="1" style="width:100%; border-collapse: collapse;"><tr><th>Tanggal</th><th>Kode</th><th>Nama</th><th>Keterangan</th></tr>';
            riwayat.forEach(item => {
                html += `<tr><td>${item.tanggal}</td><td>${item.kode}</td><td>${item.nama}</td><td>${item.keterangan}</td></tr>`;
            });
            html += '</table>';
            
            printContent.innerHTML = html;
            window.print();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ccb871b09bfd25',t:'MTc1NzQ4NDE4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
