<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --color-primary: #2563eb;
            --color-primary-hover: #1d4ed8;
        }
        
        .bg-primary {
            background-color: var(--color-primary) !important;
        }
        
        .text-primary {
            color: var(--color-primary) !important;
        }
        
        .border-primary {
            border-color: var(--color-primary) !important;
        }
        
        .ring-primary {
            --tw-ring-color: var(--color-primary) !important;
        }
        
        .focus\:ring-primary:focus {
            --tw-ring-color: var(--color-primary) !important;
        }
        
        .hover\:bg-blue-700:hover {
            background-color: var(--color-primary-hover) !important;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#64748b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="bg-primary text-white p-2 rounded-lg mr-3">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"></path>
                            <path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h1 class="text-xl font-bold text-gray-900">Warehouse Management</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-3">
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-900" id="currentUserName">Administrator</p>
                            <p class="text-xs text-gray-500" id="currentUserRole">Admin</p>
                        </div>
                        <div class="bg-primary text-white p-2 rounded-full">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <button onclick="logout()" class="text-gray-600 hover:text-red-600 p-2 rounded-lg hover:bg-red-50 transition-colors" title="Logout">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                    <button id="mobileMenuBtn" class="md:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <nav id="sidebar" class="bg-white w-64 min-h-screen shadow-sm border-r fixed md:relative transform -translate-x-full md:translate-x-0 transition-transform duration-200 ease-in-out z-30">
            <div class="p-6">
                <ul class="space-y-2">
                    <li>
                        <button onclick="showSection('dashboard')" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                            </svg>
                            Dashboard
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('incoming')" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            Incoming
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('status')" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            Status
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('kartu-store')" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                            Kartu Store
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('riwayat')" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                            Riwayat
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('rekap-data')" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                            </svg>
                            Rekap Data
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('pengaturan')" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-blue-50 hover:text-primary transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                            </svg>
                            Pengaturan
                        </button>
                    </li>
                    <li>
                        <button onclick="showDownloadModal()" class="nav-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-green-50 hover:text-green-600 transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            Unduh Data
                        </button>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Overlay for mobile -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:ml-0">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Dashboard</h2>
                    <p class="text-gray-600">Ringkasan aktivitas gudang hari ini</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="goToRekapData('all')">
                        <div class="flex items-center">
                            <div class="bg-blue-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Item</p>
                                <p class="text-2xl font-bold text-gray-900" id="dashTotalItems">20</p>
                                <p class="text-xs text-blue-600 font-medium mt-1">Klik untuk lihat detail</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="goToIncomingData()">
                        <div class="flex items-center">
                            <div class="bg-green-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Barang Masuk</p>
                                <p class="text-2xl font-bold text-gray-900" id="dashIncomingItems">2</p>
                                <p class="text-xs text-green-600 font-medium mt-1">Klik untuk lihat detail</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="goToHistoryData('Transfer Keluar')">
                        <div class="flex items-center">
                            <div class="bg-red-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Barang Keluar</p>
                                <p class="text-2xl font-bold text-gray-900" id="dashOutgoingItems">5</p>
                                <p class="text-xs text-red-600 font-medium mt-1">Klik untuk lihat detail</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="goToRekapData('Rendah')">
                        <div class="flex items-center">
                            <div class="bg-yellow-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Stok Rendah</p>
                                <p class="text-2xl font-bold text-gray-900" id="dashLowStock">4</p>
                                <p class="text-xs text-yellow-600 font-medium mt-1">Klik untuk lihat detail</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">Aksi Cepat</h3>
                        </div>
                        <div class="p-6 space-y-3">
                            <button onclick="showSection('incoming')" class="w-full flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                </svg>
                                Tambah Barang Masuk
                            </button>
                            <button onclick="showSection('status')" class="w-full flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                Verifikasi Barang
                            </button>
                            <button onclick="showSection('kartu-store')" class="w-full flex items-center justify-center px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                                </svg>
                                Kelola Store
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">Status Sistem</h3>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Barang Perlu Verifikasi</span>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800" id="dashPendingVerification">2</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Store Aktif</span>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800" id="dashActiveStores">24</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Total Transaksi Hari Ini</span>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800" id="dashTodayTransactions">8</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Peringatan Stok</span>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800" id="dashStockWarnings">5</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">Aktivitas Terbaru</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4" id="recentActivities">
                                <!-- Activities will be populated by JavaScript -->
                            </div>
                            <div class="mt-4 pt-4 border-t">
                                <button onclick="showSection('riwayat')" class="text-sm text-primary hover:text-blue-700 font-medium">
                                    Lihat Semua Aktivitas â†’
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Incoming Section -->
            <div id="incoming" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Barang Masuk</h2>
                    <p class="text-gray-600">Kelola barang yang masuk ke gudang</p>
                </div>

                <!-- Form Input Barang Masuk -->
                <div class="bg-white rounded-lg shadow-sm border mb-6">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">Input Barang Masuk</h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                                <input type="date" id="incomingDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                                <input type="text" id="incomingCode" placeholder="Masukkan kode barang" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" onblur="autoFillItemData()" oninput="validateCodeInput()">
                                <div id="codeValidationMessage" class="text-xs mt-1 hidden"></div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                                <input type="text" id="incomingName" placeholder="Nama barang" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Qty</label>
                                <input type="number" id="incomingQty" placeholder="0" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Unit</label>
                                <select id="incomingUnit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Pilih Unit</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Min Stock</label>
                                <input type="number" id="incomingMinStock" placeholder="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div class="flex items-end">
                                <button onclick="addIncomingItem()" class="w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Tambah ke Daftar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter dan Pencarian -->
                <div class="bg-white rounded-lg shadow-sm border mb-6">
                    <div class="p-6">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                            <div class="flex flex-col sm:flex-row gap-4">
                                <input type="text" id="searchIncoming" placeholder="Cari dalam daftar..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <select id="filterStatus" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Status</option>
                                    <option value="Diterima">Diterima</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Ditolak">Ditolak</option>
                                </select>
                            </div>
                            <div class="flex gap-2">
                                <input type="date" id="filterDate" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <button onclick="filterIncomingItems()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                    Filter
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">Daftar Barang Masuk</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Min Stock</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="incomingTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Status Section -->
            <div id="status" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Status Verifikasi Barang</h2>
                    <p class="text-gray-600">Verifikasi dan transfer barang ke store</p>
                </div>

                <!-- Filter dan Pencarian -->
                <div class="bg-white rounded-lg shadow-sm border mb-6">
                    <div class="p-6">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                            <div class="flex flex-col sm:flex-row gap-4">
                                <input type="text" id="searchStatus" placeholder="Cari barang..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <select id="filterStatusVerifikasi" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Status</option>
                                    <option value="Menunggu Verifikasi">Menunggu Verifikasi</option>
                                    <option value="Diverifikasi">Diverifikasi</option>
                                    <option value="Ditransfer">Ditransfer</option>
                                </select>
                            </div>
                            <button onclick="filterStatusItems()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                Filter
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabel Status Verifikasi -->
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">Daftar Barang Menunggu Verifikasi</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="statusTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Kartu Store Section -->
            <div id="kartu-store" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Kartu Store</h2>
                    <p class="text-gray-600">Monitor stok barang per store</p>
                </div>

                <!-- Filter dan Pencarian -->
                <div class="bg-white rounded-lg shadow-sm border mb-6">
                    <div class="p-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                            <div class="flex flex-col sm:flex-row gap-4 flex-1">
                                <div class="relative flex-1">
                                    <input type="text" id="searchStoreCards" placeholder="Cari store..." class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <select id="filterStoreStatus" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Status</option>
                                    <option value="Aktif">Aktif</option>
                                    <option value="Tidak Aktif">Tidak Aktif</option>
                                </select>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="filterStoreCards()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Filter
                                </button>
                                <button onclick="showStoreView()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors" id="viewToggleBtn">
                                    Lihat Tabel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Store Cards View -->
                <div id="storeCardsView">
                    <div id="storeCardsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <!-- Store cards akan diisi oleh JavaScript -->
                    </div>
                </div>

                <!-- Store Detail View -->
                <div id="storeDetailView" class="hidden">
                    <div class="mb-6">
                        <button onclick="backToStoreCards()" class="flex items-center text-primary hover:text-blue-700 mb-4">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                            </svg>
                            Kembali ke Daftar Store
                        </button>
                        <div class="bg-white rounded-lg shadow-sm border p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 id="storeDetailTitle" class="text-xl font-bold text-gray-900"></h3>
                                    <p id="storeDetailInfo" class="text-gray-600"></p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="showOutgoingModal()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                                        Transfer Keluar
                                    </button>
                                    <button onclick="showTransferModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                        Transfer Masuk
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Store Items Table -->
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900">Stok Barang di Store</h3>
                                <div class="flex gap-4">
                                    <input type="text" id="searchStoreItems" placeholder="Cari barang..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal Transfer</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transfer By</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="storeDetailTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Table View (Legacy) -->
                <div id="storeTableView" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">Stok Barang per Store</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Store</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal Transfer</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transfer By</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="storeTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Riwayat Section -->
            <div id="riwayat" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Riwayat Transaksi</h2>
                    <p class="text-gray-600">Lihat semua aktivitas gudang dan transaksi per store</p>
                </div>

                <!-- Filter dan Pencarian -->
                <div class="bg-white rounded-lg shadow-sm border mb-6">
                    <div class="p-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                            <div class="flex flex-col sm:flex-row gap-4 flex-1">
                                <div class="relative flex-1">
                                    <input type="text" id="searchHistory" placeholder="Cari transaksi..." class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <select id="filterHistoryType" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Aktivitas</option>
                                    <option value="Barang Masuk">Barang Masuk</option>
                                    <option value="Barang Keluar">Barang Keluar</option>
                                    <option value="Transfer Masuk">Transfer Masuk</option>
                                    <option value="Transfer Keluar">Transfer Keluar</option>
                                    <option value="Verifikasi">Verifikasi</option>
                                    <option value="Update Stok">Update Stok</option>
                                </select>
                                <select id="filterHistoryStore" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Store</option>
                                    <option value="GUDANG">Gudang Pusat</option>
                                </select>
                            </div>
                            <div class="flex gap-2">
                                <input type="date" id="filterHistoryDate" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <button onclick="filterHistoryData()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Filter
                                </button>
                                <button onclick="clearHistoryFilters()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                                    Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <div class="flex items-center">
                            <div class="bg-blue-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Transaksi</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalTransactions">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <div class="flex items-center">
                            <div class="bg-green-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Barang Masuk</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalIncoming">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <div class="flex items-center">
                            <div class="bg-red-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Transfer Keluar</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalOutgoing">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <div class="flex items-center">
                            <div class="bg-purple-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Transfer Antar Store</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalTransfers">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabel Riwayat -->
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">Log Aktivitas Transaksi</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal & Waktu</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jenis Transaksi</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Barang</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Store/Lokasi</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Catatan</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="px-6 py-4 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-gray-700">
                                Menampilkan <span id="historyShowingStart">1</span> - <span id="historyShowingEnd">10</span> dari <span id="historyTotal">0</span> transaksi
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="previousHistoryPage()" id="historyPrevBtn" class="px-3 py-1 text-sm bg-gray-200 text-gray-600 rounded hover:bg-gray-300 disabled:opacity-50" disabled>
                                    Sebelumnya
                                </button>
                                <span id="historyPageInfo" class="px-3 py-1 text-sm text-gray-700">Halaman 1</span>
                                <button onclick="nextHistoryPage()" id="historyNextBtn" class="px-3 py-1 text-sm bg-gray-200 text-gray-600 rounded hover:bg-gray-300 disabled:opacity-50">
                                    Selanjutnya
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rekap Data Section -->
            <div id="rekap-data" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Rekap Data</h2>
                    <p class="text-gray-600">Laporan lengkap data gudang dan analisis stok</p>
                </div>

                <!-- Pencarian dan Filter -->
                <div class="bg-white rounded-lg shadow-sm border mb-6">
                    <div class="p-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                            <div class="flex flex-col sm:flex-row gap-4 flex-1">
                                <div class="relative flex-1">
                                    <input type="text" id="searchRekap" placeholder="Cari barang dalam rekap data..." class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <select id="filterCategory" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Kategori</option>
                                    <option value="Elektronik">Elektronik</option>
                                    <option value="Aksesoris">Aksesoris</option>
                                </select>
                                <select id="filterStockStatus" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Status</option>
                                    <option value="Aman">Stok Aman</option>
                                    <option value="Rendah">Stok Rendah</option>
                                    <option value="Habis">Stok Habis</option>
                                </select>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="filterRekapData()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Filter
                                </button>
                                <button onclick="exportRekapData()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                    Export Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="filterByStatus('all')" id="cardTotalJenis">
                        <div class="flex items-center">
                            <div class="bg-blue-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Jenis Barang</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalJenisBarang">20</p>
                                <p class="text-xs text-blue-600 font-medium mt-1">Klik untuk lihat semua</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="filterByStatus('Aman')" id="cardStokAman">
                        <div class="flex items-center">
                            <div class="bg-green-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Stok Aman</p>
                                <p class="text-2xl font-bold text-gray-900" id="stokAman">15</p>
                                <p class="text-xs text-green-600 font-medium mt-1">Klik untuk lihat detail</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="filterByStatus('Rendah')" id="cardStokRendah">
                        <div class="flex items-center">
                            <div class="bg-yellow-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Stok Rendah</p>
                                <p class="text-2xl font-bold text-gray-900" id="stokRendah">4</p>
                                <p class="text-xs text-yellow-600 font-medium mt-1">Klik untuk lihat detail</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-all cursor-pointer transform hover:scale-105" onclick="filterByStatus('Habis')" id="cardStokHabis">
                        <div class="flex items-center">
                            <div class="bg-red-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Stok Habis</p>
                                <p class="text-2xl font-bold text-gray-900" id="stokHabis">1</p>
                                <p class="text-xs text-red-600 font-medium mt-1">Klik untuk lihat detail</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Filter Indicator -->
                <div id="activeFilterIndicator" class="hidden mb-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-blue-800 font-medium">Filter Aktif: </span>
                                <span class="text-blue-900 font-semibold ml-1" id="activeFilterText">Semua Barang</span>
                                <span class="text-blue-700 ml-2" id="activeFilterCount">(20 item)</span>
                            </div>
                            <button onclick="clearActiveFilter()" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                Reset Filter
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabel Rekap Data -->
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-6 border-b">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">Detail Rekap Data Barang</h3>
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center">
                                    <input type="checkbox" id="selectAllItems" class="mr-2 rounded border-gray-300 text-primary focus:ring-primary">
                                    <label for="selectAllItems" class="text-sm text-gray-600">Pilih Semua</label>
                                </div>
                                <button id="bulkEditBtn" onclick="showBulkEditModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                                    </svg>
                                    Edit Terpilih
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <input type="checkbox" id="selectAllHeader" class="rounded border-gray-300 text-primary focus:ring-primary">
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stok Saat Ini</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Min. Stok</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Masuk</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Keluar</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="rekapTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pengaturan Section -->
            <div id="pengaturan" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Pengaturan</h2>
                    <p class="text-gray-600">Konfigurasi sistem gudang</p>
                </div>

                <!-- Tab Navigation -->
                <div class="bg-white rounded-lg shadow-sm border mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8 px-6">
                            <button onclick="showSettingsTab('general')" class="settings-tab py-4 px-1 border-b-2 border-primary text-primary font-medium text-sm whitespace-nowrap">
                                Pengaturan Tampilan
                            </button>
                            <button onclick="showSettingsTab('units')" class="settings-tab py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm whitespace-nowrap">
                                Kelola Unit
                            </button>
                            <button onclick="showSettingsTab('stores')" class="settings-tab py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm whitespace-nowrap">
                                Kelola Store
                            </button>
                            <button onclick="showSettingsTab('users')" class="settings-tab py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm whitespace-nowrap">
                                Kelola User
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- Display Settings Tab -->
                <div id="generalSettings" class="settings-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow-sm border">
                            <div class="p-6 border-b">
                                <h3 class="text-lg font-semibold text-gray-900">Pengaturan Tampilan</h3>
                            </div>
                            <div class="p-6 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tema Warna</label>
                                    <select id="colorTheme" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="blue">Biru (Default)</option>
                                        <option value="green">Hijau</option>
                                        <option value="purple">Ungu</option>
                                        <option value="red">Merah</option>
                                        <option value="indigo">Indigo</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ukuran Font</label>
                                    <select id="fontSize" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="small">Kecil</option>
                                        <option value="medium" selected>Sedang (Default)</option>
                                        <option value="large">Besar</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Bahasa</label>
                                    <select id="language" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="id" selected>Bahasa Indonesia</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Format Tanggal</label>
                                    <select id="dateFormat" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="dd/mm/yyyy" selected>DD/MM/YYYY</option>
                                        <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                        <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm border">
                            <div class="p-6 border-b">
                                <h3 class="text-lg font-semibold text-gray-900">Preferensi Tampilan</h3>
                            </div>
                            <div class="p-6 space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Mode Gelap</p>
                                        <p class="text-sm text-gray-500">Aktifkan tema gelap untuk mata</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="darkMode" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Sidebar Kompak</p>
                                        <p class="text-sm text-gray-500">Tampilkan sidebar dalam mode kompak</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="compactSidebar" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Animasi</p>
                                        <p class="text-sm text-gray-500">Aktifkan animasi transisi</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="animations" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Auto Refresh</p>
                                        <p class="text-sm text-gray-500">Refresh data otomatis setiap 30 detik</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="autoRefresh" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-between">
                        <button onclick="resetDisplaySettings()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            Reset ke Default
                        </button>
                        <button onclick="saveDisplaySettings()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Simpan Pengaturan
                        </button>
                    </div>
                </div>

                <!-- Units Management Tab -->
                <div id="unitsSettings" class="settings-content hidden">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Kelola Unit</h3>
                            <button onclick="showAddUnitModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Tambah Unit
                            </button>
                        </div>
                        <div class="p-6">
                            <div class="mb-4">
                                <input type="text" id="searchUnits" placeholder="Cari unit..." class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Unit</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Singkatan</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deskripsi</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="unitsTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Data akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stores Management Tab -->
                <div id="storesSettings" class="settings-content hidden">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Kelola Store</h3>
                            <button onclick="showAddStoreModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Tambah Store
                            </button>
                        </div>
                        <div class="p-6">
                            <div class="mb-4">
                                <input type="text" id="searchStores" placeholder="Cari store..." class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Store</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lokasi</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Manager</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="storesTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Data akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Management Tab -->
                <div id="usersSettings" class="settings-content hidden">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Kelola User</h3>
                            <button onclick="showAddUserModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Tambah User
                            </button>
                        </div>
                        <div class="p-6">
                            <div class="mb-4 flex gap-4">
                                <input type="text" id="searchUsers" placeholder="Cari user..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <select id="filterUserRole" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Semua Role</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Manager">Manager</option>
                                    <option value="Staff">Staff</option>
                                </select>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Lengkap</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Login</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Data akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Transfer Modal -->
    <div id="transferModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Transfer Barang ke Store</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Barang</label>
                        <select id="transferItemSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Pilih barang yang sudah diverifikasi...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Store Tujuan</label>
                        <select id="transferStoreSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Pilih store tujuan...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Transfer</label>
                        <input type="number" id="transferQty" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeTransferModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="processTransfer()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        Transfer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div id="verificationModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Verifikasi Barang</h3>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">Detail Barang:</p>
                        <div id="verificationDetails" class="bg-gray-50 p-3 rounded-lg">
                            <!-- Detail akan diisi oleh JavaScript -->
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan Verifikasi (Opsional)</label>
                        <textarea id="verificationNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Tambahkan catatan jika diperlukan..."></textarea>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeVerificationModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="rejectItem()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                        Tolak
                    </button>
                    <button onclick="approveItem()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        Verifikasi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Store Item Modal -->
    <div id="editStoreModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Edit Stok Store</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Store</label>
                        <input type="text" id="editStoreName" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                        <input type="text" id="editItemName" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Stok</label>
                        <input type="number" id="editItemQty" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeEditStoreModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="updateStoreItem()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Update
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Unit Modal -->
    <div id="unitModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b">
                    <h3 id="unitModalTitle" class="text-lg font-semibold text-gray-900">Tambah Unit</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Unit</label>
                        <input type="text" id="unitName" placeholder="Contoh: Kilogram" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Singkatan</label>
                        <input type="text" id="unitAbbr" placeholder="Contoh: kg" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                        <textarea id="unitDesc" rows="3" placeholder="Deskripsi unit..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="unitStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="Aktif">Aktif</option>
                            <option value="Tidak Aktif">Tidak Aktif</option>
                        </select>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeUnitModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="saveUnit()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Simpan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Store Modal -->
    <div id="storeModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b">
                    <h3 id="storeModalTitle" class="text-lg font-semibold text-gray-900">Tambah Store</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kode Store</label>
                        <input type="text" id="storeCode" placeholder="Contoh: 50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Store</label>
                        <input type="text" id="storeName" placeholder="Contoh: CAFE STORE" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi</label>
                        <input type="text" id="storeLocation" placeholder="Contoh: Lantai 1, Gedung A" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Manager</label>
                        <input type="text" id="storeManager" placeholder="Nama manager store" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="storeStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="Aktif">Aktif</option>
                            <option value="Tidak Aktif">Tidak Aktif</option>
                        </select>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeStoreModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="saveStore()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Simpan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-lg w-full">
                <div class="p-6 border-b">
                    <h3 id="userModalTitle" class="text-lg font-semibold text-gray-900">Tambah User</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                            <input type="text" id="username" placeholder="Username unik" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="userEmail" placeholder="email@example.com" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                        <input type="text" id="fullName" placeholder="Nama lengkap user" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input type="password" id="userPassword" placeholder="Password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
                            <input type="password" id="confirmPassword" placeholder="Konfirmasi password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                            <select id="userRole" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="Staff">Staff</option>
                                <option value="Manager">Manager</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="userStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="Aktif">Aktif</option>
                                <option value="Tidak Aktif">Tidak Aktif</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeUserModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="saveUser()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Simpan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Rekap Item Modal -->
    <div id="editRekapModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-lg w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Edit Data Barang</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                            <input type="text" id="editRekapCode" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                            <select id="editRekapCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="Elektronik">Elektronik</option>
                                <option value="Aksesoris">Aksesoris</option>
                                <option value="Furniture">Furniture</option>
                                <option value="Alat Tulis">Alat Tulis</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                        <input type="text" id="editRekapName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Stok Saat Ini</label>
                            <input type="number" id="editRekapCurrentStock" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Min Stock</label>
                            <input type="number" id="editRekapMinStock" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Unit</label>
                            <select id="editRekapUnit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Pilih Unit</option>
                            </select>
                        </div>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            <div class="text-sm text-yellow-800">
                                <p class="font-medium">Perhatian:</p>
                                <p>Perubahan data akan mempengaruhi laporan dan status stok. Pastikan data yang dimasukkan sudah benar.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeEditRekapModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="saveRekapItem()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Simpan Perubahan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Rekap Detail Modal -->
    <div id="viewRekapModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Detail Barang</h3>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-900 border-b pb-2">Informasi Barang</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Kode Barang:</span>
                                    <span class="font-medium" id="detailCode">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Nama Barang:</span>
                                    <span class="font-medium" id="detailName">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Kategori:</span>
                                    <span class="font-medium" id="detailCategory">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Unit:</span>
                                    <span class="font-medium" id="detailUnit">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-900 border-b pb-2">Status Stok</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Stok Saat Ini:</span>
                                    <span class="font-bold text-lg" id="detailCurrentStock">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Minimum Stock:</span>
                                    <span class="font-medium" id="detailMinStock">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Status:</span>
                                    <span class="font-medium" id="detailStatus">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t">
                        <h4 class="font-semibold text-gray-900 mb-4">Riwayat Transaksi</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-600" id="detailTotalIn">0</div>
                                <div class="text-sm text-green-700">Total Masuk</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-red-600" id="detailTotalOut">0</div>
                                <div class="text-sm text-red-700">Total Keluar</div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-600" id="detailNetStock">0</div>
                                <div class="text-sm text-blue-700">Net Stock</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end">
                    <button onclick="closeViewRekapModal()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Outgoing Transfer Modal -->
    <div id="outgoingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Transfer Barang Keluar</h3>
                    <p class="text-sm text-gray-600 mt-1">Transfer barang dari store ini ke store lain</p>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Store Asal</label>
                        <input type="text" id="outgoingFromStore" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Barang</label>
                        <select id="outgoingItemSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Pilih barang yang akan ditransfer...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Store Tujuan</label>
                        <select id="outgoingToStoreSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Pilih store tujuan...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Transfer</label>
                        <input type="number" id="outgoingQty" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Stok tersedia: <span id="availableStock">0</span></p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan (Opsional)</label>
                        <textarea id="outgoingNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Alasan transfer atau catatan lainnya..."></textarea>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeOutgoingModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="processOutgoingTransfer()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                        Transfer Keluar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Edit Modal -->
    <div id="bulkEditModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Edit Massal Barang Terpilih</h3>
                    <p class="text-sm text-gray-600 mt-1">Edit beberapa barang sekaligus. Kosongkan field yang tidak ingin diubah.</p>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-blue-800 text-sm">
                                    <span id="selectedItemsCount">0</span> barang dipilih untuk diedit
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kategori Baru</label>
                                <select id="bulkCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">-- Tidak diubah --</option>
                                    <option value="Elektronik">Elektronik</option>
                                    <option value="Aksesoris">Aksesoris</option>
                                    <option value="Furniture">Furniture</option>
                                    <option value="Alat Tulis">Alat Tulis</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Unit Baru</label>
                                <select id="bulkUnit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">-- Tidak diubah --</option>
                                </select>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Minimum Stock Baru</label>
                                <input type="number" id="bulkMinStock" min="0" placeholder="Kosongkan jika tidak diubah" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Penyesuaian Stok</label>
                                <div class="flex space-x-2">
                                    <select id="bulkStockAction" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="">-- Tidak diubah --</option>
                                        <option value="add">Tambah (+)</option>
                                        <option value="subtract">Kurangi (-)</option>
                                        <option value="set">Set ke nilai</option>
                                    </select>
                                    <input type="number" id="bulkStockValue" min="0" placeholder="Jumlah" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan Perubahan</label>
                        <textarea id="bulkEditNotes" rows="3" placeholder="Alasan atau catatan untuk perubahan ini..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            <div class="text-sm text-yellow-800">
                                <p class="font-medium">Peringatan:</p>
                                <p>Perubahan ini akan mempengaruhi semua barang yang dipilih. Pastikan data yang dimasukkan sudah benar sebelum menyimpan.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeBulkEditModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="processBulkEdit()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Simpan Perubahan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b text-center">
                    <div class="bg-primary text-white p-3 rounded-full w-16 h-16 mx-auto mb-4">
                        <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">Warehouse Management System</h3>
                    <p class="text-sm text-gray-600 mt-1">Silakan login untuk mengakses sistem</p>
                </div>
                <div class="p-6">
                    <form id="loginForm" onsubmit="processLogin(event)">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input type="text" id="loginUsername" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Masukkan username">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="loginPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent pr-10" placeholder="Masukkan password">
                                    <button type="button" onclick="togglePasswordVisibility()" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                        <svg id="eyeIcon" class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div id="loginError" class="hidden bg-red-50 border border-red-200 rounded-lg p-3">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span id="loginErrorMessage" class="text-red-800 text-sm"></span>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="w-full mt-6 bg-primary text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                            Masuk
                        </button>
                    </form>
                    
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="text-sm text-blue-800">
                                <p class="font-medium mb-2">Demo Accounts:</p>
                                <div class="space-y-1 text-xs">
                                    <p><strong>Admin:</strong> admin / admin123</p>
                                    <p><strong>Manager:</strong> manager1 / manager123</p>
                                    <p><strong>Staff:</strong> staff1 / staff123</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Download Data Modal -->
    <div id="downloadModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Unduh Data Gudang</h3>
                    <p class="text-sm text-gray-600 mt-1">Pilih jenis data dan format file yang ingin diunduh</p>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Pilih Jenis Data:</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="dataType" value="incoming" class="mr-3 text-primary focus:ring-primary">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Data Barang Masuk</span>
                                </div>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="dataType" value="status" class="mr-3 text-primary focus:ring-primary">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Status Verifikasi</span>
                                </div>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="dataType" value="store" class="mr-3 text-primary focus:ring-primary">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 text-purple-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Kartu Store</span>
                                </div>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="dataType" value="history" class="mr-3 text-primary focus:ring-primary">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 text-orange-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Riwayat Transaksi</span>
                                </div>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="dataType" value="recap" class="mr-3 text-primary focus:ring-primary" checked>
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                                    </svg>
                                    <span>Rekap Data</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Format File:</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="flex items-center justify-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="radio" name="fileFormat" value="excel" class="mr-2 text-primary focus:ring-primary" checked>
                                <div class="text-center">
                                    <svg class="w-6 h-6 text-green-600 mx-auto mb-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-sm font-medium">Excel</span>
                                    <div class="text-xs text-gray-500">.xlsx</div>
                                </div>
                            </label>
                            <label class="flex items-center justify-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="radio" name="fileFormat" value="pdf" class="mr-2 text-primary focus:ring-primary">
                                <div class="text-center">
                                    <svg class="w-6 h-6 text-red-600 mx-auto mb-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-sm font-medium">PDF</span>
                                    <div class="text-xs text-gray-500">.pdf</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-3 rounded-lg">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                            <div class="text-sm text-blue-800">
                                <p class="font-medium">Informasi:</p>
                                <p>File akan diunduh dengan data terbaru sesuai filter yang aktif saat ini.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-6 border-t flex justify-end space-x-3">
                    <button onclick="closeDownloadModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Batal
                    </button>
                    <button onclick="processDownload()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Unduh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database barang master
        const masterItems = [
            { code: 'ITM001', name: 'Laptop Dell XPS 13', unit: 'unit', minStock: 10, category: 'Elektronik' },
            { code: 'ITM002', name: 'Keyboard Mechanical', unit: 'unit', minStock: 15, category: 'Aksesoris' },
            { code: 'ITM003', name: 'Mouse Wireless', unit: 'unit', minStock: 20, category: 'Aksesoris' },
            { code: 'ITM004', name: 'Monitor LED 24 inch', unit: 'unit', minStock: 5, category: 'Elektronik' },
            { code: 'ITM005', name: 'Printer Inkjet', unit: 'unit', minStock: 3, category: 'Elektronik' },
            { code: 'ITM006', name: 'Headset Gaming', unit: 'unit', minStock: 12, category: 'Aksesoris' },
            { code: 'ITM007', name: 'Webcam HD', unit: 'unit', minStock: 8, category: 'Aksesoris' },
            { code: 'ITM008', name: 'Speaker Bluetooth', unit: 'unit', minStock: 15, category: 'Elektronik' },
            { code: 'ITM009', name: 'Laptop Asus ROG', unit: 'unit', minStock: 8, category: 'Elektronik' },
            { code: 'ITM010', name: 'Laptop HP Pavilion', unit: 'unit', minStock: 12, category: 'Elektronik' },
            { code: 'ITM011', name: 'Laptop Lenovo ThinkPad', unit: 'unit', minStock: 6, category: 'Elektronik' },
            { code: 'ITM012', name: 'Mouse Gaming RGB', unit: 'unit', minStock: 25, category: 'Aksesoris' },
            { code: 'ITM013', name: 'Mouse Pad Gaming', unit: 'unit', minStock: 30, category: 'Aksesoris' },
            { code: 'ITM014', name: 'Keyboard Gaming RGB', unit: 'unit', minStock: 18, category: 'Aksesoris' },
            { code: 'ITM015', name: 'Monitor Gaming 27 inch', unit: 'unit', minStock: 4, category: 'Elektronik' },
            { code: 'ITM016', name: 'Printer Laser', unit: 'unit', minStock: 2, category: 'Elektronik' },
            { code: 'ITM017', name: 'Scanner Document', unit: 'unit', minStock: 3, category: 'Elektronik' },
            { code: 'ITM018', name: 'Headphone Wireless', unit: 'unit', minStock: 20, category: 'Aksesoris' },
            { code: 'ITM019', name: 'Microphone USB', unit: 'unit', minStock: 10, category: 'Aksesoris' },
            { code: 'ITM020', name: 'Tablet Android', unit: 'unit', minStock: 7, category: 'Elektronik' }
        ];

        // Data barang masuk
        let incomingItems = [
            { id: 1, date: '2024-12-15', code: 'ITM001', name: 'Laptop Dell XPS 13', qty: 5, unit: 'unit', minStock: 10, status: 'Menunggu Verifikasi' },
            { id: 2, date: '2024-12-15', code: 'ITM003', name: 'Mouse Wireless', qty: 20, unit: 'unit', minStock: 20, status: 'Menunggu Verifikasi' }
        ];

        // Data store
        const stores = [
            { code: '01', name: 'GENERAL STORE (ANYER)' },
            { code: '02', name: 'General store (JKT)' },
            { code: '03', name: 'MAIN KITCHEN STORAGE' },
            { code: '04', name: 'F&B ADMIN' },
            { code: '05', name: 'HOUSEKEEPING' },
            { code: '10', name: 'ENGINEERING STORE' },
            { code: '11', name: 'PROJECT STORE' },
            { code: '12', name: 'ADMIN & GENERAL' },
            { code: '13', name: 'SALES & MARKETING' },
            { code: '14', name: 'SECURITY' },
            { code: '15', name: 'FRONT OFFICE' },
            { code: '16', name: 'SPA' },
            { code: '17', name: 'HRD' },
            { code: '21', name: 'D\'BISTRO' },
            { code: '22', name: 'KOREAN STORE (KANTIN)' },
            { code: '23', name: 'DBAR STORE' },
            { code: '24', name: 'LIQUOR STORE' },
            { code: '25', name: 'SOUVENIR SHOP' },
            { code: '26', name: 'SPORT & RECREATION' },
            { code: '27', name: 'JAPANESE STORE' },
            { code: '28', name: 'DRAGON BEACH CLUB STORE' },
            { code: '29', name: 'SUNSET GRILL STORE' },
            { code: '31', name: 'BANQUET STORE' },
            { code: '40', name: 'LAUNDRY STORE' }
        ];

        // Data stok per store
        let storeInventory = [
            { id: 1, storeCode: '01', storeName: 'GENERAL STORE (ANYER)', itemCode: 'ITM001', itemName: 'Laptop Dell XPS 13', qty: 15, unit: 'unit', transferDate: '2024-12-10', transferBy: 'Admin' },
            { id: 2, storeCode: '01', storeName: 'GENERAL STORE (ANYER)', itemCode: 'ITM003', itemName: 'Mouse Wireless', qty: 25, unit: 'unit', transferDate: '2024-12-12', transferBy: 'Admin' },
            { id: 3, storeCode: '02', storeName: 'General store (JKT)', itemCode: 'ITM001', itemName: 'Laptop Dell XPS 13', qty: 10, unit: 'unit', transferDate: '2024-12-11', transferBy: 'Admin' },
            { id: 4, storeCode: '03', storeName: 'MAIN KITCHEN STORAGE', itemCode: 'ITM002', itemName: 'Keyboard Mechanical', qty: 8, unit: 'unit', transferDate: '2024-12-13', transferBy: 'Admin' },
            { id: 5, storeCode: '05', storeName: 'HOUSEKEEPING', itemCode: 'ITM003', itemName: 'Mouse Wireless', qty: 20, unit: 'unit', transferDate: '2024-12-14', transferBy: 'Admin' }
        ];

        let nextIncomingId = 3;
        let nextStoreInventoryId = 6;

        // Data rekap dengan stok saat ini dan transaksi
        const rekapData = [
            { code: 'ITM001', name: 'Laptop Dell XPS 13', category: 'Elektronik', currentStock: 25, minStock: 10, unit: 'unit', totalIn: 30, totalOut: 5 },
            { code: 'ITM002', name: 'Keyboard Mechanical', category: 'Aksesoris', currentStock: 8, minStock: 15, unit: 'unit', totalIn: 25, totalOut: 17 },
            { code: 'ITM003', name: 'Mouse Wireless', category: 'Aksesoris', currentStock: 45, minStock: 20, unit: 'unit', totalIn: 60, totalOut: 15 },
            { code: 'ITM004', name: 'Monitor LED 24 inch', category: 'Elektronik', currentStock: 12, minStock: 5, unit: 'unit', totalIn: 15, totalOut: 3 },
            { code: 'ITM005', name: 'Printer Inkjet', category: 'Elektronik', currentStock: 7, minStock: 3, unit: 'unit', totalIn: 10, totalOut: 3 },
            { code: 'ITM006', name: 'Headset Gaming', category: 'Aksesoris', currentStock: 18, minStock: 12, unit: 'unit', totalIn: 25, totalOut: 7 },
            { code: 'ITM007', name: 'Webcam HD', category: 'Aksesoris', currentStock: 5, minStock: 8, unit: 'unit', totalIn: 12, totalOut: 7 },
            { code: 'ITM008', name: 'Speaker Bluetooth', category: 'Elektronik', currentStock: 22, minStock: 15, unit: 'unit', totalIn: 30, totalOut: 8 },
            { code: 'ITM009', name: 'Laptop Asus ROG', category: 'Elektronik', currentStock: 14, minStock: 8, unit: 'unit', totalIn: 20, totalOut: 6 },
            { code: 'ITM010', name: 'Laptop HP Pavilion', category: 'Elektronik', currentStock: 19, minStock: 12, unit: 'unit', totalIn: 25, totalOut: 6 },
            { code: 'ITM011', name: 'Laptop Lenovo ThinkPad', category: 'Elektronik', currentStock: 11, minStock: 6, unit: 'unit', totalIn: 15, totalOut: 4 },
            { code: 'ITM012', name: 'Mouse Gaming RGB', category: 'Aksesoris', currentStock: 35, minStock: 25, unit: 'unit', totalIn: 50, totalOut: 15 },
            { code: 'ITM013', name: 'Mouse Pad Gaming', category: 'Aksesoris', currentStock: 42, minStock: 30, unit: 'unit', totalIn: 60, totalOut: 18 },
            { code: 'ITM014', name: 'Keyboard Gaming RGB', category: 'Aksesoris', currentStock: 28, minStock: 18, unit: 'unit', totalIn: 40, totalOut: 12 },
            { code: 'ITM015', name: 'Monitor Gaming 27 inch', category: 'Elektronik', currentStock: 8, minStock: 4, unit: 'unit', totalIn: 12, totalOut: 4 },
            { code: 'ITM016', name: 'Printer Laser', category: 'Elektronik', currentStock: 3, minStock: 2, unit: 'unit', totalIn: 5, totalOut: 2 },
            { code: 'ITM017', name: 'Scanner Document', category: 'Elektronik', currentStock: 4, minStock: 3, unit: 'unit', totalIn: 8, totalOut: 4 },
            { code: 'ITM018', name: 'Headphone Wireless', category: 'Aksesoris', currentStock: 32, minStock: 20, unit: 'unit', totalIn: 45, totalOut: 13 },
            { code: 'ITM019', name: 'Microphone USB', category: 'Aksesoris', currentStock: 15, minStock: 10, unit: 'unit', totalIn: 20, totalOut: 5 },
            { code: 'ITM020', name: 'Tablet Android', category: 'Elektronik', currentStock: 0, minStock: 7, unit: 'unit', totalIn: 10, totalOut: 10 }
        ];

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        // Section navigation
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');

            // Update active nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('bg-blue-50', 'text-primary');
                item.classList.add('text-gray-700');
            });

            event.target.classList.add('bg-blue-50', 'text-primary');
            event.target.classList.remove('text-gray-700');

            // Close mobile menu
            if (window.innerWidth < 768) {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        // Real-time code validation
        function validateCodeInput() {
            const codeInput = document.getElementById('incomingCode');
            const validationMessage = document.getElementById('codeValidationMessage');
            const code = codeInput.value.trim().toUpperCase();
            
            if (!code) {
                validationMessage.classList.add('hidden');
                return;
            }
            
            // Check if item exists in rekap data
            const existingItem = rekapData.find(item => item.code.toUpperCase() === code);
            
            if (existingItem) {
                validationMessage.textContent = `âœ“ ${existingItem.name} - akan terisi otomatis`;
                validationMessage.className = 'text-xs mt-1 text-green-600';
                validationMessage.classList.remove('hidden');
            } else {
                validationMessage.textContent = 'â„¹ Kode baru - lengkapi semua data';
                validationMessage.className = 'text-xs mt-1 text-blue-600';
                validationMessage.classList.remove('hidden');
            }
        }

        // Auto-fill item data based on code
        function autoFillItemData() {
            const codeInput = document.getElementById('incomingCode');
            const nameInput = document.getElementById('incomingName');
            const unitInput = document.getElementById('incomingUnit');
            const minStockInput = document.getElementById('incomingMinStock');
            const validationMessage = document.getElementById('codeValidationMessage');
            
            const code = codeInput.value.trim().toUpperCase();
            
            if (!code) {
                // Clear validation message and enable all fields
                validationMessage.classList.add('hidden');
                enableAllFields();
                populateUnitDropdownForNewItem(); // Populate with all active units
                return;
            }
            
            // Check if item exists in rekap data
            const existingItem = rekapData.find(item => item.code.toUpperCase() === code);
            
            if (existingItem) {
                // Auto-fill fields with existing data
                nameInput.value = existingItem.name;
                minStockInput.value = existingItem.minStock;
                
                // Populate unit dropdown with all active units but set current value
                populateUnitDropdownForExistingItem(existingItem.unit);
                
                // Make name and minStock readonly, but keep unit dropdown enabled
                nameInput.readOnly = true;
                unitInput.disabled = false; // Keep unit dropdown enabled
                minStockInput.readOnly = true;
                
                // Add visual indication only to readonly fields
                nameInput.classList.add('bg-gray-50');
                unitInput.classList.remove('bg-gray-50'); // Keep unit dropdown normal
                minStockInput.classList.add('bg-gray-50');
                
                // Show success message
                validationMessage.textContent = 'âœ“ Barang ditemukan - data terisi otomatis (unit dapat diubah)';
                validationMessage.className = 'text-xs mt-1 text-green-600';
                validationMessage.classList.remove('hidden');
                
                // Update code to match case
                codeInput.value = existingItem.code;
                
                showNotification(`Data barang ${existingItem.name} berhasil dimuat! Unit dapat diubah jika diperlukan.`, 'success');
            } else {
                // Item not found - enable all fields for manual input
                enableAllFields();
                populateUnitDropdownForNewItem(); // Populate with all active units
                
                // Show info message
                validationMessage.textContent = 'â„¹ Kode barang baru - silakan lengkapi semua data';
                validationMessage.className = 'text-xs mt-1 text-blue-600';
                validationMessage.classList.remove('hidden');
                
                // Update code to uppercase
                codeInput.value = code;
                
                showNotification('Kode barang baru terdeteksi. Mohon lengkapi semua data.', 'info');
            }
        }
        
        function enableAllFields() {
            const nameInput = document.getElementById('incomingName');
            const unitInput = document.getElementById('incomingUnit');
            const minStockInput = document.getElementById('incomingMinStock');
            
            // Enable fields
            nameInput.readOnly = false;
            unitInput.disabled = false;
            minStockInput.readOnly = false;
            
            // Remove visual indication
            nameInput.classList.remove('bg-gray-50');
            unitInput.classList.remove('bg-gray-50');
            minStockInput.classList.remove('bg-gray-50');
        }

        // Populate unit dropdown for new items (all active units)
        function populateUnitDropdownForNewItem() {
            const unitDropdown = document.getElementById('incomingUnit');
            
            // Clear existing options
            unitDropdown.innerHTML = '<option value="">Pilih Unit</option>';
            
            // Add all active units from settings
            const activeUnits = units.filter(unit => unit.status === 'Aktif');
            activeUnits.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.abbr;
                option.textContent = `${unit.name} (${unit.abbr})`;
                unitDropdown.appendChild(option);
            });
            
            // Reset selection
            unitDropdown.value = '';
        }

        // Populate unit dropdown for existing items (all active units with current selected)
        function populateUnitDropdownForExistingItem(currentUnit) {
            const unitDropdown = document.getElementById('incomingUnit');
            
            // Clear existing options
            unitDropdown.innerHTML = '<option value="">Pilih Unit</option>';
            
            // Add all active units from settings
            const activeUnits = units.filter(unit => unit.status === 'Aktif');
            activeUnits.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.abbr;
                option.textContent = `${unit.name} (${unit.abbr})`;
                
                // Mark current unit as selected
                if (unit.abbr === currentUnit) {
                    option.selected = true;
                }
                
                unitDropdown.appendChild(option);
            });
            
            // If current unit is not in active units, add it as disabled option
            const currentUnitExists = activeUnits.some(unit => unit.abbr === currentUnit);
            if (!currentUnitExists && currentUnit) {
                const option = document.createElement('option');
                option.value = currentUnit;
                option.textContent = `${currentUnit} (Unit tidak aktif)`;
                option.selected = true;
                option.disabled = true;
                option.style.color = '#9CA3AF';
                unitDropdown.appendChild(option);
            }
        }

        // Simple incoming form functions
        function clearIncomingForm() {
            document.getElementById('incomingDate').value = '';
            document.getElementById('incomingCode').value = '';
            document.getElementById('incomingName').value = '';
            document.getElementById('incomingQty').value = '';
            document.getElementById('incomingMinStock').value = '';
            document.getElementById('codeValidationMessage').classList.add('hidden');
            enableAllFields();
            populateUnitDropdownForNewItem(); // Reset unit dropdown to show all active units
        }

        // Tambah barang ke daftar incoming
        function addIncomingItem() {
            const date = document.getElementById('incomingDate').value;
            const code = document.getElementById('incomingCode').value.trim().toUpperCase();
            const name = document.getElementById('incomingName').value.trim();
            const qty = document.getElementById('incomingQty').value;
            const unit = document.getElementById('incomingUnit').value.trim();
            const minStock = document.getElementById('incomingMinStock').value;

            // Validasi input
            if (!date || !code || !name || !qty || !unit || !minStock) {
                showNotification('Mohon lengkapi semua field!', 'error');
                return;
            }

            if (parseInt(qty) <= 0) {
                showNotification('Quantity harus lebih dari 0!', 'error');
                return;
            }

            if (parseInt(minStock) < 0) {
                showNotification('Min Stock tidak boleh negatif!', 'error');
                return;
            }

            // Check if this is a new item (not in rekap data)
            const existingInRekap = rekapData.find(item => item.code.toUpperCase() === code);
            const isNewItem = !existingInRekap;

            // Cek apakah kode barang sudah ada dalam daftar incoming yang belum diverifikasi
            const existingItem = incomingItems.find(item => 
                item.code === code && item.status === 'Menunggu Verifikasi'
            );

            if (existingItem) {
                if (confirm(`Barang dengan kode ${code} sudah ada dalam daftar. Apakah ingin menambah quantity?`)) {
                    existingItem.qty += parseInt(qty);
                    renderIncomingTable();
                    renderStatusTable();
                    clearIncomingForm();
                    showNotification(`Quantity barang ${code} berhasil ditambahkan!`, 'success');
                }
                return;
            }

            const newItem = {
                id: nextIncomingId++,
                date: date,
                code: code,
                name: name,
                qty: parseInt(qty),
                unit: unit,
                minStock: parseInt(minStock),
                status: 'Menunggu Verifikasi'
            };

            incomingItems.push(newItem);
            
            // If this is a new item, add it to rekap data with 0 current stock
            if (isNewItem) {
                const newRekapItem = {
                    code: code,
                    name: name,
                    category: 'Elektronik', // Default category for new items
                    currentStock: 0,
                    minStock: parseInt(minStock),
                    unit: unit,
                    totalIn: 0,
                    totalOut: 0
                };
                rekapData.push(newRekapItem);
                
                // Also add to master items
                const newMasterItem = {
                    code: code,
                    name: name,
                    unit: unit,
                    minStock: parseInt(minStock),
                    category: 'Elektronik'
                };
                masterItems.push(newMasterItem);
                
                // Add to history
                addHistoryRecord(
                    'Barang Masuk',
                    { name: name, code: code },
                    parseInt(qty),
                    unit,
                    'GUDANG',
                    `Barang baru masuk menunggu verifikasi - ${name} (${code})`
                );
                
                showNotification(`Barang baru "${name}" berhasil ditambahkan ke sistem!`, 'success');
            } else {
                // Add to history for existing item
                addHistoryRecord(
                    'Barang Masuk',
                    { name: name, code: code },
                    parseInt(qty),
                    unit,
                    'GUDANG',
                    'Barang masuk menunggu verifikasi'
                );
                
                showNotification('Barang berhasil ditambahkan ke daftar!', 'success');
            }
            
            renderIncomingTable();
            renderStatusTable();
            renderRekapTable();
            updateRekapSummary();
            renderHistoryTable();
            updateHistorySummary();
            clearIncomingForm();
        }

        // Render tabel incoming
        function renderIncomingTable(items = incomingItems) {
            const tbody = document.getElementById('incomingTableBody');
            tbody.innerHTML = '';

            items.forEach((item, index) => {
                const statusClass = item.status === 'Diverifikasi' ? 'bg-green-100 text-green-800' : 
                                  item.status === 'Menunggu Verifikasi' ? 'bg-yellow-100 text-yellow-800' : 
                                  item.status === 'Ditransfer' ? 'bg-blue-100 text-blue-800' :
                                  'bg-red-100 text-red-800';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(item.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.qty}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.minStock}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${item.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        ${item.status === 'Menunggu Verifikasi' ? 
                            `<button onclick="editIncomingItem(${item.id})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                             <button onclick="deleteIncomingItem(${item.id})" class="text-red-600 hover:text-red-800">Hapus</button>` :
                            '<span class="text-gray-400">Tidak dapat diedit</span>'
                        }
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Filter incoming items
        function filterIncomingItems() {
            const searchTerm = document.getElementById('searchIncoming').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const dateFilter = document.getElementById('filterDate').value;

            let filtered = incomingItems.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                    item.code.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || item.status === statusFilter;
                const matchesDate = !dateFilter || item.date === dateFilter;

                return matchesSearch && matchesStatus && matchesDate;
            });

            renderIncomingTable(filtered);
        }

        // Setup search real-time
        function setupIncomingSearch() {
            const searchInput = document.getElementById('searchIncoming');
            searchInput.addEventListener('input', filterIncomingItems);
        }

        function editIncomingItem(index) {
            const item = incomingItems[index];
            // Implementasi edit - bisa menggunakan modal atau form
            alert(`Edit item: ${item.name} (${item.code})`);
        }

        function deleteIncomingItem(index) {
            if (confirm('Yakin ingin menghapus item ini?')) {
                incomingItems.splice(index, 1);
                renderIncomingTable();
                alert('Item berhasil dihapus!');
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        // Modal functions
        function showAddItemModal() {
            document.getElementById('addItemModal').classList.remove('hidden');
        }

        function closeAddItemModal() {
            document.getElementById('addItemModal').classList.add('hidden');
            // Clear form
            document.getElementById('itemCode').value = '';
            document.getElementById('itemName').value = '';
            document.getElementById('itemQuantity').value = '';
        }

        function addItem() {
            const code = document.getElementById('itemCode').value;
            const name = document.getElementById('itemName').value;
            const quantity = document.getElementById('itemQuantity').value;

            if (code && name && quantity) {
                alert(`Barang berhasil ditambahkan!\nKode: ${code}\nNama: ${name}\nJumlah: ${quantity} unit`);
                closeAddItemModal();
            } else {
                alert('Mohon lengkapi semua field!');
            }
        }

        // Data riwayat transaksi (sample data)
        let historyData = [
            { id: 1, date: '2024-12-15', time: '14:30', type: 'Barang Masuk', item: 'Laptop Dell XPS 13', code: 'ITM001', qty: 5, unit: 'unit', user: 'Admin', store: 'GUDANG', notes: 'Pembelian rutin dari supplier' },
            { id: 2, date: '2024-12-15', time: '12:15', type: 'Transfer Masuk', item: 'Mouse Wireless', code: 'ITM003', qty: 10, unit: 'unit', user: 'Staff1', store: '01 - GENERAL STORE (ANYER)', notes: 'Transfer dari gudang ke store' },
            { id: 3, date: '2024-12-15', time: '10:45', type: 'Update Stok', item: 'Keyboard Mechanical', code: 'ITM002', qty: 15, unit: 'unit', user: 'Manager1', store: 'GUDANG', notes: 'Penyesuaian stok minimum dari 10 menjadi 15' },
            { id: 4, date: '2024-12-14', time: '16:20', type: 'Barang Masuk', item: 'Monitor LED 24 inch', code: 'ITM004', qty: 8, unit: 'unit', user: 'Admin', store: 'GUDANG', notes: 'Pengadaan baru untuk Q4' },
            { id: 5, date: '2024-12-14', time: '14:10', type: 'Verifikasi', item: 'Headset Gaming', code: 'ITM006', qty: 12, unit: 'unit', user: 'Manager1', store: 'GUDANG', notes: 'Verifikasi barang masuk - approved' },
            { id: 6, date: '2024-12-14', time: '11:30', type: 'Transfer Masuk', item: 'Printer Inkjet', code: 'ITM005', qty: 2, unit: 'unit', user: 'Admin', store: '03 - MAIN KITCHEN STORAGE', notes: 'Transfer dari gudang ke kitchen storage' },
            { id: 7, date: '2024-12-13', time: '15:45', type: 'Transfer Keluar', item: 'Webcam HD', code: 'ITM007', qty: 5, unit: 'unit', user: 'Staff2', store: '01 - GENERAL STORE (ANYER)', notes: 'Transfer ke store 02 untuk kebutuhan operasional' },
            { id: 8, date: '2024-12-13', time: '13:20', type: 'Barang Masuk', item: 'Speaker Bluetooth', code: 'ITM008', qty: 20, unit: 'unit', user: 'Admin', store: 'GUDANG', notes: 'Restok bulanan dari vendor' },
            { id: 9, date: '2024-12-12', time: '16:15', type: 'Transfer Masuk', item: 'Laptop Asus ROG', code: 'ITM009', qty: 3, unit: 'unit', user: 'Admin', store: '02 - General store (JKT)', notes: 'Transfer untuk kebutuhan kantor Jakarta' },
            { id: 10, date: '2024-12-12', time: '14:30', type: 'Verifikasi', item: 'Mouse Gaming RGB', code: 'ITM012', qty: 25, unit: 'unit', user: 'Manager1', store: 'GUDANG', notes: 'Verifikasi barang masuk - quality check passed' },
            { id: 11, date: '2024-12-11', time: '11:20', type: 'Transfer Keluar', item: 'Keyboard Gaming RGB', code: 'ITM014', qty: 8, unit: 'unit', user: 'Staff1', store: '05 - HOUSEKEEPING', notes: 'Transfer ke store 15 untuk front office' },
            { id: 12, date: '2024-12-11', time: '09:45', type: 'Barang Masuk', item: 'Tablet Android', code: 'ITM020', qty: 10, unit: 'unit', user: 'Admin', store: 'GUDANG', notes: 'Pengadaan tablet untuk mobile operations' },
            { id: 13, date: '2024-12-10', time: '17:30', type: 'Transfer Masuk', item: 'Headphone Wireless', code: 'ITM018', qty: 15, unit: 'unit', user: 'Staff2', store: '25 - SOUVENIR SHOP', notes: 'Transfer untuk display dan demo produk' },
            { id: 14, date: '2024-12-10', time: '15:10', type: 'Update Stok', item: 'Microphone USB', code: 'ITM019', qty: 10, unit: 'unit', user: 'Manager1', store: 'GUDANG', notes: 'Koreksi stok setelah stock opname' },
            { id: 15, date: '2024-12-09', time: '13:25', type: 'Barang Masuk', item: 'Scanner Document', code: 'ITM017', qty: 4, unit: 'unit', user: 'Admin', store: 'GUDANG', notes: 'Pembelian untuk upgrade peralatan kantor' },
            { id: 16, date: '2024-12-09', time: '10:40', type: 'Transfer Keluar', item: 'Monitor Gaming 27 inch', code: 'ITM015', qty: 2, unit: 'unit', user: 'Staff1', store: '12 - ADMIN & GENERAL', notes: 'Transfer ke store 13 untuk sales & marketing' },
            { id: 17, date: '2024-12-08', time: '16:55', type: 'Verifikasi', item: 'Printer Laser', code: 'ITM016', qty: 2, unit: 'unit', user: 'Manager1', store: 'GUDANG', notes: 'Verifikasi barang masuk - dokumentasi lengkap' },
            { id: 18, date: '2024-12-08', time: '14:20', type: 'Transfer Masuk', item: 'Mouse Pad Gaming', code: 'ITM013', qty: 30, unit: 'unit', user: 'Admin', store: '26 - SPORT & RECREATION', notes: 'Transfer untuk gaming area' },
            { id: 19, date: '2024-12-07', time: '12:15', type: 'Barang Masuk', item: 'Laptop HP Pavilion', code: 'ITM010', qty: 6, unit: 'unit', user: 'Admin', store: 'GUDANG', notes: 'Pengadaan laptop untuk staff baru' },
            { id: 20, date: '2024-12-07', time: '09:30', type: 'Transfer Keluar', item: 'Laptop Lenovo ThinkPad', code: 'ITM011', qty: 4, unit: 'unit', user: 'Staff2', store: '17 - HRD', notes: 'Transfer ke store 04 untuk F&B admin' }
        ];

        // Pagination variables for history
        let currentHistoryPage = 1;
        let historyItemsPerPage = 10;
        let filteredHistoryData = [...historyData];

        // Download modal functions
        function showDownloadModal() {
            document.getElementById('downloadModal').classList.remove('hidden');
        }

        function closeDownloadModal() {
            document.getElementById('downloadModal').classList.add('hidden');
        }

        function processDownload() {
            const dataType = document.querySelector('input[name="dataType"]:checked').value;
            const fileFormat = document.querySelector('input[name="fileFormat"]:checked').value;

            if (!dataType || !fileFormat) {
                alert('Mohon pilih jenis data dan format file!');
                return;
            }

            // Show loading notification
            showNotification('Memproses unduhan...', 'info');

            // Process download based on type and format
            setTimeout(() => {
                if (fileFormat === 'excel') {
                    downloadExcel(dataType);
                } else if (fileFormat === 'pdf') {
                    downloadPDF(dataType);
                }
                closeDownloadModal();
            }, 1000);
        }

        function downloadExcel(dataType) {
            let data, filename, headers;

            switch (dataType) {
                case 'incoming':
                    data = incomingItems;
                    filename = `data-barang-masuk-${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Tanggal', 'Kode Barang', 'Nama Barang', 'Qty', 'Unit', 'Min Stock', 'Status'];
                    break;
                case 'status':
                    data = incomingItems.filter(item => item.status !== 'Diterima');
                    filename = `status-verifikasi-${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Tanggal', 'Kode Barang', 'Nama Barang', 'Qty', 'Unit', 'Status'];
                    break;
                case 'store':
                    data = storeInventory;
                    filename = `kartu-store-${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Store Code', 'Store Name', 'Kode Barang', 'Nama Barang', 'Qty', 'Unit', 'Tanggal Transfer', 'Transfer By'];
                    break;
                case 'history':
                    data = historyData;
                    filename = `riwayat-transaksi-${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Tanggal', 'Waktu', 'Jenis Transaksi', 'Kode Barang', 'Nama Barang', 'Qty', 'Unit', 'User', 'Catatan'];
                    break;
                case 'recap':
                    data = rekapData;
                    filename = `rekap-data-gudang-${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Kode', 'Nama Barang', 'Kategori', 'Stok Saat Ini', 'Min Stock', 'Unit', 'Total Masuk', 'Total Keluar', 'Status'];
                    break;
                default:
                    return;
            }

            generateCSV(data, headers, filename, dataType);
        }

        function generateCSV(data, headers, filename, dataType) {
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // BOM for UTF-8
            
            // Add headers
            csvContent += headers.join(',') + '\n';
            
            // Add data rows
            data.forEach(item => {
                let row;
                switch (dataType) {
                    case 'incoming':
                        row = [
                            formatDate(item.date),
                            item.code,
                            `"${item.name}"`,
                            item.qty,
                            item.unit,
                            item.minStock,
                            item.status
                        ];
                        break;
                    case 'status':
                        row = [
                            formatDate(item.date),
                            item.code,
                            `"${item.name}"`,
                            item.qty,
                            item.unit,
                            item.status
                        ];
                        break;
                    case 'store':
                        row = [
                            item.storeCode,
                            `"${item.storeName}"`,
                            item.itemCode,
                            `"${item.itemName}"`,
                            item.qty,
                            item.unit,
                            formatDate(item.transferDate),
                            item.transferBy
                        ];
                        break;
                    case 'history':
                        row = [
                            item.date,
                            item.time,
                            item.type,
                            item.code,
                            `"${item.item}"`,
                            item.qty,
                            item.unit,
                            item.user,
                            `"${item.notes}"`
                        ];
                        break;
                    case 'recap':
                        const status = getStockStatus(item.currentStock, item.minStock);
                        row = [
                            item.code,
                            `"${item.name}"`,
                            item.category,
                            item.currentStock,
                            item.minStock,
                            item.unit,
                            item.totalIn,
                            item.totalOut,
                            status
                        ];
                        break;
                }
                csvContent += row.join(',') + '\n';
            });

            // Create and download file
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification(`File Excel berhasil diunduh: ${filename}`, 'success');
        }

        function downloadPDF(dataType) {
            let content, filename, title;

            switch (dataType) {
                case 'incoming':
                    content = generateIncomingPDFContent();
                    filename = `data-barang-masuk-${new Date().toISOString().split('T')[0]}.pdf`;
                    title = 'Laporan Data Barang Masuk';
                    break;
                case 'status':
                    content = generateStatusPDFContent();
                    filename = `status-verifikasi-${new Date().toISOString().split('T')[0]}.pdf`;
                    title = 'Laporan Status Verifikasi';
                    break;
                case 'store':
                    content = generateStorePDFContent();
                    filename = `kartu-store-${new Date().toISOString().split('T')[0]}.pdf`;
                    title = 'Laporan Kartu Store';
                    break;
                case 'history':
                    content = generateHistoryPDFContent();
                    filename = `riwayat-transaksi-${new Date().toISOString().split('T')[0]}.pdf`;
                    title = 'Laporan Riwayat Transaksi';
                    break;
                case 'recap':
                    content = generateRecapPDFContent();
                    filename = `rekap-data-gudang-${new Date().toISOString().split('T')[0]}.pdf`;
                    title = 'Laporan Rekap Data Gudang';
                    break;
                default:
                    return;
            }

            generatePDF(content, filename, title);
        }

        function generatePDF(content, filename, title) {
            // Create HTML content for PDF
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 10px; }
                        .company-info { margin-bottom: 20px; }
                        .report-info { margin-bottom: 20px; background: #f5f5f5; padding: 10px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .status-badge { padding: 2px 6px; border-radius: 3px; font-size: 10px; }
                        .status-aman { background: #d4edda; color: #155724; }
                        .status-rendah { background: #fff3cd; color: #856404; }
                        .status-habis { background: #f8d7da; color: #721c24; }
                        .footer { margin-top: 30px; text-align: center; font-size: 10px; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${title}</h1>
                        <h3>Warehouse Management System</h3>
                    </div>
                    <div class="company-info">
                        <strong>Gudang Pusat Jakarta</strong><br>
                        Jl. Industri No. 123, Jakarta Timur<br>
                        Telp: (021) 1234-5678
                    </div>
                    <div class="report-info">
                        <strong>Tanggal Cetak:</strong> ${new Date().toLocaleDateString('id-ID', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}<br>
                        <strong>Waktu Cetak:</strong> ${new Date().toLocaleTimeString('id-ID')}<br>
                        <strong>Dicetak oleh:</strong> Admin
                    </div>
                    ${content}
                    <div class="footer">
                        <p>Dokumen ini digenerate otomatis oleh Warehouse Management System</p>
                        <p>Â© 2024 Warehouse Management System. All rights reserved.</p>
                    </div>
                </body>
                </html>
            `;

            // Create blob and download
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename.replace('.pdf', '.html'); // Browser will download as HTML
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification(`File PDF berhasil diunduh: ${filename.replace('.pdf', '.html')}`, 'success');
        }

        function generateIncomingPDFContent() {
            let tableRows = '';
            incomingItems.forEach(item => {
                tableRows += `
                    <tr>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.code}</td>
                        <td>${item.name}</td>
                        <td>${item.qty}</td>
                        <td>${item.unit}</td>
                        <td>${item.minStock}</td>
                        <td><span class="status-badge">${item.status}</span></td>
                    </tr>
                `;
            });

            return `
                <h3>Summary</h3>
                <p>Total Barang Masuk: <strong>${incomingItems.length}</strong> item</p>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Kode</th>
                            <th>Nama Barang</th>
                            <th>Qty</th>
                            <th>Unit</th>
                            <th>Min Stock</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        }

        function generateStatusPDFContent() {
            const statusItems = incomingItems.filter(item => item.status !== 'Diterima');
            let tableRows = '';
            statusItems.forEach(item => {
                tableRows += `
                    <tr>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.code}</td>
                        <td>${item.name}</td>
                        <td>${item.qty}</td>
                        <td>${item.unit}</td>
                        <td><span class="status-badge">${item.status}</span></td>
                    </tr>
                `;
            });

            return `
                <h3>Summary Status Verifikasi</h3>
                <p>Total Item: <strong>${statusItems.length}</strong></p>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Kode</th>
                            <th>Nama Barang</th>
                            <th>Qty</th>
                            <th>Unit</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        }

        function generateStorePDFContent() {
            let tableRows = '';
            storeInventory.forEach(item => {
                tableRows += `
                    <tr>
                        <td>${item.storeCode}</td>
                        <td>${item.storeName}</td>
                        <td>${item.itemCode}</td>
                        <td>${item.itemName}</td>
                        <td>${item.qty}</td>
                        <td>${item.unit}</td>
                        <td>${formatDate(item.transferDate)}</td>
                        <td>${item.transferBy}</td>
                    </tr>
                `;
            });

            return `
                <h3>Summary Kartu Store</h3>
                <p>Total Store: <strong>${[...new Set(storeInventory.map(item => item.storeCode))].length}</strong></p>
                <p>Total Item: <strong>${storeInventory.length}</strong></p>
                <table>
                    <thead>
                        <tr>
                            <th>Store Code</th>
                            <th>Store Name</th>
                            <th>Kode Barang</th>
                            <th>Nama Barang</th>
                            <th>Qty</th>
                            <th>Unit</th>
                            <th>Tgl Transfer</th>
                            <th>Transfer By</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        }

        function generateHistoryPDFContent() {
            let tableRows = '';
            historyData.forEach(item => {
                tableRows += `
                    <tr>
                        <td>${item.date}</td>
                        <td>${item.time}</td>
                        <td>${item.type}</td>
                        <td>${item.code}</td>
                        <td>${item.item}</td>
                        <td>${item.qty}</td>
                        <td>${item.unit}</td>
                        <td>${item.user}</td>
                        <td>${item.notes}</td>
                    </tr>
                `;
            });

            return `
                <h3>Summary Riwayat Transaksi</h3>
                <p>Total Transaksi: <strong>${historyData.length}</strong></p>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Waktu</th>
                            <th>Jenis</th>
                            <th>Kode</th>
                            <th>Nama Barang</th>
                            <th>Qty</th>
                            <th>Unit</th>
                            <th>User</th>
                            <th>Catatan</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        }

        function generateRecapPDFContent() {
            const stokAman = rekapData.filter(item => getStockStatus(item.currentStock, item.minStock) === 'Aman').length;
            const stokRendah = rekapData.filter(item => getStockStatus(item.currentStock, item.minStock) === 'Rendah').length;
            const stokHabis = rekapData.filter(item => getStockStatus(item.currentStock, item.minStock) === 'Habis').length;

            let tableRows = '';
            rekapData.forEach(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                const statusClass = status === 'Aman' ? 'status-aman' : 
                                  status === 'Rendah' ? 'status-rendah' : 'status-habis';
                tableRows += `
                    <tr>
                        <td>${item.code}</td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td><strong>${item.currentStock}</strong></td>
                        <td>${item.minStock}</td>
                        <td>${item.unit}</td>
                        <td style="color: green;">${item.totalIn}</td>
                        <td style="color: red;">${item.totalOut}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                    </tr>
                `;
            });

            return `
                <h3>Summary Rekap Data</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <div>Total Jenis Barang: <strong>${rekapData.length}</strong></div>
                    <div>Stok Aman: <strong style="color: green;">${stokAman}</strong></div>
                    <div>Stok Rendah: <strong style="color: orange;">${stokRendah}</strong></div>
                    <div>Stok Habis: <strong style="color: red;">${stokHabis}</strong></div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Kode</th>
                            <th>Nama Barang</th>
                            <th>Kategori</th>
                            <th>Stok</th>
                            <th>Min</th>
                            <th>Unit</th>
                            <th>Masuk</th>
                            <th>Keluar</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        }

        // Legacy download function (kept for compatibility)
        function downloadData() {
            showDownloadModal();
        }

        // Data untuk pengaturan
        let units = [
            { id: 1, name: 'Unit', abbr: 'unit', description: 'Satuan untuk barang elektronik', status: 'Aktif' },
            { id: 2, name: 'Kilogram', abbr: 'kg', description: 'Satuan berat', status: 'Aktif' },
            { id: 3, name: 'Liter', abbr: 'L', description: 'Satuan volume', status: 'Aktif' },
            { id: 4, name: 'Meter', abbr: 'm', description: 'Satuan panjang', status: 'Aktif' },
            { id: 5, name: 'Kotak', abbr: 'box', description: 'Satuan kemasan', status: 'Aktif' }
        ];

        let storesData = [
            { code: '01', name: 'GENERAL STORE (ANYER)', location: 'Anyer Resort', manager: 'Budi Santoso', status: 'Aktif' },
            { code: '02', name: 'General store (JKT)', location: 'Jakarta Office', manager: 'Siti Nurhaliza', status: 'Aktif' },
            { code: '03', name: 'MAIN KITCHEN STORAGE', location: 'Main Kitchen', manager: 'Ahmad Fauzi', status: 'Aktif' },
            { code: '04', name: 'F&B ADMIN', location: 'F&B Department', manager: 'Rina Sari', status: 'Aktif' },
            { code: '05', name: 'HOUSEKEEPING', location: 'HK Department', manager: 'Dewi Lestari', status: 'Aktif' }
        ];

        let users = [
            { id: 1, username: 'admin', password: 'admin123', fullName: 'Administrator', email: 'admin@warehouse.com', role: 'Admin', status: 'Aktif', lastLogin: '2024-12-15 09:30', createdDate: '2024-01-01' },
            { id: 2, username: 'manager1', password: 'manager123', fullName: 'John Manager', email: 'john@warehouse.com', role: 'Manager', status: 'Aktif', lastLogin: '2024-12-15 08:15', createdDate: '2024-01-15' },
            { id: 3, username: 'staff1', password: 'staff123', fullName: 'Jane Staff', email: 'jane@warehouse.com', role: 'Staff', status: 'Aktif', lastLogin: '2024-12-14 16:45', createdDate: '2024-02-01' },
            { id: 4, username: 'staff2', password: 'staff456', fullName: 'Bob Worker', email: 'bob@warehouse.com', role: 'Staff', status: 'Tidak Aktif', lastLogin: '2024-12-10 14:20', createdDate: '2024-02-15' }
        ];

        let nextUnitId = 6;
        let nextUserId = 5;
        let currentEditId = null;
        let currentEditType = null;
        let currentUser = { username: 'admin', role: 'Admin', fullName: 'Administrator' }; // Current logged in user

        // Settings tab functions
        function showSettingsTab(tabName) {
            // Hide all content
            const contents = document.querySelectorAll('.settings-content');
            contents.forEach(content => content.classList.add('hidden'));

            // Show selected content
            const targetContent = {
                'general': 'generalSettings',
                'units': 'unitsSettings',
                'stores': 'storesSettings',
                'users': 'usersSettings'
            };

            document.getElementById(targetContent[tabName]).classList.remove('hidden');

            // Update tab styles
            const tabs = document.querySelectorAll('.settings-tab');
            tabs.forEach(tab => {
                tab.classList.remove('border-primary', 'text-primary');
                tab.classList.add('border-transparent', 'text-gray-500');
            });

            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-primary', 'text-primary');

            // Render tables based on tab
            if (tabName === 'units') {
                renderUnitsTable();
                setupUnitsSearch();
            } else if (tabName === 'stores') {
                renderStoresTable();
                setupStoresSearch();
            } else if (tabName === 'users') {
                renderUsersTable();
                setupUsersSearch();
            }
        }

        // Units management
        function renderUnitsTable(data = units) {
            const tbody = document.getElementById('unitsTableBody');
            tbody.innerHTML = '';

            data.forEach(unit => {
                const statusClass = unit.status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${unit.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${unit.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${unit.abbr}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${unit.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${unit.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editUnit(${unit.id})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="deleteUnit(${unit.id})" class="text-red-600 hover:text-red-800">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddUnitModal() {
            currentEditId = null;
            currentEditType = 'unit';
            document.getElementById('unitModalTitle').textContent = 'Tambah Unit';
            clearUnitForm();
            document.getElementById('unitModal').classList.remove('hidden');
        }

        function editUnit(unitId) {
            const unit = units.find(u => u.id === unitId);
            if (!unit) return;

            currentEditId = unitId;
            currentEditType = 'unit';
            document.getElementById('unitModalTitle').textContent = 'Edit Unit';
            
            document.getElementById('unitName').value = unit.name;
            document.getElementById('unitAbbr').value = unit.abbr;
            document.getElementById('unitDesc').value = unit.description;
            document.getElementById('unitStatus').value = unit.status;
            
            document.getElementById('unitModal').classList.remove('hidden');
        }

        function deleteUnit(unitId) {
            if (confirm('Yakin ingin menghapus unit ini?')) {
                const index = units.findIndex(u => u.id === unitId);
                if (index !== -1) {
                    units.splice(index, 1);
                    renderUnitsTable();
                    showNotification('Unit berhasil dihapus!', 'success');
                }
            }
        }

        function saveUnit() {
            const name = document.getElementById('unitName').value.trim();
            const abbr = document.getElementById('unitAbbr').value.trim();
            const desc = document.getElementById('unitDesc').value.trim();
            const status = document.getElementById('unitStatus').value;

            if (!name || !abbr) {
                showNotification('Nama unit dan singkatan harus diisi!', 'error');
                return;
            }

            // Check for duplicate abbreviation
            const existingUnit = units.find(u => u.abbr.toLowerCase() === abbr.toLowerCase() && u.id !== currentEditId);
            if (existingUnit) {
                showNotification('Singkatan unit sudah digunakan!', 'error');
                return;
            }

            if (currentEditId) {
                // Edit existing unit
                const index = units.findIndex(u => u.id === currentEditId);
                if (index !== -1) {
                    const oldUnit = { ...units[index] };
                    units[index] = { ...units[index], name, abbr, description: desc, status };
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `Unit ${name}`, code: abbr },
                        0,
                        'unit',
                        'GUDANG',
                        `Update unit: ${oldUnit.name} (${oldUnit.abbr}) â†’ ${name} (${abbr})`
                    );
                    
                    showNotification('Unit berhasil diperbarui!', 'success');
                }
            } else {
                // Add new unit
                const newUnit = {
                    id: nextUnitId++,
                    name,
                    abbr,
                    description: desc,
                    status
                };
                units.push(newUnit);
                
                // Add to history
                addHistoryRecord(
                    'Update Stok',
                    { name: `Unit ${name}`, code: abbr },
                    0,
                    'unit',
                    'GUDANG',
                    `Tambah unit baru: ${name} (${abbr})`
                );
                
                showNotification('Unit berhasil ditambahkan!', 'success');
            }

            renderUnitsTable();
            updateUnitDropdowns(); // Update all unit dropdowns
            renderHistoryTable();
            updateHistorySummary();
            closeUnitModal();
        }

        function closeUnitModal() {
            document.getElementById('unitModal').classList.add('hidden');
            clearUnitForm();
        }

        function clearUnitForm() {
            document.getElementById('unitName').value = '';
            document.getElementById('unitAbbr').value = '';
            document.getElementById('unitDesc').value = '';
            document.getElementById('unitStatus').value = 'Aktif';
        }

        // Stores management
        function renderStoresTable(data = storesData) {
            const tbody = document.getElementById('storesTableBody');
            tbody.innerHTML = '';

            data.forEach(store => {
                const statusClass = store.status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${store.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${store.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${store.location}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${store.manager}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${store.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editStore('${store.code}')" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="deleteStore('${store.code}')" class="text-red-600 hover:text-red-800">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddStoreModal() {
            currentEditId = null;
            currentEditType = 'store';
            document.getElementById('storeModalTitle').textContent = 'Tambah Store';
            clearStoreForm();
            document.getElementById('storeModal').classList.remove('hidden');
        }

        function editStore(storeCode) {
            const store = storesData.find(s => s.code === storeCode);
            if (!store) return;

            currentEditId = storeCode;
            currentEditType = 'store';
            document.getElementById('storeModalTitle').textContent = 'Edit Store';
            
            document.getElementById('storeCode').value = store.code;
            document.getElementById('storeName').value = store.name;
            document.getElementById('storeLocation').value = store.location;
            document.getElementById('storeManager').value = store.manager;
            document.getElementById('storeStatus').value = store.status;
            
            // Disable code editing for existing stores
            document.getElementById('storeCode').readOnly = true;
            
            document.getElementById('storeModal').classList.remove('hidden');
        }

        function deleteStore(storeCode) {
            if (confirm('Yakin ingin menghapus store ini?')) {
                const index = storesData.findIndex(s => s.code === storeCode);
                if (index !== -1) {
                    storesData.splice(index, 1);
                    renderStoresTable();
                    showNotification('Store berhasil dihapus!', 'success');
                }
            }
        }

        function saveStore() {
            const code = document.getElementById('storeCode').value.trim();
            const name = document.getElementById('storeName').value.trim();
            const location = document.getElementById('storeLocation').value.trim();
            const manager = document.getElementById('storeManager').value.trim();
            const status = document.getElementById('storeStatus').value;

            if (!code || !name || !location || !manager) {
                showNotification('Semua field harus diisi!', 'error');
                return;
            }

            if (currentEditId) {
                // Edit existing store
                const index = storesData.findIndex(s => s.code === currentEditId);
                if (index !== -1) {
                    const oldStore = { ...storesData[index] };
                    storesData[index] = { code, name, location, manager, status };
                    
                    // Update store inventory references
                    storeInventory.forEach(item => {
                        if (item.storeCode === code) {
                            item.storeName = name;
                        }
                    });
                    
                    // Update stores dropdown in other sections
                    updateStoreDropdowns();
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `Store ${name}`, code: code },
                        0,
                        'store',
                        'GUDANG',
                        `Update store: ${oldStore.name} â†’ ${name}, Manager: ${oldStore.manager} â†’ ${manager}`
                    );
                    
                    showNotification('Store berhasil diperbarui!', 'success');
                }
            } else {
                // Check if code already exists
                if (storesData.find(s => s.code === code)) {
                    showNotification('Kode store sudah ada!', 'error');
                    return;
                }
                
                // Add new store
                const newStore = { code, name, location, manager, status };
                storesData.push(newStore);
                
                // Update stores dropdown in other sections
                updateStoreDropdowns();
                
                // Add to history
                addHistoryRecord(
                    'Update Stok',
                    { name: `Store ${name}`, code: code },
                    0,
                    'store',
                    'GUDANG',
                    `Tambah store baru: ${name} (${code}), Manager: ${manager}`
                );
                
                showNotification('Store berhasil ditambahkan!', 'success');
            }

            renderStoresTable();
            renderStoreCards();
            renderHistoryTable();
            updateHistorySummary();
            closeStoreModal();
        }

        function updateStoreDropdowns() {
            // Update all store dropdowns in the system
            const dropdowns = [
                'transferStoreSelect',
                'outgoingToStoreSelect',
                'filterStore',
                'filterRekapStore',
                'filterHistoryStore'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    // Clear existing options except the first one
                    while (dropdown.children.length > 1) {
                        dropdown.removeChild(dropdown.lastChild);
                    }
                    
                    // Add updated store options
                    storesData.filter(store => store.status === 'Aktif').forEach(store => {
                        const option = document.createElement('option');
                        option.value = store.code;
                        option.textContent = `${store.code} - ${store.name}`;
                        dropdown.appendChild(option);
                    });
                }
            });
        }

        function closeStoreModal() {
            document.getElementById('storeModal').classList.add('hidden');
            document.getElementById('storeCode').readOnly = false;
            clearStoreForm();
        }

        function clearStoreForm() {
            document.getElementById('storeCode').value = '';
            document.getElementById('storeName').value = '';
            document.getElementById('storeLocation').value = '';
            document.getElementById('storeManager').value = '';
            document.getElementById('storeStatus').value = 'Aktif';
        }

        // Users management
        function renderUsersTable(data = users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            data.forEach(user => {
                const statusClass = user.status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const roleClass = user.role === 'Admin' ? 'bg-purple-100 text-purple-800' : 
                                user.role === 'Manager' ? 'bg-blue-100 text-blue-800' : 
                                'bg-gray-100 text-gray-800';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.fullName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${roleClass}">${user.role}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${user.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.lastLogin}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddUserModal() {
            currentEditId = null;
            currentEditType = 'user';
            document.getElementById('userModalTitle').textContent = 'Tambah User';
            clearUserForm();
            document.getElementById('userModal').classList.remove('hidden');
        }

        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            currentEditId = userId;
            currentEditType = 'user';
            document.getElementById('userModalTitle').textContent = 'Edit User';
            
            document.getElementById('username').value = user.username;
            document.getElementById('userEmail').value = user.email;
            document.getElementById('fullName').value = user.fullName;
            document.getElementById('userRole').value = user.role;
            document.getElementById('userStatus').value = user.status;
            
            // Hide password fields for editing
            document.getElementById('userPassword').parentElement.style.display = 'none';
            document.getElementById('confirmPassword').parentElement.style.display = 'none';
            
            document.getElementById('userModal').classList.remove('hidden');
        }

        function deleteUser(userId) {
            if (confirm('Yakin ingin menghapus user ini?')) {
                const index = users.findIndex(u => u.id === userId);
                if (index !== -1) {
                    users.splice(index, 1);
                    renderUsersTable();
                    showNotification('User berhasil dihapus!', 'success');
                }
            }
        }

        function saveUser() {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const fullName = document.getElementById('fullName').value.trim();
            const password = document.getElementById('userPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const role = document.getElementById('userRole').value;
            const status = document.getElementById('userStatus').value;

            if (!username || !email || !fullName) {
                showNotification('Username, email, dan nama lengkap harus diisi!', 'error');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Format email tidak valid!', 'error');
                return;
            }

            if (!currentEditId) {
                // For new users, password is required
                if (!password || !confirmPassword) {
                    showNotification('Password harus diisi untuk user baru!', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showNotification('Password minimal 6 karakter!', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showNotification('Password dan konfirmasi password tidak sama!', 'error');
                    return;
                }

                // Check if username already exists
                if (users.find(u => u.username === username)) {
                    showNotification('Username sudah ada!', 'error');
                    return;
                }

                // Check if email already exists
                if (users.find(u => u.email === email)) {
                    showNotification('Email sudah digunakan!', 'error');
                    return;
                }
            } else {
                // For editing, check if username/email conflicts with other users
                if (users.find(u => u.username === username && u.id !== currentEditId)) {
                    showNotification('Username sudah digunakan oleh user lain!', 'error');
                    return;
                }

                if (users.find(u => u.email === email && u.id !== currentEditId)) {
                    showNotification('Email sudah digunakan oleh user lain!', 'error');
                    return;
                }
            }

            if (currentEditId) {
                // Edit existing user
                const index = users.findIndex(u => u.id === currentEditId);
                if (index !== -1) {
                    const oldUser = { ...users[index] };
                    users[index] = { ...users[index], username, email, fullName, role, status };
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `User ${fullName}`, code: username },
                        0,
                        'user',
                        'GUDANG',
                        `Update user: ${oldUser.fullName} (${oldUser.username}) â†’ ${fullName} (${username}), Role: ${oldUser.role} â†’ ${role}`
                    );
                    
                    showNotification('User berhasil diperbarui!', 'success');
                }
            } else {
                // Add new user
                const newUser = {
                    id: nextUserId++,
                    username,
                    fullName,
                    email,
                    role,
                    status,
                    lastLogin: 'Belum pernah login'
                };
                users.push(newUser);
                
                // Add to history
                addHistoryRecord(
                    'Update Stok',
                    { name: `User ${fullName}`, code: username },
                    0,
                    'user',
                    'GUDANG',
                    `Tambah user baru: ${fullName} (${username}), Role: ${role}`
                );
                
                showNotification('User berhasil ditambahkan!', 'success');
            }

            renderUsersTable();
            renderHistoryTable();
            updateHistorySummary();
            closeUserModal();
        }

        function closeUserModal() {
            document.getElementById('userModal').classList.add('hidden');
            // Show password fields again
            document.getElementById('userPassword').parentElement.style.display = 'block';
            document.getElementById('confirmPassword').parentElement.style.display = 'block';
            clearUserForm();
        }

        function clearUserForm() {
            document.getElementById('username').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('fullName').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('userRole').value = 'Staff';
            document.getElementById('userStatus').value = 'Aktif';
        }

        // Search functions
        function setupUnitsSearch() {
            const searchInput = document.getElementById('searchUnits');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filtered = units.filter(unit => 
                    unit.name.toLowerCase().includes(searchTerm) ||
                    unit.abbr.toLowerCase().includes(searchTerm) ||
                    unit.description.toLowerCase().includes(searchTerm)
                );
                renderUnitsTable(filtered);
            });
        }

        function setupStoresSearch() {
            const searchInput = document.getElementById('searchStores');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filtered = storesData.filter(store => 
                    store.code.toLowerCase().includes(searchTerm) ||
                    store.name.toLowerCase().includes(searchTerm) ||
                    store.location.toLowerCase().includes(searchTerm) ||
                    store.manager.toLowerCase().includes(searchTerm)
                );
                renderStoresTable(filtered);
            });
        }

        function setupUsersSearch() {
            const searchInput = document.getElementById('searchUsers');
            const roleFilter = document.getElementById('filterUserRole');
            
            function filterUsers() {
                const searchTerm = searchInput.value.toLowerCase();
                const roleFilter = document.getElementById('filterUserRole').value;
                
                const filtered = users.filter(user => {
                    const matchesSearch = user.username.toLowerCase().includes(searchTerm) ||
                                        user.fullName.toLowerCase().includes(searchTerm) ||
                                        user.email.toLowerCase().includes(searchTerm);
                    const matchesRole = !roleFilter || user.role === roleFilter;
                    
                    return matchesSearch && matchesRole;
                });
                
                renderUsersTable(filtered);
            }
            
            searchInput.addEventListener('input', filterUsers);
            roleFilter.addEventListener('change', filterUsers);
        }

        // Display settings
        function saveDisplaySettings() {
            const colorTheme = document.getElementById('colorTheme').value;
            const fontSize = document.getElementById('fontSize').value;
            const language = document.getElementById('language').value;
            const dateFormat = document.getElementById('dateFormat').value;
            const darkMode = document.getElementById('darkMode').checked;
            const compactSidebar = document.getElementById('compactSidebar').checked;
            const animations = document.getElementById('animations').checked;
            const autoRefresh = document.getElementById('autoRefresh').checked;

            // Apply theme changes
            applyColorTheme(colorTheme);
            applyFontSize(fontSize);
            applyDarkMode(darkMode);
            applyCompactSidebar(compactSidebar);
            
            // Save to localStorage
            const settings = {
                colorTheme,
                fontSize,
                language,
                dateFormat,
                darkMode,
                compactSidebar,
                animations,
                autoRefresh
            };
            localStorage.setItem('warehouseSettings', JSON.stringify(settings));

            showNotification('Pengaturan tampilan berhasil disimpan!', 'success');
        }

        function resetDisplaySettings() {
            if (confirm('Yakin ingin mereset semua pengaturan tampilan ke default?')) {
                document.getElementById('colorTheme').value = 'blue';
                document.getElementById('fontSize').value = 'medium';
                document.getElementById('language').value = 'id';
                document.getElementById('dateFormat').value = 'dd/mm/yyyy';
                document.getElementById('darkMode').checked = false;
                document.getElementById('compactSidebar').checked = false;
                document.getElementById('animations').checked = true;
                document.getElementById('autoRefresh').checked = false;
                
                // Apply default settings
                applyColorTheme('blue');
                applyFontSize('medium');
                applyDarkMode(false);
                applyCompactSidebar(false);
                
                // Clear localStorage
                localStorage.removeItem('warehouseSettings');
                
                showNotification('Pengaturan tampilan berhasil direset ke default!', 'success');
            }
        }

        function loadDisplaySettings() {
            const savedSettings = localStorage.getItem('warehouseSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                document.getElementById('colorTheme').value = settings.colorTheme || 'blue';
                document.getElementById('fontSize').value = settings.fontSize || 'medium';
                document.getElementById('language').value = settings.language || 'id';
                document.getElementById('dateFormat').value = settings.dateFormat || 'dd/mm/yyyy';
                document.getElementById('darkMode').checked = settings.darkMode || false;
                document.getElementById('compactSidebar').checked = settings.compactSidebar || false;
                document.getElementById('animations').checked = settings.animations !== false;
                document.getElementById('autoRefresh').checked = settings.autoRefresh || false;
                
                // Apply loaded settings
                applyColorTheme(settings.colorTheme || 'blue');
                applyFontSize(settings.fontSize || 'medium');
                applyDarkMode(settings.darkMode || false);
                applyCompactSidebar(settings.compactSidebar || false);
            }
        }

        function applyColorTheme(theme) {
            const root = document.documentElement;
            const themes = {
                blue: { primary: '#2563eb', primaryHover: '#1d4ed8' },
                green: { primary: '#059669', primaryHover: '#047857' },
                purple: { primary: '#7c3aed', primaryHover: '#6d28d9' },
                red: { primary: '#dc2626', primaryHover: '#b91c1c' },
                indigo: { primary: '#4f46e5', primaryHover: '#4338ca' }
            };
            
            if (themes[theme]) {
                root.style.setProperty('--color-primary', themes[theme].primary);
                root.style.setProperty('--color-primary-hover', themes[theme].primaryHover);
            }
        }

        function applyFontSize(size) {
            const body = document.body;
            body.classList.remove('text-sm', 'text-base', 'text-lg');
            
            switch (size) {
                case 'small':
                    body.classList.add('text-sm');
                    break;
                case 'large':
                    body.classList.add('text-lg');
                    break;
                default:
                    body.classList.add('text-base');
            }
        }

        function applyDarkMode(enabled) {
            if (enabled) {
                document.body.classList.add('dark');
                document.body.style.backgroundColor = '#1f2937';
                document.body.style.color = '#f9fafb';
            } else {
                document.body.classList.remove('dark');
                document.body.style.backgroundColor = '';
                document.body.style.color = '';
            }
        }

        function applyCompactSidebar(enabled) {
            const sidebar = document.getElementById('sidebar');
            if (enabled) {
                sidebar.classList.add('w-16');
                sidebar.classList.remove('w-64');
            } else {
                sidebar.classList.add('w-64');
                sidebar.classList.remove('w-16');
            }
        }

        // Save settings function (legacy)
        function saveSettings() {
            saveDisplaySettings();
        }

        // Fungsi untuk rekap data
        function getStockStatus(currentStock, minStock) {
            if (currentStock === 0) return 'Habis';
            if (currentStock < minStock) return 'Rendah';
            return 'Aman';
        }

        // Interactive filter functions
        let currentActiveFilter = null;

        function filterByStatus(status) {
            currentActiveFilter = status;
            
            // Clear existing filters
            document.getElementById('searchRekap').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterStockStatus').value = '';
            
            let filteredData;
            let filterText;
            let cardToHighlight;
            
            if (status === 'all') {
                filteredData = rekapData;
                filterText = 'Semua Barang';
                cardToHighlight = 'cardTotalJenis';
            } else {
                filteredData = rekapData.filter(item => getStockStatus(item.currentStock, item.minStock) === status);
                filterText = `Barang dengan Stok ${status}`;
                cardToHighlight = status === 'Aman' ? 'cardStokAman' : 
                                status === 'Rendah' ? 'cardStokRendah' : 'cardStokHabis';
            }
            
            // Update active filter indicator
            updateActiveFilterIndicator(filterText, filteredData.length);
            
            // Highlight selected card
            highlightSelectedCard(cardToHighlight);
            
            // Render filtered table
            renderRekapTable(filteredData);
            updateRekapSummary(filteredData);
            
            // Scroll to table
            document.querySelector('#rekap-data .bg-white.rounded-lg.shadow-sm.border:last-child').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
            showNotification(`Menampilkan ${filteredData.length} barang dengan filter: ${filterText}`, 'info');
        }

        function updateActiveFilterIndicator(filterText, count) {
            const indicator = document.getElementById('activeFilterIndicator');
            const textElement = document.getElementById('activeFilterText');
            const countElement = document.getElementById('activeFilterCount');
            
            textElement.textContent = filterText;
            countElement.textContent = `(${count} item)`;
            indicator.classList.remove('hidden');
        }

        function highlightSelectedCard(cardId) {
            // Remove highlight from all cards
            const allCards = ['cardTotalJenis', 'cardStokAman', 'cardStokRendah', 'cardStokHabis'];
            allCards.forEach(id => {
                const card = document.getElementById(id);
                card.classList.remove('ring-2', 'ring-blue-500', 'ring-green-500', 'ring-yellow-500', 'ring-red-500');
                card.classList.remove('bg-blue-50', 'bg-green-50', 'bg-yellow-50', 'bg-red-50');
            });
            
            // Add highlight to selected card
            const selectedCard = document.getElementById(cardId);
            if (cardId === 'cardTotalJenis') {
                selectedCard.classList.add('ring-2', 'ring-blue-500', 'bg-blue-50');
            } else if (cardId === 'cardStokAman') {
                selectedCard.classList.add('ring-2', 'ring-green-500', 'bg-green-50');
            } else if (cardId === 'cardStokRendah') {
                selectedCard.classList.add('ring-2', 'ring-yellow-500', 'bg-yellow-50');
            } else if (cardId === 'cardStokHabis') {
                selectedCard.classList.add('ring-2', 'ring-red-500', 'bg-red-50');
            }
        }

        function clearActiveFilter() {
            currentActiveFilter = null;
            
            // Hide filter indicator
            document.getElementById('activeFilterIndicator').classList.add('hidden');
            
            // Remove highlights from all cards
            const allCards = ['cardTotalJenis', 'cardStokAman', 'cardStokRendah', 'cardStokHabis'];
            allCards.forEach(id => {
                const card = document.getElementById(id);
                card.classList.remove('ring-2', 'ring-blue-500', 'ring-green-500', 'ring-yellow-500', 'ring-red-500');
                card.classList.remove('bg-blue-50', 'bg-green-50', 'bg-yellow-50', 'bg-red-50');
            });
            
            // Clear form filters
            document.getElementById('searchRekap').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterStockStatus').value = '';
            
            // Show all data
            renderRekapTable(rekapData);
            updateRekapSummary(rekapData);
            
            showNotification('Filter berhasil direset. Menampilkan semua data.', 'success');
        }

        function renderRekapTable(data = rekapData) {
            const tbody = document.getElementById('rekapTableBody');
            tbody.innerHTML = '';

            data.forEach(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                const statusClass = status === 'Aman' ? 'bg-green-100 text-green-800' : 
                                  status === 'Rendah' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-red-100 text-red-800';

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="item-checkbox rounded border-gray-300 text-primary focus:ring-primary" value="${item.code}" onchange="updateBulkEditButton()">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">${item.currentStock}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.minStock}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium">${item.totalIn}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-medium">${item.totalOut}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editRekapItem('${item.code}')" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="viewRekapDetail('${item.code}')" class="text-green-600 hover:text-green-800">Detail</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Reset checkboxes
            document.getElementById('selectAllHeader').checked = false;
            document.getElementById('selectAllItems').checked = false;
            updateBulkEditButton();
        }

        function updateRekapSummary(data = rekapData) {
            const totalJenis = data.length;
            const stokAman = data.filter(item => getStockStatus(item.currentStock, item.minStock) === 'Aman').length;
            const stokRendah = data.filter(item => getStockStatus(item.currentStock, item.minStock) === 'Rendah').length;
            const stokHabis = data.filter(item => getStockStatus(item.currentStock, item.minStock) === 'Habis').length;

            document.getElementById('totalJenisBarang').textContent = totalJenis;
            document.getElementById('stokAman').textContent = stokAman;
            document.getElementById('stokRendah').textContent = stokRendah;
            document.getElementById('stokHabis').textContent = stokHabis;
        }

        function filterRekapData() {
            const searchTerm = document.getElementById('searchRekap').value.toLowerCase();
            const categoryFilter = document.getElementById('filterCategory').value;
            const statusFilter = document.getElementById('filterStockStatus').value;

            let filtered = rekapData.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                    item.code.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                const itemStatus = getStockStatus(item.currentStock, item.minStock);
                const matchesStatus = !statusFilter || itemStatus === statusFilter;

                return matchesSearch && matchesCategory && matchesStatus;
            });

            // If there's an active card filter, maintain it
            if (currentActiveFilter && currentActiveFilter !== 'all') {
                filtered = filtered.filter(item => getStockStatus(item.currentStock, item.minStock) === currentActiveFilter);
            }

            renderRekapTable(filtered);
            updateRekapSummary(filtered);
            
            // Update active filter indicator if filters are applied
            if (searchTerm || categoryFilter || statusFilter) {
                let filterTexts = [];
                if (searchTerm) filterTexts.push(`Pencarian: "${searchTerm}"`);
                if (categoryFilter) filterTexts.push(`Kategori: ${categoryFilter}`);
                if (statusFilter) filterTexts.push(`Status: ${statusFilter}`);
                if (currentActiveFilter && currentActiveFilter !== 'all') {
                    filterTexts.push(`Stok: ${currentActiveFilter}`);
                }
                
                const combinedText = filterTexts.join(', ');
                updateActiveFilterIndicator(combinedText, filtered.length);
            } else if (!currentActiveFilter) {
                document.getElementById('activeFilterIndicator').classList.add('hidden');
            }
        }

        function setupRekapSearch() {
            const searchInput = document.getElementById('searchRekap');
            searchInput.addEventListener('input', filterRekapData);
        }

        function exportRekapToExcel() {
            showNotification('Memproses export data...', 'info');
            
            // Get current filtered data
            const searchTerm = document.getElementById('searchRekap').value.toLowerCase();
            const storeFilter = document.getElementById('filterRekapStore').value;
            const statusFilter = document.getElementById('filterStockStatus').value;

            let dataToExport = rekapData.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                    item.code.toLowerCase().includes(searchTerm);
                const matchesStore = !storeFilter || storeFilter === 'GUDANG';
                const itemStatus = getStockStatus(item.currentStock, item.minStock);
                const matchesStatus = !statusFilter || itemStatus === statusFilter;

                return matchesSearch && matchesStore && matchesStatus;
            });

            // Create CSV content with BOM for proper UTF-8 encoding
            let csvContent = "\uFEFF"; // BOM
            csvContent += "Kode Barang,Nama Barang,Kategori,Stok Saat Ini,Min Stock,Unit,Total Masuk,Total Keluar,Status,Nilai Stok,Persentase Stok\n";
            
            dataToExport.forEach(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                const stockPercentage = item.minStock > 0 ? Math.round((item.currentStock / item.minStock) * 100) : 100;
                const stockValue = item.currentStock * 1000; // Assuming price per unit is 1000 for demo
                
                csvContent += `"${item.code}","${item.name}","${item.category}",${item.currentStock},${item.minStock},"${item.unit}",${item.totalIn},${item.totalOut},"${status}",${stockValue},${stockPercentage}%\n`;
            });

            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `rekap-data-gudang-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            setTimeout(() => {
                showNotification(`Data rekap berhasil diekspor! (${dataToExport.length} item)`, 'success');
            }, 1000);
        }

        // Render tabel status verifikasi
        function renderStatusTable(items = incomingItems) {
            const tbody = document.getElementById('statusTableBody');
            tbody.innerHTML = '';

            items.forEach(item => {
                const statusClass = item.status === 'Diverifikasi' ? 'bg-green-100 text-green-800' : 
                                  item.status === 'Menunggu Verifikasi' ? 'bg-yellow-100 text-yellow-800' : 
                                  item.status === 'Ditransfer' ? 'bg-blue-100 text-blue-800' :
                                  'bg-red-100 text-red-800';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(item.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.qty}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${item.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        ${item.status === 'Menunggu Verifikasi' ? 
                            `<button onclick="showVerificationModal(${item.id})" class="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 mr-2">Verifikasi</button>` :
                            item.status === 'Diverifikasi' ?
                            `<button onclick="autoTransferToStore01(${item.id})" class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700">Transfer ke Store 01</button>` :
                            '<span class="text-gray-400">Sudah ditransfer</span>'
                        }
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render tabel store
        function renderStoreTable(items = storeInventory) {
            const tbody = document.getElementById('storeTableBody');
            tbody.innerHTML = '';

            items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="font-medium">${item.storeCode}</div>
                        <div class="text-xs text-gray-500">${item.storeName}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.itemCode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.itemName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">${item.qty}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(item.transferDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.transferBy}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editStoreItem(${item.id})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="deleteStoreItem(${item.id})" class="text-red-600 hover:text-red-800">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Filter status items
        function filterStatusItems() {
            const searchTerm = document.getElementById('searchStatus').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatusVerifikasi').value;

            let filtered = incomingItems.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                    item.code.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || item.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            renderStatusTable(filtered);
        }

        // Filter store data
        function filterStoreData() {
            const searchTerm = document.getElementById('searchStore').value.toLowerCase();
            const storeFilter = document.getElementById('filterStore').value;

            let filtered = storeInventory.filter(item => {
                const matchesSearch = item.itemName.toLowerCase().includes(searchTerm) || 
                                    item.itemCode.toLowerCase().includes(searchTerm) ||
                                    item.storeName.toLowerCase().includes(searchTerm);
                const matchesStore = !storeFilter || item.storeCode === storeFilter;

                return matchesSearch && matchesStore;
            });

            renderStoreTable(filtered);
        }

        // Setup store filter dropdown
        function setupStoreFilter() {
            const filterStore = document.getElementById('filterStore');
            const transferStoreSelect = document.getElementById('transferStoreSelect');
            const outgoingToStoreSelect = document.getElementById('outgoingToStoreSelect');
            const filterRekapStore = document.getElementById('filterRekapStore');
            
            stores.forEach(store => {
                const option1 = document.createElement('option');
                option1.value = store.code;
                option1.textContent = `${store.code} - ${store.name}`;
                if (filterStore) filterStore.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = store.code;
                option2.textContent = `${store.code} - ${store.name}`;
                if (transferStoreSelect) transferStoreSelect.appendChild(option2);

                const option3 = document.createElement('option');
                option3.value = store.code;
                option3.textContent = `${store.code} - ${store.name}`;
                if (outgoingToStoreSelect) outgoingToStoreSelect.appendChild(option3);

                const option4 = document.createElement('option');
                option4.value = store.code;
                option4.textContent = `${store.code} - ${store.name}`;
                if (filterRekapStore) filterRekapStore.appendChild(option4);
            });
        }

        // Setup unit dropdowns (for other forms, not incoming)
        function setupUnitDropdowns() {
            const unitDropdowns = [
                'editRekapUnit',
                'bulkUnit'
            ];
            
            unitDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    // Clear existing options except the first one
                    while (dropdown.children.length > 1) {
                        dropdown.removeChild(dropdown.lastChild);
                    }
                    
                    // Add active units
                    units.filter(unit => unit.status === 'Aktif').forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit.abbr;
                        option.textContent = `${unit.name} (${unit.abbr})`;
                        dropdown.appendChild(option);
                    });
                }
            });
            
            // Initialize incoming unit dropdown separately
            populateUnitDropdownForNewItem();
        }

        // Update unit dropdowns when units change
        function updateUnitDropdowns() {
            setupUnitDropdowns();
            
            // Also update incoming unit dropdown if it's currently showing new item state
            const codeInput = document.getElementById('incomingCode');
            const code = codeInput.value.trim().toUpperCase();
            
            if (!code) {
                // No code entered, show all active units
                populateUnitDropdownForNewItem();
            } else {
                // Check if it's existing item and refresh accordingly
                const existingItem = rekapData.find(item => item.code.toUpperCase() === code);
                if (existingItem) {
                    populateUnitDropdownForExistingItem(existingItem.unit);
                } else {
                    populateUnitDropdownForNewItem();
                }
            }
        }

        // Store Cards Functions
        let currentStoreCode = null;
        let isCardView = true;

        function renderStoreCards(stores = storesData) {
            const container = document.getElementById('storeCardsContainer');
            container.innerHTML = '';

            stores.forEach(store => {
                const storeItems = storeInventory.filter(item => item.storeCode === store.code);
                const totalItems = storeItems.length;
                const totalQty = storeItems.reduce((sum, item) => sum + item.qty, 0);
                
                const statusClass = store.status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const statusIcon = store.status === 'Aktif' ? 
                    '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>' :
                    '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>';

                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow cursor-pointer';
                card.onclick = () => showStoreDetail(store.code);
                
                card.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="bg-primary text-white p-2 rounded-lg mr-3">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"></path>
                                        <path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">${store.code}</h3>
                                    <p class="text-sm text-gray-600">${store.name}</p>
                                </div>
                            </div>
                            <span class="flex items-center px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">
                                ${statusIcon}
                                <span class="ml-1">${store.status}</span>
                            </span>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                </svg>
                                ${store.location}
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                </svg>
                                ${store.manager}
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 pt-4 border-t border-gray-200">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-primary">${totalItems}</div>
                                <div class="text-xs text-gray-500">Jenis Barang</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">${totalQty}</div>
                                <div class="text-xs text-gray-500">Total Qty</div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function filterStoreCards() {
            const searchTerm = document.getElementById('searchStoreCards').value.toLowerCase();
            const statusFilter = document.getElementById('filterStoreStatus').value;

            let filtered = storesData.filter(store => {
                const matchesSearch = store.name.toLowerCase().includes(searchTerm) || 
                                    store.code.toLowerCase().includes(searchTerm) ||
                                    store.location.toLowerCase().includes(searchTerm) ||
                                    store.manager.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || store.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            renderStoreCards(filtered);
        }

        function showStoreView() {
            const btn = document.getElementById('viewToggleBtn');
            const cardsView = document.getElementById('storeCardsView');
            const tableView = document.getElementById('storeTableView');
            
            if (isCardView) {
                // Switch to table view
                cardsView.classList.add('hidden');
                tableView.classList.remove('hidden');
                btn.textContent = 'Lihat Kartu';
                isCardView = false;
                renderStoreTable();
            } else {
                // Switch to cards view
                tableView.classList.add('hidden');
                cardsView.classList.remove('hidden');
                btn.textContent = 'Lihat Tabel';
                isCardView = true;
                renderStoreCards();
            }
        }

        function showStoreDetail(storeCode) {
            const store = storesData.find(s => s.code === storeCode);
            if (!store) return;

            currentStoreCode = storeCode;
            
            // Update store detail header
            document.getElementById('storeDetailTitle').textContent = `${store.code} - ${store.name}`;
            document.getElementById('storeDetailInfo').textContent = `${store.location} â€¢ Manager: ${store.manager}`;
            
            // Hide cards view and show detail view
            document.getElementById('storeCardsView').classList.add('hidden');
            document.getElementById('storeDetailView').classList.remove('hidden');
            
            // Render store items
            renderStoreDetailTable();
            setupStoreDetailSearch();
        }

        function backToStoreCards() {
            document.getElementById('storeDetailView').classList.add('hidden');
            document.getElementById('storeCardsView').classList.remove('hidden');
            currentStoreCode = null;
        }

        function renderStoreDetailTable() {
            if (!currentStoreCode) return;
            
            const storeItems = storeInventory.filter(item => item.storeCode === currentStoreCode);
            const tbody = document.getElementById('storeDetailTableBody');
            tbody.innerHTML = '';

            storeItems.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.itemCode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.itemName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">${item.qty}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(item.transferDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.transferBy}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editStoreItem(${item.id})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="deleteStoreItem(${item.id})" class="text-red-600 hover:text-red-800">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function setupStoreDetailSearch() {
            const searchInput = document.getElementById('searchStoreItems');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const storeItems = storeInventory.filter(item => 
                    item.storeCode === currentStoreCode &&
                    (item.itemName.toLowerCase().includes(searchTerm) || 
                     item.itemCode.toLowerCase().includes(searchTerm))
                );
                
                const tbody = document.getElementById('storeDetailTableBody');
                tbody.innerHTML = '';

                storeItems.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.itemCode}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.itemName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">${item.qty}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(item.transferDate)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.transferBy}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <button onclick="editStoreItem(${item.id})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                            <button onclick="deleteStoreItem(${item.id})" class="text-red-600 hover:text-red-800">Hapus</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            });
        }

        // Outgoing Transfer Functions
        function showOutgoingModal() {
            if (!currentStoreCode) {
                showNotification('Pilih store terlebih dahulu!', 'error');
                return;
            }

            const store = storesData.find(s => s.code === currentStoreCode);
            if (!store) return;

            // Set store asal
            document.getElementById('outgoingFromStore').value = `${store.code} - ${store.name}`;
            
            // Populate items in current store
            const outgoingItemSelect = document.getElementById('outgoingItemSelect');
            outgoingItemSelect.innerHTML = '<option value="">Pilih barang yang akan ditransfer...</option>';
            
            const storeItems = storeInventory.filter(item => item.storeCode === currentStoreCode);
            storeItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.itemCode} - ${item.itemName} (${item.qty} ${item.unit})`;
                option.dataset.qty = item.qty;
                outgoingItemSelect.appendChild(option);
            });

            // Populate destination stores (exclude current store)
            const outgoingToStoreSelect = document.getElementById('outgoingToStoreSelect');
            outgoingToStoreSelect.innerHTML = '<option value="">Pilih store tujuan...</option>';
            
            storesData.filter(s => s.code !== currentStoreCode && s.status === 'Aktif').forEach(store => {
                const option = document.createElement('option');
                option.value = store.code;
                option.textContent = `${store.code} - ${store.name}`;
                outgoingToStoreSelect.appendChild(option);
            });

            // Setup item selection handler
            outgoingItemSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const availableQty = selectedOption.dataset.qty || 0;
                document.getElementById('availableStock').textContent = availableQty;
                document.getElementById('outgoingQty').max = availableQty;
            });

            document.getElementById('outgoingModal').classList.remove('hidden');
        }

        function closeOutgoingModal() {
            document.getElementById('outgoingModal').classList.add('hidden');
            document.getElementById('outgoingItemSelect').value = '';
            document.getElementById('outgoingToStoreSelect').value = '';
            document.getElementById('outgoingQty').value = '';
            document.getElementById('outgoingNotes').value = '';
            document.getElementById('availableStock').textContent = '0';
        }

        function processOutgoingTransfer() {
            const itemId = parseInt(document.getElementById('outgoingItemSelect').value);
            const toStoreCode = document.getElementById('outgoingToStoreSelect').value;
            const qty = parseInt(document.getElementById('outgoingQty').value);
            const notes = document.getElementById('outgoingNotes').value;

            if (!itemId || !toStoreCode || !qty) {
                showNotification('Mohon lengkapi semua field yang wajib!', 'error');
                return;
            }

            const sourceItem = storeInventory.find(i => i.id === itemId);
            const toStore = storesData.find(s => s.code === toStoreCode);
            
            if (!sourceItem || !toStore) {
                showNotification('Data tidak valid!', 'error');
                return;
            }

            if (qty > sourceItem.qty) {
                showNotification('Jumlah transfer melebihi stok yang tersedia!', 'error');
                return;
            }

            // Check if item already exists in destination store
            const existingItem = storeInventory.find(item => 
                item.storeCode === toStoreCode && 
                item.itemCode === sourceItem.itemCode
            );

            if (existingItem) {
                // Add to existing item
                existingItem.qty += qty;
                existingItem.transferDate = new Date().toISOString().split('T')[0];
                existingItem.transferBy = 'Admin';
            } else {
                // Create new item in destination store
                const newStoreItem = {
                    id: nextStoreInventoryId++,
                    storeCode: toStore.code,
                    storeName: toStore.name,
                    itemCode: sourceItem.itemCode,
                    itemName: sourceItem.itemName,
                    qty: qty,
                    unit: sourceItem.unit,
                    transferDate: new Date().toISOString().split('T')[0],
                    transferBy: 'Admin'
                };
                storeInventory.push(newStoreItem);
            }

            // Update source item
            if (qty === sourceItem.qty) {
                // Remove item if all quantity transferred
                const sourceIndex = storeInventory.findIndex(i => i.id === itemId);
                if (sourceIndex !== -1) {
                    storeInventory.splice(sourceIndex, 1);
                }
            } else {
                // Reduce quantity
                sourceItem.qty -= qty;
                sourceItem.transferDate = new Date().toISOString().split('T')[0];
            }

            // Add to history
            addHistoryRecord(
                'Transfer Keluar',
                { name: sourceItem.itemName, code: sourceItem.itemCode },
                qty,
                sourceItem.unit,
                `${currentStoreCode} - ${storesData.find(s => s.code === currentStoreCode)?.name}`,
                `Transfer dari ${currentStoreCode} ke ${toStoreCode}${notes ? ': ' + notes : ''}`
            );

            // Refresh displays
            renderStoreDetailTable();
            renderStoreCards();
            renderStoreTable();
            
            showNotification(`${qty} ${sourceItem.unit} ${sourceItem.itemName} berhasil ditransfer ke ${toStore.name}!`, 'success');
            closeOutgoingModal();
        }

        // Modal functions
        let currentVerificationId = null;
        let currentEditStoreId = null;

        function showVerificationModal(itemId) {
            const item = incomingItems.find(i => i.id === itemId);
            if (!item) return;

            currentVerificationId = itemId;
            
            document.getElementById('verificationDetails').innerHTML = `
                <div class="space-y-2">
                    <div><strong>Kode:</strong> ${item.code}</div>
                    <div><strong>Nama:</strong> ${item.name}</div>
                    <div><strong>Qty:</strong> ${item.qty} ${item.unit}</div>
                    <div><strong>Tanggal:</strong> ${formatDate(item.date)}</div>
                </div>
            `;
            
            document.getElementById('verificationModal').classList.remove('hidden');
        }

        function closeVerificationModal() {
            document.getElementById('verificationModal').classList.add('hidden');
            document.getElementById('verificationNotes').value = '';
            currentVerificationId = null;
        }

        function approveItem() {
            if (!currentVerificationId) return;

            const itemIndex = incomingItems.findIndex(i => i.id === currentVerificationId);
            if (itemIndex !== -1) {
                const item = incomingItems[itemIndex];
                item.status = 'Diverifikasi';
                
                // Update rekap data saat verifikasi
                const rekapIndex = rekapData.findIndex(r => r.code === item.code);
                if (rekapIndex !== -1) {
                    rekapData[rekapIndex].currentStock += item.qty;
                    rekapData[rekapIndex].totalIn += item.qty;
                }
                
                // Add to history
                addHistoryRecord(
                    'Verifikasi',
                    { name: item.name, code: item.code },
                    item.qty,
                    item.unit,
                    'GUDANG',
                    `Verifikasi barang masuk - approved`
                );
                
                renderIncomingTable();
                renderStatusTable();
                renderRekapTable();
                updateRekapSummary();
                renderHistoryTable();
                updateHistorySummary();
                showNotification('Barang berhasil diverifikasi dan stok diperbarui!', 'success');
            }
            
            closeVerificationModal();
        }

        function rejectItem() {
            if (!currentVerificationId) return;

            const itemIndex = incomingItems.findIndex(i => i.id === currentVerificationId);
            if (itemIndex !== -1) {
                incomingItems[itemIndex].status = 'Ditolak';
                renderIncomingTable();
                renderStatusTable();
                showNotification('Barang ditolak!', 'error');
            }
            
            closeVerificationModal();
        }

        function autoTransferToStore01(itemId) {
            const item = incomingItems.find(i => i.id === itemId);
            if (!item || item.status !== 'Diverifikasi') return;

            // Transfer ke Store 01 (GENERAL STORE ANYER)
            const newStoreItem = {
                id: nextStoreInventoryId++,
                storeCode: '01',
                storeName: 'GENERAL STORE (ANYER)',
                itemCode: item.code,
                itemName: item.name,
                qty: item.qty,
                unit: item.unit,
                transferDate: new Date().toISOString().split('T')[0],
                transferBy: 'Admin'
            };

            storeInventory.push(newStoreItem);
            
            // Update status item
            const itemIndex = incomingItems.findIndex(i => i.id === itemId);
            if (itemIndex !== -1) {
                incomingItems[itemIndex].status = 'Ditransfer';
            }

            renderIncomingTable();
            renderStatusTable();
            renderStoreTable();
            showNotification(`Barang berhasil ditransfer ke Store 01!`, 'success');
        }

        function showTransferModal() {
            // Populate verified items
            const transferItemSelect = document.getElementById('transferItemSelect');
            transferItemSelect.innerHTML = '<option value="">Pilih barang yang sudah diverifikasi...</option>';
            
            const verifiedItems = incomingItems.filter(item => item.status === 'Diverifikasi');
            verifiedItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.code} - ${item.name} (${item.qty} ${item.unit})`;
                transferItemSelect.appendChild(option);
            });

            document.getElementById('transferModal').classList.remove('hidden');
        }

        function closeTransferModal() {
            document.getElementById('transferModal').classList.add('hidden');
            document.getElementById('transferItemSelect').value = '';
            document.getElementById('transferStoreSelect').value = '';
            document.getElementById('transferQty').value = '';
        }

        function processTransfer() {
            const itemId = parseInt(document.getElementById('transferItemSelect').value);
            const storeCode = document.getElementById('transferStoreSelect').value;
            const qty = parseInt(document.getElementById('transferQty').value);

            if (!itemId || !storeCode || !qty) {
                alert('Mohon lengkapi semua field!');
                return;
            }

            const item = incomingItems.find(i => i.id === itemId);
            const store = stores.find(s => s.code === storeCode);
            
            if (!item || !store) {
                alert('Data tidak valid!');
                return;
            }

            if (qty > item.qty) {
                alert('Jumlah transfer melebihi stok yang tersedia!');
                return;
            }

            // Create new store inventory item
            const newStoreItem = {
                id: nextStoreInventoryId++,
                storeCode: store.code,
                storeName: store.name,
                itemCode: item.code,
                itemName: item.name,
                qty: qty,
                unit: item.unit,
                transferDate: new Date().toISOString().split('T')[0],
                transferBy: 'Admin'
            };

            storeInventory.push(newStoreItem);

            // Update or remove original item
            if (qty === item.qty) {
                const itemIndex = incomingItems.findIndex(i => i.id === itemId);
                if (itemIndex !== -1) {
                    incomingItems[itemIndex].status = 'Ditransfer';
                }
            } else {
                item.qty -= qty;
            }

            // Add to history
            addHistoryRecord(
                'Transfer Masuk',
                { name: item.name, code: item.code },
                qty,
                item.unit,
                `${store.code} - ${store.name}`,
                `Transfer dari gudang ke store`
            );

            renderIncomingTable();
            renderStatusTable();
            renderStoreTable();
            renderHistoryTable();
            updateHistorySummary();
            showNotification(`Barang berhasil ditransfer ke ${store.name}!`, 'success');
            closeTransferModal();
        }

        function editStoreItem(itemId) {
            const item = storeInventory.find(i => i.id === itemId);
            if (!item) return;

            currentEditStoreId = itemId;
            document.getElementById('editStoreName').value = `${item.storeCode} - ${item.storeName}`;
            document.getElementById('editItemName').value = item.itemName;
            document.getElementById('editItemQty').value = item.qty;
            
            document.getElementById('editStoreModal').classList.remove('hidden');
        }

        function closeEditStoreModal() {
            document.getElementById('editStoreModal').classList.add('hidden');
            currentEditStoreId = null;
        }

        function updateStoreItem() {
            if (!currentEditStoreId) return;

            const newQty = parseInt(document.getElementById('editItemQty').value);
            if (newQty < 0) {
                alert('Jumlah tidak boleh negatif!');
                return;
            }

            const itemIndex = storeInventory.findIndex(i => i.id === currentEditStoreId);
            if (itemIndex !== -1) {
                storeInventory[itemIndex].qty = newQty;
                storeInventory[itemIndex].transferDate = new Date().toISOString().split('T')[0];
                renderStoreTable();
                showNotification('Stok berhasil diupdate!', 'success');
            }

            closeEditStoreModal();
        }

        function deleteStoreItem(itemId) {
            if (confirm('Yakin ingin menghapus item ini dari store?')) {
                const itemIndex = storeInventory.findIndex(i => i.id === itemId);
                if (itemIndex !== -1) {
                    storeInventory.splice(itemIndex, 1);
                    renderStoreTable();
                    showNotification('Item berhasil dihapus!', 'success');
                }
            }
        }

        function editIncomingItem(itemId) {
            const item = incomingItems.find(i => i.id === itemId);
            if (!item || item.status !== 'Menunggu Verifikasi') {
                showNotification('Item tidak dapat diedit karena sudah diverifikasi!', 'error');
                return;
            }

            // Populate form with existing data
            document.getElementById('incomingDate').value = item.date;
            document.getElementById('incomingCode').value = item.code;
            document.getElementById('incomingName').value = item.name;
            document.getElementById('incomingQty').value = item.qty;
            document.getElementById('incomingUnit').value = item.unit;
            document.getElementById('incomingMinStock').value = item.minStock;

            // Remove the item from array temporarily (will be re-added when saved)
            const itemIndex = incomingItems.findIndex(i => i.id === itemId);
            if (itemIndex !== -1) {
                incomingItems.splice(itemIndex, 1);
                renderIncomingTable();
                renderStatusTable();
            }

            // Scroll to form
            document.querySelector('#incoming').scrollIntoView({ behavior: 'smooth' });
            
            showNotification('Data dimuat ke form. Silakan edit dan klik "Tambah ke Daftar" untuk menyimpan perubahan.', 'info');
        }

        function deleteIncomingItem(itemId) {
            const item = incomingItems.find(i => i.id === itemId);
            if (!item) {
                showNotification('Item tidak ditemukan!', 'error');
                return;
            }

            if (item.status !== 'Menunggu Verifikasi') {
                showNotification('Item tidak dapat dihapus karena sudah diverifikasi!', 'error');
                return;
            }

            if (confirm(`Yakin ingin menghapus item "${item.name}" (${item.code})?`)) {
                const itemIndex = incomingItems.findIndex(i => i.id === itemId);
                if (itemIndex !== -1) {
                    incomingItems.splice(itemIndex, 1);
                    renderIncomingTable();
                    renderStatusTable();
                    showNotification(`Item "${item.name}" berhasil dihapus!`, 'success');
                }
            }
        }

        // Setup search functions
        function setupStatusSearch() {
            const searchInput = document.getElementById('searchStatus');
            searchInput.addEventListener('input', filterStatusItems);
        }

        function setupStoreSearch() {
            const searchInput = document.getElementById('searchStore');
            searchInput.addEventListener('input', filterStoreData);
        }

        // Edit Rekap Item functions
        let currentEditRekapCode = null;

        function editRekapItem(itemCode) {
            const item = rekapData.find(i => i.code === itemCode);
            if (!item) return;

            currentEditRekapCode = itemCode;
            document.getElementById('editRekapCode').value = item.code;
            document.getElementById('editRekapName').value = item.name;
            document.getElementById('editRekapCategory').value = item.category;
            document.getElementById('editRekapCurrentStock').value = item.currentStock;
            document.getElementById('editRekapMinStock').value = item.minStock;
            document.getElementById('editRekapUnit').value = item.unit;
            
            document.getElementById('editRekapModal').classList.remove('hidden');
        }

        function closeEditRekapModal() {
            document.getElementById('editRekapModal').classList.add('hidden');
            currentEditRekapCode = null;
        }

        function saveRekapItem() {
            if (!currentEditRekapCode) return;

            const name = document.getElementById('editRekapName').value;
            const category = document.getElementById('editRekapCategory').value;
            const currentStock = parseInt(document.getElementById('editRekapCurrentStock').value);
            const minStock = parseInt(document.getElementById('editRekapMinStock').value);
            const unit = document.getElementById('editRekapUnit').value;

            if (!name || !category || !unit || currentStock < 0 || minStock < 0) {
                showNotification('Mohon lengkapi semua field dengan benar!', 'error');
                return;
            }

            const itemIndex = rekapData.findIndex(i => i.code === currentEditRekapCode);
            if (itemIndex !== -1) {
                const oldItem = { ...rekapData[itemIndex] };
                
                rekapData[itemIndex].name = name;
                rekapData[itemIndex].category = category;
                rekapData[itemIndex].currentStock = currentStock;
                rekapData[itemIndex].minStock = minStock;
                rekapData[itemIndex].unit = unit;
                
                // Update master items if exists
                const masterIndex = masterItems.findIndex(i => i.code === currentEditRekapCode);
                if (masterIndex !== -1) {
                    masterItems[masterIndex].name = name;
                    masterItems[masterIndex].category = category;
                    masterItems[masterIndex].minStock = minStock;
                    masterItems[masterIndex].unit = unit;
                }
                
                // Add to history
                addHistoryRecord(
                    'Update Stok',
                    { name: name, code: currentEditRekapCode },
                    currentStock,
                    unit,
                    'GUDANG',
                    `Update data barang: ${oldItem.name} â†’ ${name}, Stok: ${oldItem.currentStock} â†’ ${currentStock}, Min: ${oldItem.minStock} â†’ ${minStock}`
                );
                
                renderRekapTable();
                updateRekapSummary();
                renderHistoryTable();
                updateHistorySummary();
                showNotification('Data barang berhasil diperbarui!', 'success');
            }

            closeEditRekapModal();
        }

        function viewRekapDetail(itemCode) {
            const item = rekapData.find(i => i.code === itemCode);
            if (!item) return;

            const status = getStockStatus(item.currentStock, item.minStock);
            const statusClass = status === 'Aman' ? 'text-green-600' : 
                              status === 'Rendah' ? 'text-yellow-600' : 'text-red-600';

            document.getElementById('detailCode').textContent = item.code;
            document.getElementById('detailName').textContent = item.name;
            document.getElementById('detailCategory').textContent = item.category;
            document.getElementById('detailUnit').textContent = item.unit;
            document.getElementById('detailCurrentStock').textContent = `${item.currentStock} ${item.unit}`;
            document.getElementById('detailMinStock').textContent = `${item.minStock} ${item.unit}`;
            
            const statusElement = document.getElementById('detailStatus');
            statusElement.textContent = status;
            statusElement.className = `font-medium ${statusClass}`;
            
            document.getElementById('detailTotalIn').textContent = item.totalIn;
            document.getElementById('detailTotalOut').textContent = item.totalOut;
            document.getElementById('detailNetStock').textContent = item.totalIn - item.totalOut;
            
            document.getElementById('viewRekapModal').classList.remove('hidden');
        }

        function closeViewRekapModal() {
            document.getElementById('viewRekapModal').classList.add('hidden');
        }

        // Notification system
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => notif.remove());

            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
            
            const bgColor = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            }[type] || 'bg-blue-500';

            notification.className += ` ${bgColor} text-white`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-1">
                        <p class="text-sm font-medium">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            `;

            document.body.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Set default date to today
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('incomingDate').value = today;
        }

        // History functions
        function renderHistoryTable(data = filteredHistoryData) {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';

            // Calculate pagination
            const startIndex = (currentHistoryPage - 1) * historyItemsPerPage;
            const endIndex = startIndex + historyItemsPerPage;
            const paginatedData = data.slice(startIndex, endIndex);

            paginatedData.forEach(item => {
                const typeClass = getTransactionTypeClass(item.type);
                const typeIcon = getTransactionTypeIcon(item.type);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="font-medium">${formatDate(item.date)}</div>
                        <div class="text-xs text-gray-500">${item.time}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="${typeClass} p-2 rounded-full mr-3">
                                ${typeIcon}
                            </div>
                            <span class="text-sm font-medium text-gray-900">${item.type}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.item}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold">${item.qty}</span> ${item.unit}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="font-medium">${item.store}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.user}</td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                        <div class="truncate" title="${item.notes}">${item.notes}</div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateHistoryPagination(data.length);
        }

        function getTransactionTypeClass(type) {
            const classes = {
                'Barang Masuk': 'bg-green-100',
                'Barang Keluar': 'bg-red-100',
                'Transfer Masuk': 'bg-blue-100',
                'Transfer Keluar': 'bg-orange-100',
                'Verifikasi': 'bg-purple-100',
                'Update Stok': 'bg-yellow-100'
            };
            return classes[type] || 'bg-gray-100';
        }

        function getTransactionTypeIcon(type) {
            const icons = {
                'Barang Masuk': '<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',
                'Barang Keluar': '<svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>',
                'Transfer Masuk': '<svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',
                'Transfer Keluar': '<svg class="w-4 h-4 text-orange-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>',
                'Verifikasi': '<svg class="w-4 h-4 text-purple-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>',
                'Update Stok': '<svg class="w-4 h-4 text-yellow-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path></svg>'
            };
            return icons[type] || '<svg class="w-4 h-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg>';
        }

        function updateHistoryPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / historyItemsPerPage);
            const startItem = (currentHistoryPage - 1) * historyItemsPerPage + 1;
            const endItem = Math.min(currentHistoryPage * historyItemsPerPage, totalItems);

            document.getElementById('historyShowingStart').textContent = totalItems > 0 ? startItem : 0;
            document.getElementById('historyShowingEnd').textContent = endItem;
            document.getElementById('historyTotal').textContent = totalItems;
            document.getElementById('historyPageInfo').textContent = `Halaman ${currentHistoryPage} dari ${totalPages}`;

            // Update button states
            const prevBtn = document.getElementById('historyPrevBtn');
            const nextBtn = document.getElementById('historyNextBtn');
            
            prevBtn.disabled = currentHistoryPage <= 1;
            nextBtn.disabled = currentHistoryPage >= totalPages;
            
            if (prevBtn.disabled) {
                prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            
            if (nextBtn.disabled) {
                nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function previousHistoryPage() {
            if (currentHistoryPage > 1) {
                currentHistoryPage--;
                renderHistoryTable();
            }
        }

        function nextHistoryPage() {
            const totalPages = Math.ceil(filteredHistoryData.length / historyItemsPerPage);
            if (currentHistoryPage < totalPages) {
                currentHistoryPage++;
                renderHistoryTable();
            }
        }

        function updateHistorySummary(data = filteredHistoryData) {
            const totalTransactions = data.length;
            const totalIncoming = data.filter(item => item.type === 'Barang Masuk').length;
            const totalOutgoing = data.filter(item => item.type === 'Transfer Keluar').length;
            const totalTransfers = data.filter(item => item.type === 'Transfer Masuk' || item.type === 'Transfer Keluar').length;

            document.getElementById('totalTransactions').textContent = totalTransactions;
            document.getElementById('totalIncoming').textContent = totalIncoming;
            document.getElementById('totalOutgoing').textContent = totalOutgoing;
            document.getElementById('totalTransfers').textContent = totalTransfers;
        }

        function filterHistoryData() {
            const searchTerm = document.getElementById('searchHistory').value.toLowerCase();
            const typeFilter = document.getElementById('filterHistoryType').value;
            const storeFilter = document.getElementById('filterHistoryStore').value;
            const dateFilter = document.getElementById('filterHistoryDate').value;

            filteredHistoryData = historyData.filter(item => {
                const matchesSearch = item.item.toLowerCase().includes(searchTerm) || 
                                    item.code.toLowerCase().includes(searchTerm) ||
                                    item.user.toLowerCase().includes(searchTerm) ||
                                    item.notes.toLowerCase().includes(searchTerm);
                const matchesType = !typeFilter || item.type === typeFilter;
                const matchesStore = !storeFilter || item.store.includes(storeFilter);
                const matchesDate = !dateFilter || item.date === dateFilter;

                return matchesSearch && matchesType && matchesStore && matchesDate;
            });

            // Reset to first page when filtering
            currentHistoryPage = 1;
            renderHistoryTable();
            updateHistorySummary();
        }

        function clearHistoryFilters() {
            document.getElementById('searchHistory').value = '';
            document.getElementById('filterHistoryType').value = '';
            document.getElementById('filterHistoryStore').value = '';
            document.getElementById('filterHistoryDate').value = '';
            
            filteredHistoryData = [...historyData];
            currentHistoryPage = 1;
            renderHistoryTable();
            updateHistorySummary();
        }

        function setupHistorySearch() {
            const searchInput = document.getElementById('searchHistory');
            const typeFilter = document.getElementById('filterHistoryType');
            const storeFilter = document.getElementById('filterHistoryStore');
            const dateFilter = document.getElementById('filterHistoryDate');
            
            searchInput.addEventListener('input', filterHistoryData);
            typeFilter.addEventListener('change', filterHistoryData);
            storeFilter.addEventListener('change', filterHistoryData);
            dateFilter.addEventListener('change', filterHistoryData);
        }

        function setupHistoryStoreFilter() {
            const filterHistoryStore = document.getElementById('filterHistoryStore');
            
            // Get unique stores from history data
            const uniqueStores = [...new Set(historyData.map(item => item.store))];
            
            uniqueStores.forEach(store => {
                if (store !== 'GUDANG') { // GUDANG already exists as default
                    const option = document.createElement('option');
                    option.value = store.split(' - ')[0]; // Get store code
                    option.textContent = store;
                    filterHistoryStore.appendChild(option);
                }
            });
        }

        // Add history record function
        function addHistoryRecord(type, item, qty, unit, store, notes, user = 'Admin') {
            const newRecord = {
                id: historyData.length + 1,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                type: type,
                item: item.name || item,
                code: item.code || '',
                qty: qty,
                unit: unit,
                user: user,
                store: store,
                notes: notes
            };
            
            historyData.unshift(newRecord); // Add to beginning
            
            // Update filtered data if no filters are active
            if (filteredHistoryData.length === historyData.length - 1) {
                filteredHistoryData.unshift(newRecord);
            }
        }

        // Bulk edit functions
        function updateBulkEditButton() {
            const checkboxes = document.querySelectorAll('.item-checkbox:checked');
            const bulkEditBtn = document.getElementById('bulkEditBtn');
            
            if (checkboxes.length > 0) {
                bulkEditBtn.disabled = false;
                bulkEditBtn.textContent = `Edit Terpilih (${checkboxes.length})`;
            } else {
                bulkEditBtn.disabled = true;
                bulkEditBtn.innerHTML = `
                    <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                    </svg>
                    Edit Terpilih
                `;
            }
        }

        function setupSelectAllCheckboxes() {
            // Header checkbox
            document.getElementById('selectAllHeader').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.item-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
                document.getElementById('selectAllItems').checked = this.checked;
                updateBulkEditButton();
            });

            // Sidebar checkbox
            document.getElementById('selectAllItems').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.item-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
                document.getElementById('selectAllHeader').checked = this.checked;
                updateBulkEditButton();
            });
        }

        function showBulkEditModal() {
            const selectedItems = document.querySelectorAll('.item-checkbox:checked');
            if (selectedItems.length === 0) {
                showNotification('Pilih minimal satu barang untuk diedit!', 'error');
                return;
            }

            document.getElementById('selectedItemsCount').textContent = selectedItems.length;
            document.getElementById('bulkEditModal').classList.remove('hidden');
        }

        function closeBulkEditModal() {
            document.getElementById('bulkEditModal').classList.add('hidden');
            // Clear form
            document.getElementById('bulkCategory').value = '';
            document.getElementById('bulkUnit').value = '';
            document.getElementById('bulkMinStock').value = '';
            document.getElementById('bulkStockAction').value = '';
            document.getElementById('bulkStockValue').value = '';
            document.getElementById('bulkEditNotes').value = '';
        }

        function processBulkEdit() {
            const selectedItems = document.querySelectorAll('.item-checkbox:checked');
            if (selectedItems.length === 0) {
                showNotification('Tidak ada barang yang dipilih!', 'error');
                return;
            }

            const bulkCategory = document.getElementById('bulkCategory').value;
            const bulkUnit = document.getElementById('bulkUnit').value;
            const bulkMinStock = document.getElementById('bulkMinStock').value;
            const bulkStockAction = document.getElementById('bulkStockAction').value;
            const bulkStockValue = document.getElementById('bulkStockValue').value;
            const bulkEditNotes = document.getElementById('bulkEditNotes').value;

            if (!bulkCategory && !bulkUnit && !bulkMinStock && !bulkStockAction) {
                showNotification('Pilih minimal satu field untuk diubah!', 'error');
                return;
            }

            if (bulkStockAction && !bulkStockValue) {
                showNotification('Masukkan nilai untuk penyesuaian stok!', 'error');
                return;
            }

            let updatedCount = 0;
            const selectedCodes = Array.from(selectedItems).map(item => item.value);

            selectedCodes.forEach(code => {
                const itemIndex = rekapData.findIndex(item => item.code === code);
                if (itemIndex !== -1) {
                    const item = rekapData[itemIndex];
                    const oldData = { ...item };

                    // Update fields
                    if (bulkCategory) item.category = bulkCategory;
                    if (bulkUnit) item.unit = bulkUnit;
                    if (bulkMinStock) item.minStock = parseInt(bulkMinStock);

                    // Update stock
                    if (bulkStockAction && bulkStockValue) {
                        const value = parseInt(bulkStockValue);
                        switch (bulkStockAction) {
                            case 'add':
                                item.currentStock += value;
                                item.totalIn += value;
                                break;
                            case 'subtract':
                                item.currentStock = Math.max(0, item.currentStock - value);
                                item.totalOut += value;
                                break;
                            case 'set':
                                const diff = value - item.currentStock;
                                item.currentStock = value;
                                if (diff > 0) {
                                    item.totalIn += diff;
                                } else if (diff < 0) {
                                    item.totalOut += Math.abs(diff);
                                }
                                break;
                        }
                    }

                    // Update master items
                    const masterIndex = masterItems.findIndex(master => master.code === code);
                    if (masterIndex !== -1) {
                        if (bulkCategory) masterItems[masterIndex].category = bulkCategory;
                        if (bulkUnit) masterItems[masterIndex].unit = bulkUnit;
                        if (bulkMinStock) masterItems[masterIndex].minStock = parseInt(bulkMinStock);
                    }

                    // Add to history
                    const changes = [];
                    if (bulkCategory && oldData.category !== bulkCategory) changes.push(`Kategori: ${oldData.category} â†’ ${bulkCategory}`);
                    if (bulkUnit && oldData.unit !== bulkUnit) changes.push(`Unit: ${oldData.unit} â†’ ${bulkUnit}`);
                    if (bulkMinStock && oldData.minStock !== parseInt(bulkMinStock)) changes.push(`Min Stock: ${oldData.minStock} â†’ ${bulkMinStock}`);
                    if (bulkStockAction && bulkStockValue) {
                        const actionText = bulkStockAction === 'add' ? 'Tambah' : bulkStockAction === 'subtract' ? 'Kurangi' : 'Set ke';
                        changes.push(`Stok: ${actionText} ${bulkStockValue} (${oldData.currentStock} â†’ ${item.currentStock})`);
                    }

                    addHistoryRecord(
                        'Update Stok',
                        { name: item.name, code: item.code },
                        item.currentStock,
                        item.unit,
                        'GUDANG',
                        `Bulk edit: ${changes.join(', ')}${bulkEditNotes ? '. Catatan: ' + bulkEditNotes : ''}`
                    );

                    updatedCount++;
                }
            });

            // Clear selections
            selectedItems.forEach(checkbox => checkbox.checked = false);
            document.getElementById('selectAllHeader').checked = false;
            document.getElementById('selectAllItems').checked = false;

            // Refresh displays
            renderRekapTable();
            updateRekapSummary();
            renderHistoryTable();
            updateHistorySummary();
            updateBulkEditButton();

            closeBulkEditModal();
            showNotification(`${updatedCount} barang berhasil diperbarui secara massal!`, 'success');
        }

        // Dashboard navigation functions
        function goToRekapData(filterType) {
            // Navigate to Rekap Data section
            showSection('rekap-data');
            
            // Apply filter based on dashboard card clicked
            if (filterType === 'all') {
                clearActiveFilter();
                showNotification('Menampilkan semua data barang dari dashboard', 'info');
            } else {
                filterByStatus(filterType);
            }
        }

        function goToIncomingData() {
            // Navigate to Incoming section
            showSection('incoming');
            
            // Clear any existing filters
            document.getElementById('searchIncoming').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterDate').value = '';
            
            // Show all incoming items
            renderIncomingTable(incomingItems);
            
            showNotification('Menampilkan data barang masuk dari dashboard', 'info');
        }

        function goToHistoryData(filterType) {
            // Navigate to History section
            showSection('riwayat');
            
            // Clear existing filters
            document.getElementById('searchHistory').value = '';
            document.getElementById('filterHistoryStore').value = '';
            document.getElementById('filterHistoryDate').value = '';
            
            // Apply filter based on type
            document.getElementById('filterHistoryType').value = filterType;
            
            // Filter and render
            filterHistoryData();
            
            showNotification(`Menampilkan riwayat ${filterType} dari dashboard`, 'info');
        }

        function updateDashboardStats() {
            // Update Total Items
            const totalItems = rekapData.length;
            document.getElementById('dashTotalItems').textContent = totalItems;
            
            // Update Incoming Items (pending verification)
            const incomingCount = incomingItems.filter(item => item.status === 'Menunggu Verifikasi').length;
            document.getElementById('dashIncomingItems').textContent = incomingCount;
            
            // Update Outgoing Items (from history)
            const outgoingCount = historyData.filter(item => item.type === 'Transfer Keluar').length;
            document.getElementById('dashOutgoingItems').textContent = outgoingCount;
            
            // Update Low Stock Items
            const lowStockCount = rekapData.filter(item => getStockStatus(item.currentStock, item.minStock) === 'Rendah').length;
            document.getElementById('dashLowStock').textContent = lowStockCount;
            
            // Update System Status
            document.getElementById('dashPendingVerification').textContent = incomingCount;
            document.getElementById('dashActiveStores').textContent = storesData.filter(store => store.status === 'Aktif').length;
            
            // Today's transactions
            const today = new Date().toISOString().split('T')[0];
            const todayTransactions = historyData.filter(item => item.date === today).length;
            document.getElementById('dashTodayTransactions').textContent = todayTransactions;
            
            // Stock warnings (low + out of stock)
            const stockWarnings = rekapData.filter(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                return status === 'Rendah' || status === 'Habis';
            }).length;
            document.getElementById('dashStockWarnings').textContent = stockWarnings;
            
            // Update recent activities
            updateRecentActivities();
        }

        function updateRecentActivities() {
            const recentActivitiesContainer = document.getElementById('recentActivities');
            recentActivitiesContainer.innerHTML = '';
            
            // Get last 5 activities
            const recentActivities = historyData.slice(0, 5);
            
            recentActivities.forEach(activity => {
                const typeClass = getTransactionTypeClass(activity.type);
                const typeIcon = getTransactionTypeIcon(activity.type);
                
                const activityElement = document.createElement('div');
                activityElement.className = 'flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors';
                activityElement.onclick = () => {
                    // Navigate to history with filter
                    goToHistoryData(activity.type);
                };
                
                activityElement.innerHTML = `
                    <div class="${typeClass} p-2 rounded-full mr-3">
                        ${typeIcon}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 truncate">${activity.type}: ${activity.item}</p>
                        <p class="text-xs text-gray-500">${getTimeAgo(activity.date, activity.time)}</p>
                    </div>
                `;
                
                recentActivitiesContainer.appendChild(activityElement);
            });
            
            if (recentActivities.length === 0) {
                recentActivitiesContainer.innerHTML = `
                    <div class="text-center text-gray-500 text-sm py-4">
                        <svg class="w-8 h-8 mx-auto mb-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                        </svg>
                        Belum ada aktivitas
                    </div>
                `;
            }
        }

        function getTimeAgo(date, time) {
            const activityDate = new Date(`${date} ${time}`);
            const now = new Date();
            const diffInMinutes = Math.floor((now - activityDate) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Baru saja';
            if (diffInMinutes < 60) return `${diffInMinutes} menit yang lalu`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours} jam yang lalu`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) return `${diffInDays} hari yang lalu`;
            
            return formatDate(date);
        }

        // Enhanced section navigation with dashboard updates
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');

            // Update active nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('bg-blue-50', 'text-primary');
                item.classList.add('text-gray-700');
            });

            // Find and highlight the clicked nav item
            const clickedItem = event?.target?.closest('.nav-item');
            if (clickedItem) {
                clickedItem.classList.add('bg-blue-50', 'text-primary');
                clickedItem.classList.remove('text-gray-700');
            }

            // Update dashboard stats when showing dashboard
            if (sectionId === 'dashboard') {
                updateDashboardStats();
            }

            // Close mobile menu
            if (window.innerWidth < 768) {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        // Authentication functions
        function processLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            // Find user
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                if (user.status === 'Tidak Aktif') {
                    showLoginError('Akun Anda tidak aktif. Hubungi administrator.');
                    return;
                }
                
                // Update last login
                user.lastLogin = new Date().toLocaleString('id-ID');
                
                // Set current user
                currentUser = {
                    id: user.id,
                    username: user.username,
                    fullName: user.fullName,
                    email: user.email,
                    role: user.role
                };
                
                // Update header
                document.getElementById('currentUserName').textContent = user.fullName;
                document.getElementById('currentUserRole').textContent = user.role;
                
                // Hide login modal
                document.getElementById('loginModal').classList.add('hidden');
                
                // Show success notification
                showNotification(`Selamat datang, ${user.fullName}!`, 'success');
                
                // Add login to history
                addHistoryRecord(
                    'Update Stok',
                    { name: 'Login System', code: 'LOGIN' },
                    0,
                    'session',
                    'SYSTEM',
                    `User ${user.fullName} (${user.username}) berhasil login dengan role ${user.role}`
                );
                
                renderHistoryTable();
                updateHistorySummary();
                
            } else {
                showLoginError('Username atau password salah!');
            }
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            const errorMessage = document.getElementById('loginErrorMessage');
            
            errorMessage.textContent = message;
            errorDiv.classList.remove('hidden');
            
            // Hide error after 5 seconds
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('loginPassword');
            const eyeIcon = document.getElementById('eyeIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.innerHTML = `
                    <path d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z"></path>
                    <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"></path>
                `;
            } else {
                passwordInput.type = 'password';
                eyeIcon.innerHTML = `
                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                `;
            }
        }

        function logout() {
            if (confirm('Yakin ingin keluar dari sistem?')) {
                // Add logout to history
                addHistoryRecord(
                    'Update Stok',
                    { name: 'Logout System', code: 'LOGOUT' },
                    0,
                    'session',
                    'SYSTEM',
                    `User ${currentUser.fullName} (${currentUser.username}) logout dari sistem`
                );
                
                // Reset current user
                currentUser = null;
                
                // Clear login form
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginError').classList.add('hidden');
                
                // Show login modal
                document.getElementById('loginModal').classList.remove('hidden');
                
                showNotification('Anda telah keluar dari sistem', 'info');
            }
        }

        // Enhanced delete functions with confirmation
        function deleteUnit(unitId) {
            const unit = units.find(u => u.id === unitId);
            if (!unit) {
                showNotification('Unit tidak ditemukan!', 'error');
                return;
            }

            // Check if unit is being used
            const isUsed = rekapData.some(item => item.unit === unit.abbr) || 
                          masterItems.some(item => item.unit === unit.abbr) ||
                          storeInventory.some(item => item.unit === unit.abbr);

            if (isUsed) {
                showNotification(`Unit "${unit.name}" tidak dapat dihapus karena sedang digunakan!`, 'error');
                return;
            }

            if (confirm(`Yakin ingin menghapus unit "${unit.name}" (${unit.abbr})?\n\nTindakan ini tidak dapat dibatalkan.`)) {
                const index = units.findIndex(u => u.id === unitId);
                if (index !== -1) {
                    const deletedUnit = units[index];
                    units.splice(index, 1);
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `Unit ${deletedUnit.name}`, code: deletedUnit.abbr },
                        0,
                        'unit',
                        'GUDANG',
                        `Hapus unit: ${deletedUnit.name} (${deletedUnit.abbr}) oleh ${currentUser.fullName}`
                    );
                    
                    renderUnitsTable();
                    updateUnitDropdowns(); // Update all unit dropdowns
                    renderHistoryTable();
                    updateHistorySummary();
                    showNotification(`Unit "${deletedUnit.name}" berhasil dihapus!`, 'success');
                }
            }
        }

        function deleteStore(storeCode) {
            const store = storesData.find(s => s.code === storeCode);
            if (!store) {
                showNotification('Store tidak ditemukan!', 'error');
                return;
            }

            // Check if store has inventory
            const hasInventory = storeInventory.some(item => item.storeCode === storeCode);
            
            if (hasInventory) {
                showNotification(`Store "${store.name}" tidak dapat dihapus karena masih memiliki stok barang!`, 'error');
                return;
            }

            if (confirm(`Yakin ingin menghapus store "${store.name}" (${store.code})?\n\nTindakan ini tidak dapat dibatalkan.`)) {
                const index = storesData.findIndex(s => s.code === storeCode);
                if (index !== -1) {
                    const deletedStore = storesData[index];
                    storesData.splice(index, 1);
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `Store ${deletedStore.name}`, code: deletedStore.code },
                        0,
                        'store',
                        'GUDANG',
                        `Hapus store: ${deletedStore.name} (${deletedStore.code}) oleh ${currentUser.fullName}`
                    );
                    
                    renderStoresTable();
                    renderStoreCards();
                    updateStoreDropdowns();
                    renderHistoryTable();
                    updateHistorySummary();
                    showNotification(`Store "${deletedStore.name}" berhasil dihapus!`, 'success');
                }
            }
        }

        function deleteUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) {
                showNotification('User tidak ditemukan!', 'error');
                return;
            }

            // Prevent deleting current user
            if (currentUser && user.id === currentUser.id) {
                showNotification('Anda tidak dapat menghapus akun yang sedang digunakan!', 'error');
                return;
            }

            // Prevent deleting the last admin
            const adminCount = users.filter(u => u.role === 'Admin' && u.status === 'Aktif').length;
            if (user.role === 'Admin' && adminCount <= 1) {
                showNotification('Tidak dapat menghapus admin terakhir!', 'error');
                return;
            }

            if (confirm(`Yakin ingin menghapus user "${user.fullName}" (${user.username})?\n\nTindakan ini tidak dapat dibatalkan.`)) {
                const index = users.findIndex(u => u.id === userId);
                if (index !== -1) {
                    const deletedUser = users[index];
                    users.splice(index, 1);
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `User ${deletedUser.fullName}`, code: deletedUser.username },
                        0,
                        'user',
                        'GUDANG',
                        `Hapus user: ${deletedUser.fullName} (${deletedUser.username}) oleh ${currentUser.fullName}`
                    );
                    
                    renderUsersTable();
                    renderHistoryTable();
                    updateHistorySummary();
                    showNotification(`User "${deletedUser.fullName}" berhasil dihapus!`, 'success');
                }
            }
        }

        // Enhanced save functions with current user tracking
        function saveUnit() {
            const name = document.getElementById('unitName').value.trim();
            const abbr = document.getElementById('unitAbbr').value.trim();
            const desc = document.getElementById('unitDesc').value.trim();
            const status = document.getElementById('unitStatus').value;

            if (!name || !abbr) {
                showNotification('Nama unit dan singkatan harus diisi!', 'error');
                return;
            }

            // Check for duplicate abbreviation
            const existingUnit = units.find(u => u.abbr.toLowerCase() === abbr.toLowerCase() && u.id !== currentEditId);
            if (existingUnit) {
                showNotification('Singkatan unit sudah digunakan!', 'error');
                return;
            }

            if (currentEditId) {
                // Edit existing unit
                const index = units.findIndex(u => u.id === currentEditId);
                if (index !== -1) {
                    const oldUnit = { ...units[index] };
                    units[index] = { ...units[index], name, abbr, description: desc, status };
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `Unit ${name}`, code: abbr },
                        0,
                        'unit',
                        'GUDANG',
                        `Update unit: ${oldUnit.name} (${oldUnit.abbr}) â†’ ${name} (${abbr}) oleh ${currentUser.fullName}`
                    );
                    
                    showNotification('Unit berhasil diperbarui!', 'success');
                }
            } else {
                // Add new unit
                const newUnit = {
                    id: nextUnitId++,
                    name,
                    abbr,
                    description: desc,
                    status
                };
                units.push(newUnit);
                
                // Add to history
                addHistoryRecord(
                    'Update Stok',
                    { name: `Unit ${name}`, code: abbr },
                    0,
                    'unit',
                    'GUDANG',
                    `Tambah unit baru: ${name} (${abbr}) oleh ${currentUser.fullName}`
                );
                
                showNotification('Unit berhasil ditambahkan!', 'success');
            }

            renderUnitsTable();
            updateUnitDropdowns(); // Update all unit dropdowns
            renderHistoryTable();
            updateHistorySummary();
            closeUnitModal();
        }

        function saveStore() {
            const code = document.getElementById('storeCode').value.trim();
            const name = document.getElementById('storeName').value.trim();
            const location = document.getElementById('storeLocation').value.trim();
            const manager = document.getElementById('storeManager').value.trim();
            const status = document.getElementById('storeStatus').value;

            if (!code || !name || !location || !manager) {
                showNotification('Semua field harus diisi!', 'error');
                return;
            }

            if (currentEditId) {
                // Edit existing store
                const index = storesData.findIndex(s => s.code === currentEditId);
                if (index !== -1) {
                    const oldStore = { ...storesData[index] };
                    storesData[index] = { code, name, location, manager, status };
                    
                    // Update store inventory references
                    storeInventory.forEach(item => {
                        if (item.storeCode === code) {
                            item.storeName = name;
                        }
                    });
                    
                    // Update stores dropdown in other sections
                    updateStoreDropdowns();
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `Store ${name}`, code: code },
                        0,
                        'store',
                        'GUDANG',
                        `Update store: ${oldStore.name} â†’ ${name}, Manager: ${oldStore.manager} â†’ ${manager} oleh ${currentUser.fullName}`
                    );
                    
                    showNotification('Store berhasil diperbarui!', 'success');
                }
            } else {
                // Check if code already exists
                if (storesData.find(s => s.code === code)) {
                    showNotification('Kode store sudah ada!', 'error');
                    return;
                }
                
                // Add new store
                const newStore = { code, name, location, manager, status };
                storesData.push(newStore);
                
                // Update stores dropdown in other sections
                updateStoreDropdowns();
                
                // Add to history
                addHistoryRecord(
                    'Update Stok',
                    { name: `Store ${name}`, code: code },
                    0,
                    'store',
                    'GUDANG',
                    `Tambah store baru: ${name} (${code}), Manager: ${manager} oleh ${currentUser.fullName}`
                );
                
                showNotification('Store berhasil ditambahkan!', 'success');
            }

            renderStoresTable();
            renderStoreCards();
            renderHistoryTable();
            updateHistorySummary();
            closeStoreModal();
        }

        function saveUser() {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const fullName = document.getElementById('fullName').value.trim();
            const password = document.getElementById('userPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const role = document.getElementById('userRole').value;
            const status = document.getElementById('userStatus').value;

            if (!username || !email || !fullName) {
                showNotification('Username, email, dan nama lengkap harus diisi!', 'error');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Format email tidak valid!', 'error');
                return;
            }

            if (!currentEditId) {
                // For new users, password is required
                if (!password || !confirmPassword) {
                    showNotification('Password harus diisi untuk user baru!', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showNotification('Password minimal 6 karakter!', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showNotification('Password dan konfirmasi password tidak sama!', 'error');
                    return;
                }

                // Check if username already exists
                if (users.find(u => u.username === username)) {
                    showNotification('Username sudah ada!', 'error');
                    return;
                }

                // Check if email already exists
                if (users.find(u => u.email === email)) {
                    showNotification('Email sudah digunakan!', 'error');
                    return;
                }
            } else {
                // For editing, check if username/email conflicts with other users
                if (users.find(u => u.username === username && u.id !== currentEditId)) {
                    showNotification('Username sudah digunakan oleh user lain!', 'error');
                    return;
                }

                if (users.find(u => u.email === email && u.id !== currentEditId)) {
                    showNotification('Email sudah digunakan oleh user lain!', 'error');
                    return;
                }
            }

            if (currentEditId) {
                // Edit existing user
                const index = users.findIndex(u => u.id === currentEditId);
                if (index !== -1) {
                    const oldUser = { ...users[index] };
                    users[index] = { ...users[index], username, email, fullName, role, status };
                    
                    // Update password if provided
                    if (password && password === confirmPassword) {
                        users[index].password = password;
                    }
                    
                    // Add to history
                    addHistoryRecord(
                        'Update Stok',
                        { name: `User ${fullName}`, code: username },
                        0,
                        'user',
                        'GUDANG',
                        `Update user: ${oldUser.fullName} (${oldUser.username}) â†’ ${fullName} (${username}), Role: ${oldUser.role} â†’ ${role} oleh ${currentUser.fullName}`
                    );
                    
                    showNotification('User berhasil diperbarui!', 'success');
                }
            } else {
                // Add new user
                const newUser = {
                    id: nextUserId++,
                    username,
                    password,
                    fullName,
                    email,
                    role,
                    status,
                    lastLogin: 'Belum pernah login',
                    createdDate: new Date().toISOString().split('T')[0]
                };
                users.push(newUser);
                
                // Add to history
                addHistoryRecord(
                    'Update Stok',
                    { name: `User ${fullName}`, code: username },
                    0,
                    'user',
                    'GUDANG',
                    `Tambah user baru: ${fullName} (${username}), Role: ${role} oleh ${currentUser.fullName}`
                );
                
                showNotification('User berhasil ditambahkan!', 'success');
            }

            renderUsersTable();
            renderHistoryTable();
            updateHistorySummary();
            closeUserModal();
        }

        // Initialize dashboard as default
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is logged in (for demo, we'll auto-login as admin)
            // In real app, check localStorage or session
            
            showSection('dashboard');
            setupIncomingSearch();
            setupRekapSearch();
            setupStatusSearch();
            setupStoreSearch();
            setupStoreFilter();
            setupUnitDropdowns(); // Initialize unit dropdowns
            setupHistorySearch();
            setupHistoryStoreFilter();
            renderIncomingTable();
            renderStatusTable();
            renderStoreTable();
            renderStoreCards(); // Initialize store cards
            renderRekapTable();
            updateRekapSummary();
            renderHistoryTable();
            updateHistorySummary();
            setDefaultDate();
            setupSelectAllCheckboxes();
            loadDisplaySettings(); // Load saved display settings
            updateDashboardStats(); // Initialize dashboard stats
            
            // Setup store cards search
            const searchStoreCards = document.getElementById('searchStoreCards');
            if (searchStoreCards) {
                searchStoreCards.addEventListener('input', filterStoreCards);
            }
        });
    <script>
  const webAppUrl = "https://script.google.com/macros/s/AKfycbzb77ilZw8omfCoFDqOnVZpDzykpD4S2HTcxkwJoP8XIDMg-I0hpw2MG3lvLXXApxo/exec";

  // Contoh ambil data
  function testConnection() {
    fetch(webAppUrl + "?action=test")
      .then(res => res.json())
      .then(data => console.log("Response:", data))
      .catch(err => console.error(err));
  }

  // Contoh kirim data incoming
  function sendIncoming() {
    const body = {
      action: "sync_incoming",
      payload: [{
        id: "1",
        date: "2025-09-15",
        code: "BRG001",
        name: "Barang Contoh",
        qty: 10,
        unit: "unit",
        minStock: 5,
        status: "Menunggu Verifikasi"
      }]
    };

    fetch(webAppUrl, {
      method: "POST",
      body: JSON.stringify(body),
      headers: { "Content-Type": "application/json" }
    })
    .then(res => res.json())
    .then(data => console.log("Response:", data))
    .catch(err => console.error(err));
  }
</script>
</body>
</html>
