<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Warehouse Manager — Full (Google Sheets)</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-indigo-700 text-white flex flex-col">
      <div class="p-4 text-xl font-bold">📦 Warehouse</div>
      <nav class="flex-1 px-2 space-y-2">
        <button onclick="showPage('dashboard')" class="w-full text-left px-4 py-2 rounded hover:bg-indigo-600">📊 Dashboard</button>
        <button onclick="toggleMenu('menuBarang','arrowBarang')" class="w-full flex justify-between items-center px-4 py-2 rounded hover:bg-indigo-600">
          📦 Barang <span id="arrowBarang">▶</span>
        </button>
        <div id="menuBarang" class="ml-4 hidden">
          <button onclick="showPage('terima')" class="block px-4 py-2 hover:bg-indigo-600 w-full text-left">➕ Terima Barang</button>
          <button onclick="showPage('keluar')" class="block px-4 py-2 hover:bg-indigo-600 w-full text-left">➖ Barang Keluar</button>
          <button onclick="showPage('stok')" class="block px-4 py-2 hover:bg-indigo-600 w-full text-left">📦 Data Stok</button>
        </div>
        <button onclick="showPage('laporan')" class="w-full text-left px-4 py-2 rounded hover:bg-indigo-600">📑 Laporan</button>
        <button onclick="showPage('pengaturan')" class="w-full text-left px-4 py-2 rounded hover:bg-indigo-600">⚙️ Pengaturan</button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 overflow-y-auto">
      <!-- Dashboard -->
      <section id="dashboard" class="page">
        <h1 class="text-2xl font-bold mb-4">📊 Dashboard</h1>
        <p>Selamat datang di sistem manajemen gudang.</p>
      </section>

      <!-- Terima Barang -->
      <section id="terima" class="page hidden">
        <h1 class="text-2xl font-bold mb-4">➕ Terima Barang</h1>
        <form id="formTerima" class="space-y-4 bg-white p-4 rounded shadow">
          <input type="text" id="kodeTerima" placeholder="Kode Barang" class="w-full p-2 border rounded" required>
          <input type="text" id="namaTerima" placeholder="Nama Barang" class="w-full p-2 border rounded" required>
          <input type="number" id="jumlahTerima" placeholder="Jumlah" class="w-full p-2 border rounded" required>
          <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Simpan</button>
        </form>
      </section>

      <!-- Barang Keluar -->
      <section id="keluar" class="page hidden">
        <h1 class="text-2xl font-bold mb-4">➖ Barang Keluar</h1>
        <form id="formKeluar" class="space-y-4 bg-white p-4 rounded shadow">
          <input type="text" id="kodeKeluar" placeholder="Kode Barang" class="w-full p-2 border rounded" required>
          <input type="number" id="jumlahKeluar" placeholder="Jumlah Keluar" class="w-full p-2 border rounded" required>
          <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded">Keluarkan</button>
        </form>
      </section>

      <!-- Data Stok -->
      <section id="stok" class="page hidden">
        <h1 class="text-2xl font-bold mb-4">📦 Data Stok Barang</h1>
        <table class="w-full bg-white rounded shadow">
          <thead>
            <tr class="bg-gray-200">
              <th class="p-2 text-left">Kode</th>
              <th class="p-2 text-left">Nama</th>
              <th class="p-2 text-left">Jumlah</th>
            </tr>
          </thead>
          <tbody id="masterBody"></tbody>
        </table>
      </section>

      <!-- Laporan -->
      <section id="laporan" class="page hidden">
        <h1 class="text-2xl font-bold mb-4">📑 Laporan</h1>
        <p>Fitur laporan dalam pengembangan.</p>
      </section>

      <!-- Pengaturan -->
      <section id="pengaturan" class="page hidden">
        <h1 class="text-2xl font-bold mb-4">⚙️ Pengaturan</h1>
        <p>Pengaturan sistem di sini.</p>
      </section>
    </main>
  </div>

  <!-- Toast Notification -->
  <div id="toastContainer" class="fixed top-4 right-4 space-y-2 z-50"></div>

  <script>
    // URL Web App dari Google Apps Script
    const API_URL = "https://script.google.com/macros/s/AKfycbx123456789/exec";

    // Toggle submenu
    function toggleMenu(menuId, arrowId) {
      let menu = document.getElementById(menuId);
      let arrow = document.getElementById(arrowId);
      menu.classList.toggle("hidden");
      arrow.classList.toggle("rotate-90");
    }

    // Navigasi antar halaman
    function showPage(pageId) {
      document.querySelectorAll(".page").forEach(p => p.classList.add("hidden"));
      document.getElementById(pageId).classList.remove("hidden");
    }

    // Toast
    function showToast(message, type="success") {
      const container = document.getElementById("toastContainer");
      const toast = document.createElement("div");
      toast.className = `px-4 py-2 rounded shadow text-white ${type==="success"?"bg-green-500":"bg-red-500"}`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(()=>toast.remove(),3000);
    }

    // Load Master Data dari Spreadsheet
    async function loadBarang() {
      try {
        const res = await fetch(`${API_URL}?action=getBarang`);
        const data = await res.json();
        const body = document.getElementById("masterBody");
        body.innerHTML = "";
        data.forEach(item => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="p-2">${item.kode}</td>
            <td class="p-2">${item.nama}</td>
            <td class="p-2">${item.jumlah}</td>
          `;
          body.appendChild(row);
        });
      } catch(err) {
        console.error(err);
        showToast("Gagal memuat data ❌", "error");
      }
    }

    // ===== Form Terima Barang =====
    document.getElementById("formTerima").addEventListener("submit", async function(e) {
      e.preventDefault();
      let kode = document.getElementById("kodeTerima").value.trim().toUpperCase();
      let nama = document.getElementById("namaTerima").value.trim();
      let jumlah = parseInt(document.getElementById("jumlahTerima").value);

      if (!kode || !nama || !jumlah) {
        showToast("Lengkapi semua data ❌", "error");
        return;
      }

      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "tambahBarang", kode, nama, jumlah }),
        headers: { "Content-Type": "application/json" }
      });

      showToast("Barang berhasil diterima ✅");
      this.reset();
      loadBarang();
    });

    // ===== Form Barang Keluar =====
    document.getElementById("formKeluar").addEventListener("submit", async function(e) {
      e.preventDefault();
      let kode = document.getElementById("kodeKeluar").value.trim().toUpperCase();
      let jumlah = parseInt(document.getElementById("jumlahKeluar").value);

      if (!kode || !jumlah) {
        showToast("Lengkapi semua data ❌", "error");
        return;
      }

      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "keluarBarang", kode, jumlah }),
        headers: { "Content-Type": "application/json" }
      });

      showToast("Barang berhasil dikeluarkan ✅");
      this.reset();
      loadBarang();
    });

    // Load awal
    loadBarang();
  </script>
</body>
</html>
