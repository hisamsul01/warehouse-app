<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Warehouse Manager ‚Äî Full (Google Sheets)</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- XLSX Library (Export/Import Excel) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --primary:#4e73df; --ok:#1cc88a; --warn:#f6c23e; --danger:#e74a3b;
      --bg:#f6f7fb; --card:#fff; --muted:#64748b;
      --radius:12px; --shadow:0 8px 20px rgba(2,6,23,0.06);
    }
    * { box-sizing:border-box }
    body { margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:#0f1724 }
    a { color:inherit; text-decoration:none }
    .topbar { position:sticky; top:0; z-index:60; background:#fff; display:flex; justify-content:space-between; align-items:center; padding:12px 16px; border-bottom:1px solid #eef2f6 }
    .brand { display:flex; gap:10px; align-items:center; color:var(--primary); font-weight:600; font-size:18px }
    .menu { display:flex; gap:12px; }
    .menu button { padding:6px 12px; border-radius:8px; border:none; background:var(--primary); color:#fff; font-size:14px; cursor:pointer }
    .container { padding:20px; }
    .card { background:var(--card); border-radius:var(--radius); padding:16px; margin-bottom:20px; box-shadow:var(--shadow) }
    table { width:100%; border-collapse:collapse; margin-top:10px }
    th, td { border:1px solid #e5e7eb; padding:8px; text-align:left }
    th { background:#f3f4f6 }
    input, select { border:1px solid #d1d5db; border-radius:6px; padding:6px 8px; width:100% }
    .btn { padding:8px 14px; border:none; border-radius:8px; cursor:pointer; font-weight:500 }
    .btn-primary { background:var(--primary); color:#fff }
    .btn-danger { background:var(--danger); color:#fff }
  </style>
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <div class="brand">üì¶ Warehouse Manager</div>
    <div class="menu">
      <button onclick="showPage('inventory')">Inventory</button>
      <button onclick="showPage('outlets')">Outlet</button>
      <button onclick="showPage('receipts')">Penerimaan</button>
      <button onclick="showPage('transfers')">Transfer</button>
      <button onclick="showPage('settings')">Pengaturan</button>
    </div>
  </div>

  <!-- Container -->
  <div class="container">

    <!-- Inventory -->
    <div id="page-inventory" class="page card">
      <h2>üì¶ Inventory</h2>
      <form onsubmit="addItem(event)">
        <div class="grid" style="display:grid;grid-template-columns:1fr 2fr 1fr;gap:10px;margin-top:10px">
          <input id="itemCode" placeholder="Kode" required>
          <input id="itemName" placeholder="Nama" required>
          <input id="itemQty" type="number" placeholder="Qty" value="0" required>
        </div>
        <button class="btn btn-primary" style="margin-top:10px">Tambah Barang</button>
      </form>
      <table id="inventoryTable"><thead><tr><th>Kode</th><th>Nama</th><th>Qty</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- Outlets -->
    <div id="page-outlets" class="page card" style="display:none">
      <h2>üè¨ Outlet</h2>
      <form onsubmit="addOutlet(event)">
        <div class="grid" style="display:grid;grid-template-columns:1fr 2fr;gap:10px;margin-top:10px">
          <input id="outletCode" placeholder="Kode" required>
          <input id="outletName" placeholder="Nama" required>
        </div>
        <button class="btn btn-primary" style="margin-top:10px">Tambah Outlet</button>
      </form>
      <table id="outletsTable"><thead><tr><th>Kode</th><th>Nama</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- Receipts -->
    <div id="page-receipts" class="page card" style="display:none">
      <h2>üì• Penerimaan</h2>
      <form onsubmit="addReceipt(event)">
        <div class="grid" style="display:grid;grid-template-columns:1fr 2fr 1fr;gap:10px;margin-top:10px">
          <input id="receiptCode" placeholder="Kode" required>
          <input id="receiptName" placeholder="Nama" required>
          <input id="receiptQty" type="number" placeholder="Qty" required>
        </div>
        <button class="btn btn-primary" style="margin-top:10px">Tambah Penerimaan</button>
      </form>
      <table id="receiptsTable"><thead><tr><th>ID</th><th>Tanggal</th><th>Kode</th><th>Nama</th><th>Qty</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- Transfers -->
    <div id="page-transfers" class="page card" style="display:none">
      <h2>üì§ Transfer</h2>
      <form onsubmit="addTransfer(event)">
        <div class="grid" style="display:grid;grid-template-columns:1fr 2fr 1fr 2fr;gap:10px;margin-top:10px">
          <input id="transferCode" placeholder="Kode" required>
          <input id="transferName" placeholder="Nama" required>
          <input id="transferQty" type="number" placeholder="Qty" required>
          <input id="transferOutlet" placeholder="Outlet" required>
        </div>
        <button class="btn btn-primary" style="margin-top:10px">Tambah Transfer</button>
      </form>
      <table id="transfersTable"><thead><tr><th>ID</th><th>Tanggal</th><th>Kode</th><th>Nama</th><th>Qty</th><th>Outlet</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- Settings -->
    <div id="page-settings" class="page card" style="display:none">
      <h2>‚öôÔ∏è Pengaturan</h2>
      <form onsubmit="saveSettings(event)">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <input id="username" placeholder="Username">
          <input id="password" placeholder="Password" type="password">
        </div>
        <div style="margin-top:10px">
          <label><input type="checkbox" id="showWidgets" checked> Tampilkan Widget</label>
        </div>
        <div style="margin-top:10px">
          <select id="lang">
            <option value="id">Indonesia</option>
            <option value="en">English</option>
          </select>
        </div>
        <button class="btn btn-primary" style="margin-top:10px">Simpan</button>
      </form>
    </div>

  </div>

  <script>
    /* ========== CONFIG ========== */
    const API_URL = "https://script.google.com/macros/s/AKfycbxeuTBzHypvDoASva600WAjXeLNR8WCQ57UhASBcNxloe44E1D0_XqY8S88_jVQ_pgF/exec";
    const DB_KEY = 'whm.gs.fallback.v2';

    /* ========== PAGE NAVIGATION ========== */
    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.style.display='none');
      document.getElementById('page-' + page).style.display='block';
    }

    /* ========== LOAD DATA ========== */
    async function loadAll() {
      try {
        const res = await fetch(API_URL + "?action=getAll");
        const data = await res.json();
        localStorage.setItem(DB_KEY, JSON.stringify(data));
        renderAll(data);
      } catch (err) {
        console.error("Offline mode", err);
        const data = JSON.parse(localStorage.getItem(DB_KEY) || "{}");
        renderAll(data);
      }
    }

    function renderAll(data) {
      renderTable("inventoryTable", data.inventory, ["kode","nama","qty"]);
      renderTable("outletsTable", data.outlets, ["kode","nama"]);
      renderTable("receiptsTable", data.receipts, ["id","tanggal","kode","nama","qty"]);
      renderTable("transfersTable", data.transfers, ["id","tanggal","kode","nama","qty","outlet"]);
      if (data.user) {
        document.getElementById("username").value = data.user.username;
        document.getElementById("password").value = data.user.password;
        document.getElementById("showWidgets").checked = data.user.showWidgets;
        document.getElementById("lang").value = data.user.lang;
      }
    }

    function renderTable(id, rows, cols) {
      const tbody = document.querySelector("#" + id + " tbody");
      tbody.innerHTML = "";
      if (!rows) return;
      rows.forEach(r => {
        const tr = document.createElement("tr");
        cols.forEach(c => {
          const td = document.createElement("td");
          td.textContent = r[c] || "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    /* ========== ACTIONS ========== */
    async function addItem(e) {
      e.preventDefault();
      const obj = { action:"addItem", code: itemCode.value, name: itemName.value, qty: Number(itemQty.value) };
      await post(obj); loadAll(); e.target.reset();
    }
    async function addOutlet(e) {
      e.preventDefault();
      const obj = { action:"addOutlet", code: outletCode.value, name: outletName.value };
      await post(obj); loadAll(); e.target.reset();
    }
    async function addReceipt(e) {
      e.preventDefault();
      const obj = { action:"addReceipt", id: Date.now(), date: new Date().toISOString(), code: receiptCode.value, name: receiptName.value, qty: Number(receiptQty.value) };
      await post(obj); loadAll(); e.target.reset();
    }
    async function addTransfer(e) {
      e.preventDefault();
      const obj = { action:"addTransfer", id: Date.now(), date: new Date().toISOString(), code: transferCode.value, name: transferName.value, qty: Number(transferQty.value), outlet: transferOutlet.value };
      await post(obj); loadAll(); e.target.reset();
    }
    async function saveSettings(e) {
      e.preventDefault();
      const obj = { action:"saveSettings", user: { username: username.value, password: password.value, showWidgets: showWidgets.checked, lang: lang.value } };
      await post(obj); loadAll();
    }

    async function post(obj) {
      await fetch(API_URL, { method:"POST", body: JSON.stringify(obj) });
    }

    /* AUTOLOAD */
    loadAll();
  </script>
</body>
</html>