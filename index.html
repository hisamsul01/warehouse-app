const API_URL = "https://script.google.com/macros/s/AKfycbx123456789/exec";

// Load Master Data dari Spreadsheet
async function renderMasterData() {
  const res = await fetch(`${API_URL}?action=getBarang`);
  const data = await res.json();
  const body = document.getElementById("masterBody");
  body.innerHTML = "";
  data.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="p-2 border">${item.kode}</td>
      <td class="p-2 border">${item.nama}</td>
      <td class="p-2 border">${item.jumlah}</td>
      <td class="p-2 border space-x-2">
        <button onclick="editBarang('${item.kode}','${item.nama}',${item.jumlah})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
        <button onclick="hapusBarang('${item.kode}')" class="bg-red-600 text-white px-2 py-1 rounded">Hapus</button>
      </td>`;
    body.appendChild(row);
  });
}

// Tambah barang (Terima Barang)
document.getElementById("formTerima").addEventListener("submit", async function(e) {
  e.preventDefault();
  let kode = document.getElementById("kodeTerima").value.trim().toUpperCase();
  let nama = document.getElementById("namaTerima").value.trim();
  let jumlah = parseInt(document.getElementById("jumlahTerima").value);

  let res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "addBarang", kode, nama, jumlah })
  });
  if (res.ok) {
    showToast("Barang berhasil ditambahkan ‚úÖ");
    renderMasterData();
    this.reset();
  }
});

// Edit Barang
async function editBarang(kode, nama, jumlah) {
  let namaBaru = prompt("Edit Nama Barang:", nama);
  let jumlahBaru = prompt("Edit Jumlah:", jumlah);
  if (!namaBaru || !jumlahBaru) return;
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "updateBarang", kode, nama: namaBaru, jumlah: parseInt(jumlahBaru) })
  });
  showToast("Barang berhasil diupdate ‚úèÔ∏è");
  renderMasterData();
}

// Hapus Barang
async function hapusBarang(kode) {
  if (!confirm(`Hapus barang ${kode}?`)) return;
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "deleteBarang", kode })
  });
  showToast("Barang berhasil dihapus üóëÔ∏è", "error");
  renderMasterData();
}

// Load awal
renderMasterData();
