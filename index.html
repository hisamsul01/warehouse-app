<script>
    // Google Apps Script Configuration
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxde3CUWsh_xFk-YQukpkYg1G5NE_ssPFFhM0ioDtCO8XbeszrVPAyXcSzJMfJyCMxv/exec';

    // Fungsi untuk mengirim data ke Google Spreadsheet
    async function sendToGoogleSheet(action, data) {
        try {
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action, ...data })
            });
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const result = await response.json();
            return result;
        } catch (error) {
            console.error('‚ùå Error sending to Google Sheet:', error);
            return { success: false, message: error.message };
        }
    }

    // Tambah Barang (Incoming)
    async function addItem() {
        const date = document.getElementById('date').value;
        const code = document.getElementById('code').value;
        const name = document.getElementById('name').value;
        const qty = parseInt(document.getElementById('qty').value) || 0;
        const unit = document.getElementById('unit').value;
        const minStock = parseInt(document.getElementById('minStock').value) || 0;
        const status = document.getElementById('status').value;

        const id = Date.now(); // üîë generate ID unik

        const result = await sendToGoogleSheet("addIncoming", {
            id, date, code, name, qty, unit, minStock, status
        });

        if (result.success) {
            showNotification('Barang berhasil ditambahkan', 'success');
            loadIncomingData();
        } else {
            showNotification('Error: ' + result.message, 'error');
        }
    }

    // Tambah Outgoing
    async function addOutgoing() {
        const date = document.getElementById('out_date').value;
        const code = document.getElementById('out_code').value;
        const name = document.getElementById('out_name').value;
        const qty = parseInt(document.getElementById('out_qty').value) || 0;
        const unit = document.getElementById('out_unit').value;
        const fromStore = document.getElementById('fromStore').value;
        const toStore = document.getElementById('toStore').value;

        const id = Date.now(); // üîë generate ID unik

        const result = await sendToGoogleSheet("addOutgoing", {
            id, date, code, name, qty, unit, fromStore, toStore
        });

        if (result.success) {
            showNotification('Barang keluar berhasil ditambahkan', 'success');
            loadOutgoingData();
        } else {
            showNotification('Error: ' + result.message, 'error');
        }
    }

    // Update Status
    async function updateStatusItem(itemId, approved) {
        const id = itemId || Date.now(); // üîë jika tidak ada, buat ID baru

        const result = await sendToGoogleSheet("updateStatus", {
            id: id,
            date: new Date().toISOString().slice(0, 10),
            code: "", // isi sesuai kebutuhan
            name: "", // isi sesuai kebutuhan
            qty: 0,    // isi sesuai kebutuhan
            unit: "", // isi sesuai kebutuhan
            approved: approved
        });

        if (result.success) {
            showNotification(result.message, 'success');
            loadStatusData();
        } else {
            showNotification('Error: ' + result.message, 'error');
        }
    }
</script>
